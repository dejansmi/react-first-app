(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{1007:function(e,t,i){"use strict";var s=i(1),a=s(i(10)),o=s(i(494)),l=i(474),n=i(127),r=function(e){function t(t){var i;return(i=e.call(this,t)||this).title=n.DeleteFilesTitle,i.message=i.tr(n.DeleteFilesMessage),i.footer=[{label:n.DeleteFilesBtn,color:"blue",hide:!0,defaultAction:!0,callback:function(){return i.def.resolve((0,o.default)(i))}},{label:n.CancelBtn,hide:!0,callback:function(){return i.def.reject((0,o.default)(i))}}],i}return(0,a.default)(t,e),t}(l);e.exports=r},1008:function(e,t,i){"use strict";var s=i(1),a=s(i(10)),o=s(i(494)),l=i(471),n=i(474),r=i(911),c=i(127),d=function(e){function t(t){var i;return(i=e.call(this,t)||this).title=i.tr("Move Selected Files"),i.body=function(){return new l({className:"fav-modal",views:{"":[new l({tagName:"p",className:"modal__text modal__text_indent",template:function(){return i.tr("Select a folder to move the selected files to")+":"}}),new r({app:i.app,className:"fav-modal__select",getActiveFolder:i.getActiveFolder,collection:i.folders,excludeActive:!0,onlyEditable:!0})]}})},i.footer=[{label:i.tr("Move Files"),hide:!0,color:"blue",defaultAction:!0,callback:"promptResolve"},{label:c.CancelBtn,hide:!0,callback:function(){return i.def.reject((0,o.default)(i))}}],i}return(0,a.default)(t,e),t.prototype.promptResolve=function(){this.def.resolve(this.findView("FavoritesPanelFolderList").serializeForm(),this)},t}(n);e.exports=d},1009:function(e,t,i){"use strict";var s=i(474),a=i(127);e.exports=s.extend({initialize:function(){for(var e=this,t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];s.prototype.initialize.apply(this,i),this.title=a.DeleteFolder,this.message=function(){if(e.model instanceof Array)return e.tr("Do you really want to delete %s folders?",e.model.length);var t=e.model.serialize().title;return e.tr("Do you really want to delete this folder")+' "'+t+'"?'},this.footer=[{label:a.DeleteFolder,hide:!0,color:"blue",defaultAction:!0,callback:function(){return e.def.resolve(e)}},{label:a.CancelBtn,hide:!0,callback:function(){return e.def.reject(e)}}]}})},1010:function(e,t,i){"use strict";var s=i(1),a=s(i(10)),o=s(i(494)),l=i(474),n=i(906),r=i(127),c=function(e){function t(t){var i;return(i=e.call(this,t)||this).title=r.EditFolderTitle,i.body=function(){return new n({model:i.model})},i.footer=[{label:r.SaveChangesBtn,hide:!0,color:"blue",defaultAction:!0,callback:"promptResolve"},{label:r.CancelBtn,hide:!0,callback:function(){return i.def.reject((0,o.default)(i))}}],i}return(0,a.default)(t,e),t}(l);e.exports=c},1011:function(e,t){e.exports=function(e){return'<div class="modal__form"><label class="modal__form-field field-box input-box input-box-l"><input class="input input-l _counter" type="text" name="title" placeholder="'+this.tr("Folder name")+'" maxlength="50" value="'+e.title+'"/></label></div>'}},1012:function(e,t,i){"use strict";var s=i(1),a=s(i(10)),o=s(i(494)),l=i(474),n=i(906),r=i(127),c=function(e){function t(t){var i;return(i=e.call(this,t)||this).title=r.CreateFolderTitle,i.body=function(){return new n({model:i.model})},i.footer=[{label:r.CreateFolderBtn,hide:!0,color:"blue",defaultAction:!0,callback:"promptResolve"},{label:r.CancelBtn,hide:!0,callback:function(){return i.def.reject((0,o.default)(i))}}],i}return(0,a.default)(t,e),t.prototype.promptResolve=function(){this.def.resolve(this.findView("EditFolderForm").serializeForm(),this)},t}(l);e.exports=c},1014:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(694);e.exports=a.extend({getQueryParams:function(){return(0,s.default)({},this.attributes,{thumbsSize:"thumb",thumbsLimit:4})}})},1015:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(500),o=i(1014);e.exports=a.extend({url:"Folders",model:o,experimentalTrueParse:function(e,t){var i=e.lightboxes,s=void 0===i?[]:i,a=e.count;e.stats;return void 0===t&&(t={}),this.count=parseInt(a,10),t.parse=!1,s.map(function(e){return o.prototype.parse(e,t)})},parse:function(e,t){return this.experimentalTrueParse(e,t)},createFolder:function(e){var t=this,i=new o(e,{app:this.app});return i.save({},{wait:!0}).then(function(){return t.add(i,{at:0,created:!0})})},updateFolder:function(e,t,i){return this.get(e).save(t,(0,s.default)({wait:!0,observable:!0},i))},deleteFolder:function(e){return this.get(e).destroy()},deleteFolders:function(e){var t=this;return e.forEach(function(e){return t.deleteFolder(e)})},addToCart:function(e){var t=this;return this.sync("update",this,{url:"CartFolderFiles",getQueryParams:{folderId:e},success:function(){return t.trigger("sync",t)}})},moveFolders:function(e){var t=this;return this.sync("update",this,{url:"MoveFolderFiles",getQueryParams:e,success:function(){return t.trigger("sync",t)}})},getQueryParams:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,s.default)(a.prototype.getQueryParams.apply(this,t),{thumbsSize:"thumb",thumbsLimit:4})},serializeGroupsByPermission:function(e){var t=this;void 0===e&&(e=["owner","edit","view"]);var i=e.map(function(e){return{name:e,data:[]}});return this.each(function(e){var s="view";e.get("userId")===parseInt(t.app.user.get("id"),10)?s="owner":"edit"===e.get("permission")&&(s="edit");var a=i.find(function(e){return e.name===s});a&&a.data.push(e.serialize())}),1===e.length?i[0].data:i}})},1021:function(e,t){e.exports=function(e){var t='<div class="'+e.className+' _folders-list"><span class="fav-panel__selected-folder">';return e.folder?(t+='<i class="fav-panel__selected-folder-icon ',e.folder.isOwn?t+=" icon-my-folders ":t+=" icon-shared-folders ",t+='"></i>'+e.folder.title+" ["+e.folder.count+"]"):t+='<i class="fav-panel__selected-folder-icon icon-my-folders"></i>'+this.tr("My photos"),t+='</span><i class="fav-panel__arrow fav-panel__arrow_top arrow arrow-black arrow-top"></i><i class="fav-panel__arrow fav-panel__arrow_bottom arrow arrow-black arrow-bottom"></i></div>'}},1022:function(e,t){e.exports=function(e){var t='<div class="select-folder"><div class="select-folder__list _list">';if(e.folders.length){var i=e.folders;if(i)for(var s,a=-1,o=i.length-1;a<o;){(s=i[a+=1]).data.length&&(t+='<div class="select-folder__part _part">',"shared"===s.name?t+='<i class="select-folder__part-icon icon icon-shared-folders"></i>'+this.tr("Shared With Me"):t+='<i class="select-folder__part-icon icon icon-my-folders"></i>'+this.tr("My Folders"),t+='<span class="select-folder__part-size">'+s.data.length+"</span></div>"),t+='<div class="select-folder__sub-list">';var l=s.data;if(l)for(var n,r=-1,c=l.length-1;r<c;)t+='<label class="select-folder__item"><input class="select-folder__radio _folder-selection" type="radio" name="folder" value="'+(n=l[r+=1]).id+'"',e.active===n.id&&(t+=' checked="checked"'),t+=' /><i class="select-folder__icon"></i><span class="select-folder__text">'+n.title+" ["+n.count+"]</span>","shared"===s.name?("view"===n.permission&&(t+='<i class="select-folder__badge icon icon-folder-action-view"></i>'),"edit"===n.permission&&(t+='<i class="select-folder__badge icon icon-folder-action-edit"></i>')):n.isShared&&(t+='<i class="select-folder__badge icon icon-folder-action-share"></i>'),t+="</label>";t+="</div>"}}else t+='<div class="select-folder__part _part"><i class="select-folder__part-icon icon icon-my-folders"></i>'+this.tr("My Folders")+'<span class="select-folder__part-size">1</span></div><div class="select-folder__sub-list"><label class="select-folder__item"><input class="select-folder__radio _folder-selection" type="radio" name="folder" value="0" checked="checked" /><i class="select-folder__icon"></i><span class="select-folder__text">'+this.tr("My photos")+"</span></label></div>";return t+="</div></div>"}},1023:function(e,t,i){"use strict";var s=i(476),a=i(471),o=i(1022),l=i(664).default;e.exports=a.extend({el:!1,template:o,active:null,folders:null,events:{click:"onClick","click ._part":"onPartClick","change ._folder-selection":"onFolderSelectionChange"},serialize:function(){return{active:this.active,folders:this.prepareFolders()}},clientAfterRender:function(){var e=this;setTimeout(function(){return e.initPerfectScrollbar()},0)},initPerfectScrollbar:function(){var e=this.$("._list").get(0);s.initialize(e,l)},prepareFolders:function(){var e=[],t={name:"shared",data:[]};return this.folders.forEach(function(i){"owner"===i.name?e.push(i):t.data=t.data.concat(i.data)}),t.data.length&&e.push(t),e},onFolderSelectionChange:function(e){this.onSelect(e.currentTarget.value)},onPartClick:function(e){this.$(e.currentTarget).toggleClass("select-folder__part_closed"),this.onPartClickCallback()},onClick:function(e){e.stopPropagation()},onSelect:function(){},onPartClickCallback:function(){}})},1518:function(e,t){e.exports=function(e){var t='<div class="fav-panel-box"><div class="fav-panel-msg-box _msg-box"></div><div class="fav-panel fav-panel_closed _pull ';return e.state.open&&(t+=" hidden"),t+='"><div class="fav-panel__row"><div class="fav-panel__cell"><div class="fav-panel__shadow"></div></div><div class="fav-panel__cell fav-panel__cell_middle"><div class="fav-panel__tab-wrapper"><div class="fav-panel__tab"><span class="fav-panel__tab-title"><i class="fav-panel__tab-icon icon icon-favorites"></i>'+this.tr("Favorites")+'</span><div class="fav-panel__tab-shadow"></div></div></div></div><div class="fav-panel__cell"><div class="fav-panel__shadow"></div></div></div><div class="fav-panel__row"><div class="fav-panel__cell"><div class="fav-panel__bg"></div></div><div class="fav-panel__cell fav-panel__cell_middle"><div class="fav-panel__bg"></div></div><div class="fav-panel__cell"><div class="fav-panel__bg"></div></div></div></div><div class="fav-panel fav-panel_opened _panel ',e.state.open||(t+=" hidden"),t+='"><div class="fav-panel__wrapper"><div class="fav-panel__lift-drag _lift-drag _resize"></div><div class="fav-panel__header"><div class="fav-panel__header-left"><div class="fav-panel__header-logo"><i class="fav-panel__star icon icon-favorites-big"></i></div><div class="fav-panel__header-list _folders">\x3c!--FavoritesPanelFolderList--\x3e</div><div class="fav-panel__header-actions">',e.isEnterpriseUser||(t+='<i class="fav-panel__button button-folder button-folder-cart _cart _action" data-title="'+this.tr("Add to Cart")+'"></i>'),t+='<i class="fav-panel__button button-folder button-folder-new _create _action" data-title="'+this.tr("New Folder")+'"></i><i class="fav-panel__button button-folder button-folder-options _options _action" data-title="'+this.tr("More actions")+'"></i><div class="fav-panel__files-menu _files-menu">\x3c!--FavoritesFilesMenu--\x3e</div></div></div><div class="fav-panel__header-right"><div class="fav-panel__action-box _folder-users"></div><i class="fav-panel__action fav-panel__action_layout _layout"><i class="fav-panel__action-icon icon _layout-icon '+e.layoutIconClasses+'"></i></i><i class="fav-panel__action fav-panel__action_edit _edit-mode _action" data-title="'+this.tr("Notes")+'"><i class="fav-panel__action-icon icon icon-add-info-mode"></i></i><i class="fav-panel__lift arrow arrow-lift arrow-up _up',e.state.liftLevel===e.liftLevels.max&&(t+=" inactive"),t+='"></i><i class="fav-panel__lift-ind cmp-lift-indicator _indicator" data-level="'+e.state.liftLevel+'" data-max-level="'+e.liftLevels.max+'"><i class="lift-level lift-level-4"></i><i class="lift-level lift-level-3"></i><i class="lift-level lift-level-2"></i><i class="lift-level lift-level-1"></i></i><i class="fav-panel__lift arrow arrow-lift arrow-down _down',e.state.liftLevel===e.liftLevels.min&&(t+=" inactive"),t+='"></i><i class="fav-panel__close icon icon-close-cross _close"></i></div></div><div class="fav-panel__container _container ',e.state.editor||(t+=" note-editor_closed"),t+='" style="height: '+e.panelHeight+'px"><div class="fav-panel__files _scroll _files  _sortable-files">\x3c!--FavoriteFilesList--\x3e</div><div class="fav-panel__no-files-wrap hidden _no-files">\x3c!--FavoriteNoFiles--\x3e</div></div><div class="fav-panel__editor-box ',e.state.editor||(t+=" note-editor_closed"),t+=' _editor">\x3c!--FavoriteFolderNotes--\x3e</div></div></div></div>'}},1519:function(e,t,i){"use strict";var s=i(0),a=i(16),o=i(471);e.exports=o.extend({el:void 0,locked:!1,resizing:!1,prevHeight:void 0,windowHeight:void 0,currentLevels:{current:void 0,min:void 0,max:void 0},levels:{min:1,max:8,defaultValue:2},offset:0,animate:{enabled:!0,speed:500},resizeThrottlingTime:50,getStoreyHeight:function(){return 150},prevRowHeight:void 0,events:{"mousedown ._resize":"initResizing","click ._up":"setLevelUp","click ._down":"setLevelDown"},globals:{"resize window":"onWindowResize","mouseup document":"fininshResizing","mousemove document":"processResizing"},initialize:function(){var e=this;this.currentLevels.current=this.levels.defaultValue,this.on("afterChangeLevel",function(){e.setIndicatorCurrent(),e.setAllowedUpDownButtons()}),this.on("adjust",this.resizeMe),this.someDimensionsChanged()},onWindowResize:function(){s.throttle(this.someDimensionsChanged.bind(this),this.resizeThrottlingTime)},someDimensionsChanged:function(){this.setAllowedLevels(),this.adjustTheLevelIfInvisible(),this.windowHeight=a.$(window).height(),this.prevRowHeight=this.getStoreyHeight()},initResizing:function(e){this.resizing=!0,this.prevHeight=this.$el.outerHeight(),a.$("body").addClass("not-selectable")},fininshResizing:function(){this.resizing=!1,a.$("body").removeClass("not-selectable")},processResizing:function(e){this.resizing&&this.findClosestLevel(e.clientY)},setLevelUp:function(){this.changeLevelAllowed(1)&&this.changeLevel(this.currentLevels.current+1)},setLevelDown:function(){this.changeLevelAllowed(-1)&&this.changeLevel(this.currentLevels.current-1)},changeLevel:function(e,t){var i=this;if(e===this.currentLevels.current)return!1;this.trigger("beforeChangeLevel",[this.currentLevels.current,e]);var s=this.getStoreyHeight(),a=this.$el.outerHeight()-s*this.currentLevels.current+s*e;return this.currentLevels.current=e,this.prevHeight=a,this.$("._container").css("height",s*this.currentLevels.current+this.offset),!t&&this.animate.enabled?(this.locked=!0,this.$el.animate({height:a},this.animate.speed,function(){i.trigger("afterChangeLevel",[i.currentLevels.current,e]),i.locked=!1})):(this.$el.css("height",a+"px"),this.trigger("afterChangeLevel",[this.currentLevels.current,e])),!0},findClosestLevel:function(e){var t=this.getStoreyHeight(),i=this.prevHeight-t*this.currentLevels.current,s=i+t,a=i+this.currentLevels.max*t,o=i+this.windowHeight-e;o<s&&(o=s),o>a&&(o=a),this.changeLevel(Math.floor((o-i)/t),!0)},setIndicatorCurrent:function(){this.$("._indicator").get(0).setAttribute("data-level",this.currentLevels.current)},setIndicatorMax:function(){this.$("._indicator").get(0).setAttribute("data-max-level",this.currentLevels.max)},setAllowedUpDownButtons:function(){this.$("._down").toggleClass("inactive",1===this.currentLevels.current),this.$("._up").toggleClass("inactive",this.currentLevels.current===this.currentLevels.max)},changeLevelAllowed:function(e){return!this.locked&&this.currentLevels.current+e<=this.currentLevels.max&&this.currentLevels.current+e>=this.currentLevels.min},setAllowedLevels:function(){var e=this.getStoreyHeight(),t=this.$el.outerHeight()-e*this.currentLevels.current,i=Math.floor((a.$(window).height()-t)/e);i>this.levels.max&&(i=this.levels.max),i<this.levels.min&&(i=this.levels.min),this.currentLevels.min=this.levels.min,this.currentLevels.max=i>this.levels.max?this.levels.max:i,this.setIndicatorMax()},adjustTheLevelIfInvisible:function(){this.currentLevels.current>this.currentLevels.max&&this.changeLevel(this.currentLevels.max,!0)},resizeMe:function(){var e=this.getStoreyHeight(),t=this.$el.outerHeight()-this.prevRowHeight*this.currentLevels.current+e*this.currentLevels.current;this.$("._container").css("height",e*this.currentLevels.current+this.offset),this.$el.css("height",t+"px"),this.someDimensionsChanged()},getCurrentLevel:function(){return this.currentLevels.current}})},1520:function(e,t){e.exports=function(e){return'<div class="modal folder-tour-modal _modal"><div class="modal__dialog"><div class="folder-tour-modal__header _drag-handler"><i class="folder-tour-modal__close icon icon-close-cross _close"></i></div><div class="folder-tour-modal__body _body">\x3c!--body mount--\x3e</div></div></div>'}},1521:function(e,t){e.exports=function(e){var t='<div class="folder-tour"><div class="folder-tour__part folder-tour__part_start _part _part-start"><div class="folder-tour__poster"></div><div class="folder-tour__content"><div class="folder-tour__title-box"><span class="folder-tour__title">'+this.tr("Discover the latest New Features for your Favourites folder!")+'</span></div></div></div><div class="folder-tour__part folder-tour__part_notification folder-tour__part_hidden _part _part-notification"><div class="folder-tour__poster part-notification _poster-notification"><div class="part-notification__mouse"></div><div class="part-notification__file"></div><div class="part-notification__file-click"></div><div class="part-notification__message"></div></div><div class="folder-tour__content"><span class="folder-tour__title">'+this.tr("Simpler Notification")+'</span><span class="folder-tour__text">'+this.tr("We now show a notification pop-up when you add a file to your Favorites, instead of opening a full-size Favorites panel at the bottom of the page. To change the current folder, just open the Favorites panel and select a new one.")+'</span></div></div><div class="folder-tour__part folder-tour__part_collaboration folder-tour__part_hidden _part _part-collaboration"><div class="folder-tour__poster part-collaboration _poster-collaboration"><div class="part-collaboration__owner"></div><div class="part-collaboration__user1"></div><div class="part-collaboration__user2"></div><div class="part-collaboration__user3"></div><div class="part-collaboration__user4"></div><div class="part-collaboration__counter"></div></div><div class="folder-tour__content"><span class="folder-tour__title">'+this.tr("Real-Time Collaboration")+'</span><span class="folder-tour__text">'+this.tr("It’s quick and easy to invite others to view, edit, and collaborate in any folder. Once you add people to your folder, all the team members will be able to view and track changes within your folder.")+'</span></div></div><div class="folder-tour__part folder-tour__part_advanced folder-tour__part_hidden _part _part-advanced"><div class="folder-tour__poster part-advanced _poster-advanced"><div class="part-advanced__mouse"></div><div class="part-advanced__thumbs"></div><div class="part-advanced__tab-email"></div><div class="part-advanced__tab-link"></div><div class="part-advanced__tab-social"></div><div class="part-advanced__tooptip-perms"></div><div class="part-advanced__btn-edit"></div><div class="part-advanced__copied"></div></div><div class="folder-tour__content"><span class="folder-tour__title">'+this.tr("Advanced Sharing")+'</span><span class="folder-tour__text">'+this.tr("Different sharing options on your fingertips. You can easily select what kind of sharing you need - by email or by link.")+'</span></div></div><div class="folder-tour__part folder-tour__part_cover folder-tour__part_hidden _part _part-cover"><div class="folder-tour__poster part-cover _poster-cover"><div class="part-cover__mouse"></div><div class="part-cover__file"></div><div class="part-cover__file-click"></div><div class="part-cover__cover"></div></div><div class="folder-tour__content"><span class="folder-tour__title">'+this.tr("Folder Cover Image")+'</span><span class="folder-tour__text">'+this.tr("Make your collections stylish and fresh by setting an image to be a folder cover.")+'</span></div></div><div class="folder-tour__actions"><button class="folder-tour__btn-start button button-xxl button-watery button-blue button-upper _btn-start">'+this.tr("Start Tour")+'</button><div class="folder-tour__pager hidden _pager" data-index="0"><i class="folder-tour__btn-page active _page" data-page="notification"></i><i class="folder-tour__btn-page _page" data-page="collaboration"></i><i class="folder-tour__btn-page _page" data-page="advanced"></i><i class="folder-tour__btn-page folder-tour__btn-page_done _page" data-page="cover"></i></div></div><div class="folder-tour__stars fly-star _fly-star">',i=e.flyStars;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<i class="fly-star__item fly-star__item_size-'+(s=i[a+=1]).size+' _fly-star-item"data-direction-top="'+s.direction.top+'" data-direction-left="'+s.direction.left+'"style="top: '+s.position.top+"px; left: "+s.position.left+"px; transition-delay: "+s.delay+"s;transition-duration: "+s.speed+"s;",e.starRotate&&(t+=" transform: scale(1) rotate3d(0, 0, 1, "+s.deg+"deg);"),t+='"></i>';return t+="</div></div>"}},1522:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(1521),l={startDelay:500,count:70,sizes:["s","m","l","xl","xxl"],speed:{min:.5,max:1.5},delay:{min:0,max:.3},degrees:360,randomDirection:!1,startCircleRadius:250,minCircleRadius:380,maxCircleRadius:900,rotate:!0,rotateDegrees:360,finalScale:.5};e.exports=a.extend({name:"FolderTour",el:!1,template:o,shownPages:["start"],pagesCount:5,animationWait:{notification:{goWait:100,stopWait:4e3,resetWait:500,againWait:500},collaboration:{goWait:100,stopWait:1900,resetWait:100,againWait:100},advanced:{goWait:100,stopWait:17e3,resetWait:500,againWait:100},cover:{goWait:100,stopWait:4e3,resetWait:500,againWait:500}},events:{"click ._btn-start":"onBtnStartClick","click ._page":"onPageClick"},serialize:function(){return{flyStars:this.getFlyStars(),starRotate:l.rotate}},clientAfterRender:function(){var e=this;this.app.userSettings.set({newFolderTourShown:Math.round(Date.now()/1e3)}),s.delay(function(){e.letIsStarsFly()},l.startDelay)},getFlyStars:function(){for(var e,t=[],i=l.speed,s=l.delay,a=0;a<l.count;a++)e=l.randomDirection?Math.round(Math.random()*(l.degrees-1)):Math.round((l.degrees-1)/l.count)*a,t.push({size:l.sizes[Math.round(Math.random()*(l.sizes.length-1))],speed:(Math.random()*(i.max-i.min)+i.min).toFixed(2),delay:(Math.random()*(s.max-s.min)+s.min).toFixed(2),direction:this.getDirection(e),position:this.getPosition(e),deg:e});return t},getPosition:function(e){return{top:Math.round(l.startCircleRadius*Math.sin(e)),left:Math.round(l.startCircleRadius*-Math.cos(e))}},getDirection:function(e){var t=l.minCircleRadius,i=l.maxCircleRadius,s=Math.round(Math.random()*(i-t)+t);return{top:Math.round(s*Math.sin(e)),left:Math.round(s*-Math.cos(e))}},letIsStarsFly:function(){var e=this,t=l.rotate?l.rotateDegrees:0,i=l.finalScale;s.each(this.$("._fly-star-item"),function(s){var a=e.$(s);a.css({top:a.attr("data-direction-top")+"px",left:a.attr("data-direction-left")+"px",transform:"scale("+i+") rotate3d(0, 0, 1, "+t+"deg)"}).addClass("fly-star__item_move")}),s.delay(function(){e.$("._fly-star").remove()},1e3*(l.speed.max+l.delay.max))},resetPartAnimation:function(e){clearTimeout(this.goTimer),clearTimeout(this.stopTimer),clearTimeout(this.resetTimer),clearTimeout(this.againTimer),this.$("._poster-"+e).removeClass("part-"+e+"_go part-"+e+"_ready")},partAnimation:function(e){var t=this,i=this.animationWait[e];if(this.activePartAnimation&&this.resetPartAnimation(this.activePartAnimation),i){this.activePartAnimation=e;var a=this.$("._poster-"+e);a.addClass("part-"+e+"_ready"),this.goTimer=s.delay(function(){a.addClass("part-"+e+"_go")},i.goWait),this.stopTimer=s.delay(function(){a.removeClass("part-"+e+"_ready")},i.stopWait+i.goWait),this.resetTimer=s.delay(function(){a.removeClass("part-"+e+"_go")},i.resetWait+i.stopWait+i.goWait),this.againTimer=s.delay(function(){t.partAnimation(e)},i.againWait+i.resetWait+i.stopWait+i.goWait)}},onBtnStartClick:function(){this.$("._btn-start").addClass("hidden"),this.$("._pager").removeClass("hidden"),this.$("._part-start").addClass("folder-tour__part_hidden"),this.$("._part-notification").removeClass("folder-tour__part_hidden");var e=this.$("._page").filter(".active").attr("data-page");this.shownPages.push(e),this.partAnimation(e)},onPageClick:function(e){var t=this.$(e.currentTarget),i=t.attr("data-page");if(t.hasClass("active")){if(!(t=t.next()).length)return void this.onCloseCallback();i=t.attr("data-page")}this.$("._pager").attr("data-index",t.index()),this.$("._part").addClass("folder-tour__part_hidden"),this.$("._part-"+i).removeClass("folder-tour__part_hidden"),this.$("._page").removeClass("active"),t.addClass("active"),this.shownPages.push(i),this.partAnimation(i),s.uniq(this.shownPages).length>=this.pagesCount&&this.app.userSettings.set({newFolderTourViewed:!0})},onCloseCallback:s.noop})},1523:function(e,t,i){"use strict";var s=i(475),a=i(1522),o=i(1520);e.exports=s.extend({template:o,overlayOpacity:70,draggable:!0,noBorder:!0,showHeader:!0,showTitle:!1,fullScreen:!0,destroyOnHide:!0,options:{},footer:[],initialize:function(){this.body=[new a({app:this.app,onCloseCallback:this.onCloseCallback.bind(this)})];for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s.prototype.initialize.apply(this,t)},onCloseCallback:function(){this.hide()}})},1524:function(e,t,i){"use strict";var s=i(1),a=s(i(10)),o=s(i(494)),l=i(471),n=i(474),r=i(911),c=i(127),d=function(e){function t(t){var i;return(i=e.call(this,t)||this).title=c.CopyFilesTitle,i.body=function(){return new l({className:"fav-modal",views:{"":[new l({tagName:"p",className:"modal__text modal__text_indent",template:function(){return i.tr(c.CopyFilesMessage)+":"}}),new r({app:i.app,className:"fav-modal__select",getActiveFolder:i.getActiveFolder,collection:i.folders,excludeActive:!0,onlyEditable:!0})]}})},i.footer=[{label:c.CopyFilesBtn,hide:!0,color:"blue",defaultAction:!0,callback:"promptResolve"},{label:c.CancelBtn,hide:!0,callback:function(){return i.def.reject((0,o.default)(i))}}],i}return(0,a.default)(t,e),t.prototype.promptResolve=function(){this.def.resolve(this.findView("FavoritesPanelFolderList").serializeForm(),this)},t}(n);e.exports=d},1525:function(e,t,i){"use strict";var s=i(474),a=i(127),o=s.extend({name:"needPermissionModal",title:a.ServiceModalTitle,message:function(){return this.tr("Sorry, you have no editing permissions.")}});e.exports=o},1526:function(e,t,i){"use strict";var s=i(474),a=i(127),o=s.extend({name:"emptySelectionModal",title:a.ServiceModalTitle,message:function(){return this.tr(a.EmptySelectionMessage)}});e.exports=o},1527:function(e,t,i){"use strict";var s=i(0),a=i(128);e.exports=a.extend({url:"FavoriteFile",getQueryParams:s.noop,parse:function(e,t){if(e.errors)return this.trigger("invalid",this,e.errors),{};var i=e.items?s.first(e.items):e;return a.prototype.parse.call(this,i,t)}})},1532:function(e,t,i){"use strict";(function(e){var t=i(0),s=i(1531),a=i(1527),o=i(6)(e);e.exports=s.extend({url:"FavoriteFiles",model:a,parse:function(e){if(e instanceof Array)return e;var t=e.count,i=e.items,s=void 0===i?[]:i;return this.totalItems=Math.max(parseInt(t,10),0),s},addFile:function(e,i,s){var l=this,n=new a({id:e},{app:this.app});return this.listenToOnce(n,"sync",function(i,a){a.errors?o.error("FavoriteFiles: "+t.pluck(a.errors,"error_message").join(". ")):(l.add(i,{at:s}),l.app.observer.fire("Favorites:fileAdded",{id:e}))}),n.save({},{wait:!0,getQueryParams:{id:e,folder:i,at:s}}).promise()},copyFiles:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesCopy",getQueryParams:e,success:function(){return t.trigger("sync",t,{})}})},moveFiles:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesMove",getQueryParams:e,success:function(){t.trigger("sync",t,{}),t.remove(e.items)}})},deleteFiles:function(e){var t=this;return this.sync("update",this,{url:"FavoriteFilesRemove",getQueryParams:e,success:function(){t.trigger("sync",t,{}),t.remove(e.items)}})}})}).call(this,i(3)(e))},1533:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(16),o=i(48);e.exports=o.extend({url:"FolderCache",model:a.Model.extend({defaults:{selected:!1},parse:function(e){return{id:parseInt(e,10)}}}),reorder:function(e,t){var i=this;return this.sync("update",this,{getQueryParams:(0,s.default)({},this.getQueryParams,{fileId:e,index:t}),success:function(){return i.trigger("sync",i)}}).promise()}})},1536:function(e,t){e.exports=function(e){var t='<div class="fav-msg';return e.showed&&e.count>1&&(t+=" fav-msg_visible"),t+='"><div class="fav-msg__wrap _open"><div class="fav-msg__img-box fav-msg__img-box_count'+e.prevCount+' _img-box"><div class="fav-msg__img',e.folderPreviousThumb&&(t+=" fav-msg__img_hidden"),t+=' _img"',e.folderThumb&&(t+=' style="background-image: url('+e.folderThumb+');"'),t+="></div>",e.folderPreviousThumb&&(t+='<div class="fav-msg__img fav-msg__img_prev" style="background-image: url('+e.folderPreviousThumb+');"></div><div class="fav-msg__img fav-msg__img_back"></div>'),t+='</div><span class="fav-msg__text">'+this.tr("Added to “<b>%s</b>”",e.folderName)+'</span><div class="fav-msg__close _close-msg"><i class="fav-msg__icon icon icon-close-small-white"></i></div><i class="fav-msg__pointer"></i></div></div>'}},1537:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(9),l=i(1536);e.exports=a.extend({name:"FavoritesMessage",el:!1,template:l,count:1,timer:null,events:{"click ._open":"onOpenClick","click ._close-msg":"onCloseMsgClick"},initialize:function(){this.messageModel=new o({showed:!1,thumb:null,count:1}),this.listenTo(this.app.observer,"Favorites:fileAdded",this.fileAdded),this.listenTo(this.messageModel,"change:thumb",this.render)},serialize:function(){return{showed:this.messageModel.get("showed"),count:Math.min(this.messageModel.get("count"),3),prevCount:Math.min(this.messageModel.get("count")-1,3),folderThumb:this.messageModel.get("thumb"),folderPreviousThumb:this.messageModel.previous("thumb"),folderName:this.getFolderName()}},clientAfterRender:function(){var e=this;this.messageModel.get("showed")&&s.delay(function(){e.show()},100)},getFolderName:function(){var e=this.getActiveFolder();return e?e.get("title"):""},fileAdded:function(e){if(!this.state.get("open")&&this.collection.get(e.id)){var t=this.messageModel.get("count");this.messageModel.get("showed")?t+=1:t=1,this.messageModel.set({showed:!0,thumb:this.collection.get(e.id).get("thumbs").normal,count:t})}},show:function(){var e=this;clearTimeout(this.timer),this.$el.addClass("fav-msg_visible"),this.$("._img").removeClass("fav-msg__img_hidden"),s.delay(function(){e.$("._img-box").addClass("fav-msg__img-box_count"+e.messageModel.get("count"))},200),this.timer=s.delay(function(){e.hide()},3e3)},hide:function(){var e=this;this.$el.removeClass("fav-msg_visible"),s.delay(function(){e.messageModel.set({showed:!1,count:1,thumb:null})},200)},onOpenClick:function(){this.openPanelCallback(),this.hide()},onCloseMsgClick:function(e){e.stopPropagation(),clearTimeout(this.timer),this.hide()},openPanelCallback:s.noop})},1538:function(e,t){e.exports=function(e){var t='<div class="fav-panel__user-actions"><i class="fav-panel__action fav-panel__action_shared _collaborate"><i class="fav-panel__action-icon icon icon-collaborate"></i>';return e.isShared&&(t+='<i class="shared-folder-indicator"></i>'),t+="</i></div>"}},1539:function(e,t){e.exports=function(e){return'<div class="fav-collaborate"><div class="fav-collaborate__list _shared"></div><div class="fav-collaborate__settings _settings">'+this.tr("Sharing Settings")+"</div></div>"}},1540:function(e,t,i){"use strict";var s=i(471),a=i(695),o=i(1539);e.exports=s.extend({name:"FavoritesPanelCollaborate",el:!1,template:o,events:{"click ._settings":"onSettingsClick"},prepareRender:function(){this.setView("._shared",new a({app:this.app,model:this.getActiveFolder(),collection:this.collection,opened:!0,listOnly:!0,includeLink:!0}))},onSettingsClick:function(e){e.stopPropagation(),this.shareCallback()},getActiveFolder:function(){},isGranted:function(){},shareCallback:function(){},changeCallback:function(){}})},1541:function(e,t,i){"use strict";var s=i(471),a=i(1540),o=i(473),l=i(472),n=i(1538);e.exports=s.extend({name:"FavoritesPanelUsers",el:!1,template:n,events:{"click ._collaborate":"onCollaborateClick","mouseenter ._collaborate":"onMouseEnter","mouseleave ._collaborate":"onMouseLeave"},initialize:function(){this.listenTo(this.state,"change:folderID",this.render),this.listenTo(this.folders,"change:isShared reset",this.render)},serialize:function(){return{isShared:this.isShared()}},clientAfterRender:function(){var e=this;this.setView("Collaborate",new o({name:"Collaborate",app:this.app,params:l.FavoritesPanelCollaborate,classes:{"tooltip_extra-shadow":!0},content:new a({collection:this.collection,isGranted:this.isGranted.bind(this),shareCallback:this.shareCallback.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})})),this.setView("Title",new o({params:l.darkTitle,classes:{tooltip_dark:!0},content:new s({el:!1,template:function(){return e.app.tr("Collaborate")}})}))},isShared:function(){var e=this.getActiveFolder();return e&&e.get("isShared")},onCollaborateClick:function(e){this.isGranted("auth")&&this.getView("Collaborate").toggle(e)},onMouseEnter:function(e){this.getView("Title").show(e)},onMouseLeave:function(){this.getView("Title").hide()},isGranted:function(){},shareCallback:function(){},getActiveFolder:function(){}})},1542:function(e,t){e.exports=function(e){var t='<div class="fav-panel__no-files';return 1===e.panel.liftLevel&&(t+=" fav-panel__no-files_compact"),t+='"><div class="fav-panel__file-target-wrap"><i class="fav-panel__file-target-wave-wrap"><i class="fav-panel__file-target-wave animation-round-pulsate"></i></i><i class="fav-panel__file-target-icon icon icon-drop-target"></i><span class="fav-panel__file-target-text">'+this.tr("Drop files here")+"</span></div></div>"}},1543:function(e,t,i){"use strict";var s=i(471),a=i(1542);e.exports=s.extend({name:"FavoritesPanelNoFiles",el:!1,template:a,serialize:function(){return{panel:this.readPanelState()}},updateSize:function(e){this.$el.toggleClass("fav-panel__no-files_compact",1===e)},readPanelState:function(){}})},1544:function(e,t){e.exports=function(e){var t='<ul class="fav-options';return e.isDisabled&&(t+=" fav-options_disabled"),t+='"><li class="fav-options__item"><a class="fav-options__link" target="_blank" href="'+e.activeFolder.link+'"><i class="fav-options__icon icon icon-folder-action-view"></i><span>'+this.tr("View")+'</span></a></li><li class="fav-options__item _share"><span class="fav-options__link"><i class="fav-options__icon icon icon-folder-action-share"></i><span>'+this.tr("Share")+'</span></span></li><li class="fav-options__item',e.viewOnly?t+=" fav-options__item_disabled":t+=" _move",t+='"><span class="fav-options__link"><i class="fav-options__icon icon icon-folder-action-move"></i><span>'+this.tr("Move")+'</span></span></li><li class="fav-options__item',e.viewOnly?t+=" fav-options__item_disabled":t+=" _edit",t+='"><span class="fav-options__link"><i class="fav-options__icon icon icon-folder-action-edit"></i><span>'+this.tr("Rename")+'</span></span></li><li class="fav-options__item _delete"><span class="fav-options__link"><i class="fav-options__icon icon icon-folder-action-remove"></i><span>'+this.tr("Delete")+"</span></span></li></ul>"}},1545:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(1544);e.exports=a.extend({el:!1,template:o,events:{"click ._share":"onShareClick","click ._move":"onMoveClick","click ._edit":"onEditClick","click ._delete":"onDeleteClick","click ._preview":"onPreviewClick"},serialize:function(){return{isDisabled:!this.getActiveFolder(),activeFolder:this.getActiveFolder()?this.getActiveFolder().toJSON():{},viewOnly:!this.isGranted("edit",!1)}},onShareClick:function(e){e.stopPropagation(),this.shareCallback()},onMoveClick:function(e){e.stopPropagation(),this.moveCallback()},onEditClick:function(e){e.stopPropagation(),this.editCallback()},onDeleteClick:function(e){e.stopPropagation(),this.deleteCallback()},onPreviewClick:function(e){e.stopPropagation(),this.previewCallback()},getActiveFolder:s.noop,shareCallback:s.noop,moveCallback:s.noop,editCallback:s.noop,deleteCallback:s.noop,previewCallback:s.noop,isGranted:s.noop})},1546:function(e,t){e.exports=function(e){var t='<div class="files-menu">';return e.shown&&(t+='<div class="files-menu__checkbox _action" data-title="'+this.tr("Select All")+'"><label class="files-menu__checkbox-label field-box checkbox-box checkbox-box-l checkbox-box-only"><input class="checkbox _select" type="checkbox"',e.selectAll&&(t+=" checked"),t+=' /><i class="icon icon-checkbox icon-checkbox-l"></i></label></div><i class="files-menu__item button-folder button-folder-copy _copy _action" data-title="'+this.tr("Copy Selected")+'"></i><i class="files-menu__item button-folder button-folder-move _action',e.viewOnly?t+=" files-menu__item_disabled":t+=" _move",t+='" data-title="'+this.tr("Move Selected")+'"></i><i class="files-menu__item button-folder button-folder-remove _action',e.viewOnly?t+=" files-menu__item_disabled":t+=" _delete",t+='" data-title="'+this.tr("Remove Selected")+'"></i>'),t+="</div>"}},1547:function(e,t,i){"use strict";var s=i(0),a=i(16),o=i(471),l=i(473),n=i(472),r=i(1546);e.exports=o.extend({name:"FavoritesFilesMenu",el:!1,template:r,state:new a.Model({shown:!1,selectAll:!1}),events:{"change ._select":"onSelectChange","click ._copy":"onCopyClick","click ._move":"onMoveClick","click ._delete":"onDeleteClick","mouseenter ._action":"onActionMouseEnter","mouseleave ._action":"onActionMouseLeave"},initialize:function(){this.listenTo(this.state,"change:shown",this.render),this.listenTo(this.state,"change:selectAll",this.toggleSelectAll),this.listenTo(this.collection,"reset update",this.render)},serialize:function(){return{shown:this.state.get("shown"),selectAll:this.state.get("selectAll"),viewOnly:!this.isGranted("edit",!1)}},toggleSelectAll:function(){this.$("._select").prop("checked",this.state.get("selectAll"))},setState:function(e){this.state.set(e)},onSelectChange:function(e){e.stopPropagation();var t=a.$(e.currentTarget).is(":checked");this.setState({selectAll:t,shown:t}),this.selectCallback(t)},onCopyClick:function(e){e.stopPropagation(),this.copyCallback()},onMoveClick:function(e){e.stopPropagation(),this.moveCallback()},onDeleteClick:function(e){e.stopPropagation(),this.deleteCallback()},onActionMouseEnter:function(e){e.preventDefault(),this.setNotExistView("actionTooltip",l,{params:n.darkTitle,classes:{tooltip_dark:!0},content:new o({el:!1,template:function(){return e.currentTarget.getAttribute("data-title")}})}),this.getView("actionTooltip").show(e)},onActionMouseLeave:function(e){e.preventDefault(),this.getView("actionTooltip").remove()},selectCallback:s.noop,copyCallback:s.noop,moveCallback:s.noop,deleteCallback:s.noop,isGranted:s.noop})},1552:function(e,t,i){"use strict";var s=i(16).$,a=i(1551),o={whiteList:{html:[],head:[],body:["style"],font:["fase"],span:["style"],div:[],br:[],b:[],i:[],u:[]}};e.exports=function(e,t){var i,l,n=e,r=2e3;function c(e,t){i.contentWindow.document.queryCommandState(e)?t.addClass("active"):t.removeClass("active")}function d(){var e=s(i).contents().find("body").html().replace(/<(|\/)(span|div|b|i|u|br)(| )(|\/)>/gi,"").length,t=s(".note-form__actions .note-form__counter");e>r?t.addClass("too-much"):t.removeClass("too-much"),t.text(Math.max(r-e,0))}function h(){var e=s("<div>").addClass("note-form__actions");s('<i class="note-form__act-bold button-editor button-editor-bold" data-command="bold"><i></i></i>').appendTo(e),s('<i class="note-form__act-italic button-editor button-editor-italic" data-command="italic"><i></i></i>').appendTo(e),s('<i class="note-form__act-underline button-editor button-editor-underline" data-command="underline"><i></i></i>').appendTo(e),s('<i class="note-form__act-cancel button-editor button-editor-cancel _cancel-edit-notes"><i></i></i>').appendTo(e),s('<i class="note-form__act-save button-editor button-editor-save _save-notes"><i></i></i>').appendTo(e),s('<span class="note-form__counter">'+r+"</span>").appendTo(e);var t=s(i.contentWindow.document.getElementsByTagName("body")[0]);return s("[data-command]",e).off("click.editor").on("click.editor",function(){!function(e,t,s){i.contentWindow.focus();try{i.contentWindow.document.execCommand(e,!1,t)}catch(e){}i.contentWindow.focus(),c(e,s)}(s(this).attr("data-command"),null,s(this))}),s(i).closest("form").off("save.editor").on("save.editor",function(e,t){!function(e){var t=s(i).contents().find("body").html();n.attr("data-description",t).val(t),"function"==typeof e&&e()}(t)}),t.off("click.editor, keyup.editor, paste.editor").on("click.editor, keyup.editor, paste.editor",function(){s("[data-command]",e).each(function(){c(s(this).attr("data-command"),s(this))}),d()}),t.off("keydown.editor").on("keydown.editor",function(e){s(".note-form__actions .note-form__counter").text()-0<=0&&8!==e.keyCode&&46!==e.keyCode&&(e.preventDefault(),e.stopPropagation())}),e}void 0!==t?"string"==typeof(l=t)&&s(".note-form__iframe").contents().find("body").html(l):function(){var e=n.val();if(""===s.trim(e)&&(e="<br />"),i)return n.hide(),s(i).contents().find("body").html(e),s(i).show(),n.before(h()),!0;(i=document.createElement("iframe")).frameBorder=0,i.frameMargin=0,i.framePadding=0,i.className="note-form__iframe",n.after(i),s(i).css({"padding-bottom":20}),function e(t,s){if(!i)return!1;try{i.contentWindow.document.open(),i.contentWindow.document.write(a(t,o)),i.contentWindow.document.close()}catch(e){}if(document.contentEditable)return i.contentWindow.document.designMode="on",s(),!0;if(null!==document.designMode)try{return i.contentWindow.document.designMode="on",s(),!0}catch(e){}return setTimeout(function(){e(t,s)},500),!1}('<html><head></head><body style="cursor: auto; padding: 2px 2px; margin: 0; white-space: pre-wrap; word-wrap: break-word; font-family: Arial; font-size: 12px;">'+e+"</body></html>",function(){n.before(h()),n.attr("data-editor",1).hide(),d()})}()}},1553:function(e,t){e.exports=function(e){var t='<div class="note-editor"><i class="note-editor__points icon icon-three-points icon-three-points-big _switch"><i class="icon icon-point"></i><i class="icon icon-point"></i><i class="icon icon-point"></i></i><div class="note-editor__add-notes';return e.viewOnly&&(t+=" note-editor__add-notes_disabled"),(e.state.edit||e.folder.description)&&(t+=" hidden"),t+='"><i class="note-editor__add-icon icon icon-note',e.viewOnly||(t+=" _add-notes"),t+='"></i><span class="note-editor__add-text">'+this.tr("Click to add<br />notes to this folder.")+'</span></div><div class="note-editor__notes-box ',!e.state.edit&&e.folder.description||(t+=" hidden"),t+='"><div class="note-editor__notes _scroll"><span class="note-editor__title">'+this.tr("Notes")+':</span><div class="note-editor__text">'+e.folder.description+"</div></div>",e.viewOnly||(t+='<i class="note-editor__pencil icon icon-pencil _edit-notes"></i>'),t+='</div><div class="note-editor__form-box ',e.state.edit||(t+=" hidden"),t+='"><span class="note-editor__title">'+this.tr("Notes")+':</span><div class="note-editor__form note-form"><form class="_note-form"><textarea class="note-form__textarea" name="notes">'+(e.folder.description||"")+"</textarea></form></div></div></div>"}},1554:function(e,t,i){"use strict";var s=i(476),a=i(471),o=i(1553),l=i(638),n=i(637).spinner,r=i(1552);e.exports=a.extend({name:"FavoriteFolderNotes",el:!1,template:o,edit:!1,events:{"click ._switch":"onSwitchClick","click ._add-notes":"onAddNotesClick","click ._edit-notes":"onEditNotesClick","click ._save-notes":"onSaveNotesClick","click ._cancel-edit-notes":"onCancelEditNotesClick"},serialize:function(){return{state:{edit:this.edit},folder:this.getActiveFolder()?this.getActiveFolder().toJSON():{},viewOnly:!this.isGranted("edit",!1)}},clientAfterRender:function(){s.initialize(this.$("._scroll").get(0),{suppressScrollX:!0,wheelSpeed:.6}),this.shouldBeOpened&&(this.shouldBeOpened=!1,this.openEditor()),this.loading(!1)},loading:function(e){this.spinner||(this.spinner=new l(n)),this.spinner[e?"spin":"stop"](this.$("._note-form").get(0))},onSwitchClick:function(){this.toggleCallback(this.readPanelState().editor)},onAddNotesClick:function(){this.isGranted("auth edit")&&(this.folders.length?this.openEditor():(this.shouldBeOpened=!0,this.preparePanel()))},onEditNotesClick:function(){this.initSimpleEditor(),this.$(".note-editor__notes-box, .note-editor__form-box").toggleClass("hidden")},onSaveNotesClick:function(){var e=this;this.$("._note-form").trigger("save.editor",function(){e.loading(!0);var t=e.$(".note-form__textarea").val().replace(/(<(div|span)>)*((<br(\s+)*\/*>)|\s+|(&nbsp;)+)*(<\/\2>)*/gi,"");e.updateFolderCallback({description:t.length?e.$(".note-form__textarea").val():""})})},onCancelEditNotesClick:function(){this.render()},initSimpleEditor:function(){r(this.$(".note-form__textarea"))},openEditor:function(){this.initSimpleEditor(),this.$(".note-editor__add-notes, .note-editor__form-box").toggleClass("hidden")},updateView:function(e){this.$(".note-editor__form-box").toggleClass("note-editor__form-box_compact",e)},setFolder:function(e){e&&(this.model=e,this.listenTo(this.model,"change:description",this.render),this.render())},updateFolderCallback:function(){},readPanelState:function(){},getActiveFolder:function(){},toggleCallback:function(){},preparePanel:function(){},isGranted:function(){}})},1555:function(e,t){e.exports=function(e){var t="",i=e.files;if(i)for(var s,a=-1,o=i.length-1;a<o;)s=i[a+=1],"wide"===e.thumbSize?(t+='<div data-id="'+s.id+'" class="file-box file-wide-box folder-file-box _favorite-file',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" file-box_selected"),t+='"',e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].boxStyle+'"'),t+='><a class="file-wide-box__link _file-box-link" href="'+s.url+'"',e.itemsData[s.id]&&(t+=' style="',"video"!==s.type?t+=""+e.itemsData[s.id].holderStyle:t+=""+e.itemsData[s.id].linkStyle,t+='"'),t+='><span class="file-wide-box__holder file-box-image _file-box-holder _file-box-image"><img src="'+s.thumbs[e.thumbSizes[e.panel.thumbs]]+'" class="file-wide-box__image',s.width>s.height?t+=" file-wide-box__image_v":s.width<s.height?t+=" file-wide-box__image_h":t+=" file-wide-box__image_s","video"===s.type&&(t+=" file-wide-box__image_video"),t+=' _file-box-image-src" ',e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].imageStyle+'"'),t+=' /></span></a><div class="file-wide-box__info"><div class="file-box__indicator"><span class="file-box__indicator-item label label-in-cart _label-in-cart ',s.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span></div></div><span class="file-wide-box__control _prevent"><i class="file-box__control-item',e.viewOnly?t+=" file-box__control-item_disabled ":t+=" _delete",t+=' icon icon-item-remove"></i><i class="file-box__control-item',e.viewOnly&&(t+=" file-box__control-item_disabled"),t+=' icon icon-item-move"></i><i class="file-box__control-item icon icon-checkbox icon-checkbox-l _select',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" checked"),t+='"></i><span class="file-box__blur"><img class="file-box__blur-image" src="'+s.thumbs[e.panel.thumbs]+'" style="filter: url(#blur'+s.id+')" />\x3c!--[if !(lte IE 8)]><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0"><filter id="blur'+s.id+'"><feGaussianBlur in="SourceGraphic" stdDeviation="10" /></filter></svg><![endif]--\x3e</span></span></div>'):(t+='<div data-id="'+s.id+'" class="file-box folder-file-box _favorite-file',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" file-box_selected"),t+='"><a class="file-box__link" href="'+s.url+'"><span class="file-box__holder"><span class="file-box-image file-box__image-holder',s.width>s.height&&s.height/s.width<.5&&(t+=" file-box__image-holder_limit"),t+='"style="background-image: url('+s.thumbs[e.thumbSizes[e.panel.thumbs]]+')"></span><span class="file-box-video"></span></span><span class="file-box__indicator"><span class="file-box__indicator-item label label-in-cart _label-in-cart ',s.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span></span><span class="file-box__control _prevent"><i class="file-box__control-item',e.viewOnly?t+=" file-box__control-item_disabled ":t+=" _delete",t+=' icon icon-item-remove"></i><i class="file-box__control-item',e.viewOnly&&(t+=" file-box__control-item_disabled"),t+=' icon icon-item-move"></i><i class="file-box__control-item icon icon-checkbox icon-checkbox-l _select',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" checked"),t+='"></i><span class="file-box__blur"><img class="file-box__blur-image" src="'+s.thumbs[e.panel.thumbs]+'" style="filter: url(#blur'+s.id+')" />\x3c!--[if !(lte IE 8)]><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0"><filter id="blur'+s.id+'"><feGaussianBlur in="SourceGraphic" stdDeviation="10" /></filter></svg><![endif]--\x3e</span></span></a></div>');return t}},1556:function(e,t){e.exports=function(e){var t='<div class="fav-panel__files-list"><div class="files-list files-list_favorites files-list_layout-'+e.layoutSizes[e.panel.thumbs]+'">',i=e.files;if(i)for(var s,a=-1,o=i.length-1;a<o;)s=i[a+=1],"wide"===e.thumbSize?(t+='<div data-id="'+s.id+'" class="file-box file-wide-box folder-file-box _favorite-file',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" file-box_selected"),t+='"',e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].boxStyle+'"'),t+='><a class="file-wide-box__link _file-box-link" href="'+s.url+'"',e.itemsData[s.id]&&(t+=' style="',"video"!==s.type?t+=""+e.itemsData[s.id].holderStyle:t+=""+e.itemsData[s.id].linkStyle,t+='"'),t+='><span class="file-wide-box__holder file-box-image _file-box-holder _file-box-image"><img src="'+s.thumbs[e.thumbSizes[e.panel.thumbs]]+'" class="file-wide-box__image',s.width>s.height?t+=" file-wide-box__image_v":s.width<s.height?t+=" file-wide-box__image_h":t+=" file-wide-box__image_s","video"===s.type&&(t+=" file-wide-box__image_video"),t+=' _file-box-image-src" ',e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].imageStyle+'"'),t+=' /></span></a><div class="file-wide-box__info"><div class="file-box__indicator"><span class="file-box__indicator-item label label-in-cart _label-in-cart ',s.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span></div></div><span class="file-wide-box__control _prevent"><i class="file-box__control-item',e.viewOnly?t+=" file-box__control-item_disabled ":t+=" _delete",t+=' icon icon-item-remove"></i><i class="file-box__control-item',e.viewOnly&&(t+=" file-box__control-item_disabled"),t+=' icon icon-item-move"></i><i class="file-box__control-item icon icon-checkbox icon-checkbox-l _select',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" checked"),t+='"></i><span class="file-box__blur"><img class="file-box__blur-image" src="'+s.thumbs[e.panel.thumbs]+'" style="filter: url(#blur'+s.id+')" />\x3c!--[if !(lte IE 8)]><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0"><filter id="blur'+s.id+'"><feGaussianBlur in="SourceGraphic" stdDeviation="10" /></filter></svg><![endif]--\x3e</span></span></div>'):(t+='<div data-id="'+s.id+'" class="file-box folder-file-box _favorite-file',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" file-box_selected"),t+='"><a class="file-box__link" href="'+s.url+'"><span class="file-box__holder"><span class="file-box-image file-box__image-holder',s.width>s.height&&s.height/s.width<.5&&(t+=" file-box__image-holder_limit"),t+='"style="background-image: url('+s.thumbs[e.thumbSizes[e.panel.thumbs]]+')"></span><span class="file-box-video"></span></span><span class="file-box__indicator"><span class="file-box__indicator-item label label-in-cart _label-in-cart ',s.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span></span><span class="file-box__control _prevent"><i class="file-box__control-item',e.viewOnly?t+=" file-box__control-item_disabled ":t+=" _delete",t+=' icon icon-item-remove"></i><i class="file-box__control-item',e.viewOnly&&(t+=" file-box__control-item_disabled"),t+=' icon icon-item-move"></i><i class="file-box__control-item icon icon-checkbox icon-checkbox-l _select',-1!==e.listOfSelected.indexOf(s.id)&&(t+=" checked"),t+='"></i><span class="file-box__blur"><img class="file-box__blur-image" src="'+s.thumbs[e.panel.thumbs]+'" style="filter: url(#blur'+s.id+')" />\x3c!--[if !(lte IE 8)]><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0"><filter id="blur'+s.id+'"><feGaussianBlur in="SourceGraphic" stdDeviation="10" /></filter></svg><![endif]--\x3e</span></span></a></div>');return t+='</div><div class="folder-file-box folder-file-box_loading _favorite-spinner"></div></div>'}},1557:function(e,t,i){"use strict";e.exports.favorites={items:"._favorite-file",containment:"parent",tolerance:"pointer",helper:"clone",scroll:!1,zIndex:9999,distance:5,revert:!1,delay:150,placeholder:"file-box_shadow folder-file-box file-box _shadow"}},1599:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(16),l=i(638),n=i(519),r=i(126),c=i(22),d=i(130),h=i(1028),u=i(686),p=i(1557).favorites,f=i(637).spinner,m=i(1556),v=i(1555),g={normal:112,big:172},b={normal:"big",big:"bigWide"},_=n.extend({name:"FavoriteFilesList",el:!1,template:m,templatePartial:v,thumbSize:"normal",asyncFileViewModalLoad:!1,spinner:null,events:(0,s.default)({},n.prototype.events,{"mouseenter ._favorite-file":"onFavoriteFileMouseEnter","mouseleave ._favorite-file":"onFavoriteFileMouseLeave","click ._prevent":"youShallNotPass","click ._select":"onSelectClick","click ._delete":"onDeleteClick"}),globals:(0,s.default)({},n.prototype.globals,{"resize window":"onWindowResize"}),initialize:function(){var e=this;this.listenTo(this.collection,{sort:this.render,request:function(t,i,s){return void 0===s&&(s={}),s.reset&&e.loading(!0,"panel")},sync:function(t,i,s){return void 0===s&&(s={}),s.reset&&e.loading(!1,"panel")}}),this.listenToCollection(),this.setFileEventsListeners()},prepareRender:function(){this.panelState=this.readPanelState(),this.thumbSize=this.panelState.thumbs},serialize:function(){return(0,s.default)({},this.getRenderData(),{files:this.collection.toJSON(),viewOnly:!this.isGranted("edit",!1),thumbSizes:b,layoutSizes:{normal:"normal",big:"big"},thumbSize:this.thumbSize})},clientAfterRender:function(){this.favoritesListAfterRenderCallback(),this.favoriteArrangeFiles(),this.initSortable(),this.isGranted("edit",!1)?this.enableSortable():this.disableSortable()},getRenderData:function(){return{itemsData:this.getItemsData(),listOfSelected:this.getSelectedFilesPlain(),panel:this.panelState}},getItemsData:function(){var e=this,t={};if(!this.collection.length||"wide"!==this.thumbSize)return t;var i=this.getItemsDimensions("wide");return 0===this.holderWidth?a.each(i,function(e){t[e.id]={boxStyle:{},linkStyle:{},holderStyle:{width:e.w,height:e.h,paddingLeft:"0",paddingRight:"0"}}}):t=this.getWideItemsData(i,d.config.tinyWideSize),a.each(t,function(t){t.boxStyle=e.convertStyleToString(t.boxStyle),t.linkStyle=e.convertStyleToString(t.linkStyle),t.holderStyle=e.convertStyleToString(t.holderStyle),t.imageStyle=e.convertStyleToString(t.imageStyle)}),t},loading:function(e,t){var i=this,s=t,o={thumb:this.$("._favorite-spinner"),panel:this.$el};this.spinner||(this.spinner=new l(f)),a.isUndefined(s)&&(s="panel"),"thumb"===s?o[s][e?"show":"hide"]():"panel"===s&&o[s][e?"addClass":"removeClass"]("loading"),e?this.spinner.spin(o[s].get(0)):a.each(o,function(e){return i.spinner.stop(e.get(0))})},initSortable:function(){var e=this;h.initSortable(),this.$el.parent().sortable((0,s.default)({},p,{containment:!1,start:function(t,i){i.helper&&(e.collection.length||i.helper.hasClass("_favorite-file")||(e.toggleNoFiles(!1),i.placeholder.remove().prependTo(e.$el)),i.placeholder.css({marginRight:e.$("._favorite-file").css("margin-right")}),e.$(i.helper).css({marginTop:o.$(window).scrollTop()}))},over:function(t,i){i.helper&&!i.helper.hasClass("_favorite-file")&&(i.helper.css({width:"auto",height:"auto"}),i.placeholder.appendTo(e.$(".files-list")),e.app.observer.fire("Draggable:switchHelper",(0,s.default)({},{mode:"favorite",thumbSizes:b},e.getRenderData())))},out:function(t,i){i.helper&&!i.helper.hasClass("_favorite-file")&&(i.helper.css({width:"auto",height:"auto"}),e.app.observer.fire("Draggable:switchHelper"),e.collection.length||e.toggleNoFiles(!0))},sort:function(t,i){var s=e.$("._favorite-file"),a=i.position.top+e.$el.parent().scrollTop();if(navigator&&navigator.mozApps&&(a+=window.scrollY),i.helper.css({top:a+"px"}),s.length){var o=s.last(),l=o.offset();(i.offset.top>l.top&&i.offset.left>l.left||i.offset.top>l.top+o.height())&&i.placeholder.remove().appendTo(e.$(".files-list"))}},update:function(t,i){var s=i.item.data("id")||i.item.find("[data-id]").data("id");i.item.hasClass("_favorite-file")?(i.item.replaceWith(i.placeholder),e.sortableUpdateCallback(s,i.placeholder.index())):e.collection.get(s)?(i.placeholder.remove(),i.item.remove()):(e.app.user.isLoggedIn()?i.item.replaceWith(i.placeholder):(i.item.remove(),e.toggleNoFiles(!0)),e.sortableUpdateCallback(s,i.placeholder.index()))}}))},onFavoriteFileMouseEnter:function(e){var t=o.$(e.currentTarget),i=t.position(),s=t.width(),a=t.height();this.$el.height()-(i.top+a)<a/2&&i.left<s&&t.data("layered",!0).addClass("folder-file-box-magic-layered")},onFavoriteFileMouseLeave:function(e){o.$(e.currentTarget).data("layered")&&o.$(e.currentTarget).data("layered",!1).removeClass("folder-file-box-magic-layered")},onSelectClick:function(e){e.stopPropagation(),e.preventDefault(),this.toggleSelection(o.$(e.currentTarget).closest("._favorite-file"))},onDeleteClick:function(e){e.stopPropagation(),e.preventDefault(),this.deleteCallback(+o.$(e.currentTarget).closest("._favorite-file").attr("data-id"))},onWindowResize:a.throttle(function(){r.favoritesPanelIsVisible()&&this.favoriteArrangeFiles()},10),toggleSelection:function(e){var t=!e.find("._select").hasClass("checked"),i=e.attr("data-id");this.toggleThumbSelection(e,t),this.updateCacheSelection(i,t),this.checkCacheSelection()},toggleThumbSelection:function(e,t){e.length&&e.toggleClass("file-box_selected",t).find("._select").toggleClass("checked",t)},updateCacheSelection:function(e,t){this.app.store.get("FolderCache").findWhere({id:parseInt(e,10)}).set({selected:t})},updateSortable:function(){this.$el.parent().sortable("refresh")},enableSortable:function(){this.$el.parent().sortable("enable")},disableSortable:function(){this.$el.parent().sortable("disable")},youShallNotPass:function(e){e.stopPropagation(),e.preventDefault()},favoriteArrangeFiles:function(){if("wide"===this.thumbSize)this.arrangeFiles("wide");else{var e=g[this.panelState.thumbs],t=c.getArrangeFilesSizes(e,this.el.offsetWidth,3),i=this.$("._favorite-file");a.each(i,function(e){e.style.marginRight=t.margin+"px"})}},favoritesListAfterRenderCallback:function(){},sortableUpdateCallback:function(){},checkCacheSelection:function(){},getSelectedFilesPlain:function(){},readPanelState:function(){},deleteCallback:function(){},toggleNoFiles:function(){},isGranted:function(){},onFavoritesPanelCacheUpdate:function(){},markFavorites:function(){}});(0,s.default)(_.prototype,u),e.exports=_},1601:function(e,t,i){"use strict";var s=i(1),a=s(i(12)),o=s(i(4)),l=i(0),n=i(476),r=i(664).default,c=i(471),d=i(473),h=i(911),u=i(1599),p=i(1554),f=i(1547),m=i(1545),v=i(1543),g=i(1541),b=i(1537),_=i(1015),w=i(1533),x=i(662),k=i(1532),y=i(694),C=i(9),F=i(1526),S=i(489),M=i(1525),T=i(1012),z=i(1010),P=i(1009),L=i(729),A=i(1524),D=i(1008),E=i(1007),I=i(1523),R=i(472),N=i(1519),V=i(63),B=i(904),O={normal:132,big:192,offset:20},$=C.extend({defaults:{open:!1,editor:!1,folderID:null,thumbs:"normal",liftLevel:2}}),U=i(1518),W={EmptySelection:F,Signup:S,NeedPermission:M,CreateFolder:T,EditFolder:z,DeleteFolder:P,ShareFolder:L,CopyFiles:A,MoveFiles:D,DeleteFiles:E};e.exports=c.extend({name:"FavoritesPanel",el:!1,template:U,listenToRooms:[],events:{"click ._pull":"onPanelPullerClick","click ._close":"onPanelCloseClick","click ._cart":"onCartFilesClick","click ._create":"onCreateFolderClick","click ._options":"onOptionsClick","click ._edit-mode":"onEditModeClick","click ._layout":"onLayoutClick","ps-scroll-down ._scroll":"onPanelScroll","mouseenter ._action":"onActionMouseEnter","mouseleave ._action":"onActionMouseLeave"},initialize:function(){var e=this;this.state=new $(this.app.userSettings.get("FavoritesPanel"),{app:this.app}),this.folders=new _([],{app:this.app,initPageFromQueryParam:!1}),this.permissions=new x([],{app:this.app}),this.cache=new w([],{app:this.app}),this.collection=new k([],{filters:{id:null},pager:{limit:60,page:1},endless:!0,app:this.app}),this.app.store.link("FolderCache",this.cache),this.listenTo(this.state,"change:folderID",this.onStateFolderIdChange),this.listenTo(this.collection,"update",this.actualizeCache),this.listenTo(this.cache,"reset update",this.folderCacheUpdateCallback),this.listenTo(this.folders,{update:this.foldersResetAndUpdateCallback,reset:this.foldersResetAndUpdateCallback,sync:this.folderTour}),this.listenTo(this.app.observer,{"Favorites:OpenPanel":this.openPanel,"Favorites:ToggleFile":this.toggleFile,"Favorites:TogglePanel":this.togglePanel,"Favorites:FolderPermissionsChanged":function(t){var i=t.cid,s=t.folderId;e.permissions.cid!==i&&e.permissions.getQueryParams.folderId===s&&e.fetchPermissions(),e.folders.get(s)&&e.fetchFolders()},"Sidebar:PurchaseComplete":this.fetchFolders}),this.setViews({"._folders":new h({app:this.app,className:"fav-panel__select",state:this.state,collection:this.folders,getActiveFolder:this.getActiveFolder.bind(this),getSelectedFolder:this.getActiveFolder.bind(this),onFoldersChange:this.onFoldersSelectCallback.bind(this)}),"._files":new u({app:this.app,collection:this.collection,isGranted:this.isGranted.bind(this),getSelectedFilesPlain:this.getSelectedFilesPlain.bind(this),readPanelState:this.readPanelState.bind(this),toggleNoFiles:this.toggleNoFiles.bind(this),deleteCallback:this.deleteFile.bind(this),sortableUpdateCallback:this.updateSorting.bind(this),checkCacheSelection:this.checkCacheSelection.bind(this),favoritesListAfterRenderCallback:this.favoritesListAfterRenderCallback.bind(this)}),"._no-files":new v({app:this.app,readPanelState:this.readPanelState.bind(this)}),"._editor":new p({app:this.app,folders:this.folders,getActiveFolder:this.getActiveFolder.bind(this),isGranted:this.isGranted.bind(this),toggleCallback:this.toggleEditor.bind(this),readPanelState:this.readPanelState.bind(this),updateFolderCallback:this.updateFolder.bind(this),preparePanel:this.autoCreateFolder.bind(this)}),"._files-menu":new f({app:this.app,collection:this.collection,isGranted:this.isGranted.bind(this),selectCallback:this.selectAllFiles.bind(this),copyCallback:this.copyFiles.bind(this),moveCallback:this.moveFiles.bind(this),deleteCallback:this.deleteFiles.bind(this)}),"._msg-box":new b({app:this.app,state:this.state,collection:this.collection,openPanelCallback:this.openPanel.bind(this),getActiveFolder:this.getActiveFolder.bind(this)}),"._folder-users":new g({app:this.app,state:this.state,folders:this.folders,collection:this.permissions,isGranted:this.isGranted.bind(this),shareCallback:this.shareFolder.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})})},favoritesListAfterRenderCallback:function(){n.update(this.$("._scroll").get(0)),this.toggleNoFiles()},serialize:function(){var e="normal"===this.state.get("thumbs")?"big":"normal";return{isEnterpriseUser:this.app.user.isEnterprise(),user:this.app.user.clone(),state:this.state.clone(),layoutIconClasses:"icon-thumbs-"+e,folder:this.getActiveFolder()?this.getActiveFolder().clone():{},panelHeight:this.getStoreyHeight()*this.state.get("liftLevel")+O.offset,liftLevels:{min:1,max:4}}},clientAfterRender:function(){var e=this;window.panel=this,this.isOpened()&&this.webSocketInit(),this.isNeedToFetchFolders()&&this.fetchFolders({reset:!0}),this.setView("options",new d({name:"FavoritesPanelOptions",app:this.app,params:R.FavoritesPanelOptions,classes:{"tooltip_extra-shadow":!0},content:new m({getActiveFolder:this.getActiveFolder.bind(this),isGranted:this.isGranted.bind(this),shareCallback:this.shareFolder.bind(this),moveCallback:this.moveFolder.bind(this),editCallback:this.editFolder.bind(this),deleteCallback:this.deleteFolder.bind(this),previewCallback:this.previewFolder.bind(this)})})),n.initialize(this.$("._scroll").get(0),r),this.lift=new N({el:this.$("._panel .fav-panel__wrapper"),getStoreyHeight:this.getStoreyHeight.bind(this),levels:{min:1,max:4,defaultValue:this.state.get("liftLevel")},offset:O.offset}),this.listenTo(this.lift,"afterChangeLevel",function(t){return e.updatePanelState({liftLevel:t[0]})})},webSocketInit:function(){var e=this;this.app.user.isLoggedIn()&&this.app.features.isFeatureOnValue("Folder websockets enabled")&&B.init(this.app).then(function(t){e.webSocketClient=t,e.webSocketClient.on("disconnected",function(){e.listenToRooms=[]}),e.webSocketClient.on("message",function(t){return e.webSocketProcessMessage(t)}),e.webSocketSubscribeToChannel()})},webSocketSubscribeToChannel:function(){var e=this,t=this.state.get("folderID"),i=this.app.user.get("id");this.webSocketClient&&t&&!this.listenToRooms.includes(t)&&this.webSocketClient.action("api/favorites/connectUser",{folderId:t,userId:i},function(){return e.listenToRooms.push(t)})},webSocketProcessMessage:function(e){var t=e.message||{},i=t.windowId!==this.app.uid,s=parseInt(t.lightboxId,10),a=s===this.state.get("folderID"),o=void 0!==this.folders.get(s);if(i)switch(t.action){case"items_update":a&&this.webSocketProcessItemsMessage(t);break;case"meta_update":o&&this.fetchFolders();break;case"permissions_update":a&&this.fetchPermissions(),o&&this.fetchFolders()}},webSocketProcessItemsMessage:function(e){var t=e.apiData,i=void 0===t?{}:t,s=e.itemsAdded,a=void 0===s?[]:s,o=i.dp_command,l=i.dp_media_id,n=this.state.get("folderID"),r=this.getActiveFolder(),c=r?r.get("count"):0;switch(o){case"addToLightbox":(i.dp_position<=this.collection.length-1||i.dp_position===this.collection.length&&c===this.collection.length)&&this.collection.add(a,{at:i.dp_position,parse:!0});break;case"removeFromLightbox":this.collection.remove(l);break;case"copyItemsInternal":i.dp_target_lightbox_id===n&&this.fetchFolderDependencies(!0);break;case"moveItemsInternal":i.dp_source_lightbox_id===n&&this.collection.remove(i.dp_media_ids),i.dp_target_lightbox_id===n&&this.fetchFolderDependencies(!0);break;case"changeItemsPositionInternal":this.webSocketProcessChangeItemsPosition(i)}},webSocketProcessChangeItemsPosition:function(e){var t=parseInt(e.dp_item_id,10),i=parseInt(e.dp_position,10)||0,s=this.collection.get(t);s&&this.collection.indexOf(s)!==i&&this.collection.add(this.collection.remove(s,{silent:!0}),{at:i})},resetPanelToEmptyState:function(){this.updatePanelState({folderID:null}),this.collection.reset(),this.cache.reset(),this.getView("._editor").render(),this.checkFileToAddQueue()},foldersResetAndUpdateCallback:function(e,t){var i=t.created,s=t.reset;e.isEmpty()?this.resetPanelToEmptyState():i||!e.get(this.state.get("folderID"))?this.updatePanelState({folderID:e.first().get("id")}):s&&this.onStateFolderIdChange()},onStateFolderIdChange:function(){this.webSocketSubscribeToChannel(),this.selectAllFiles(!1),this.setFolderToEditor(),this.fetchFolderDependencies()},onFoldersSelectCallback:function(e){this.updatePanelState({folderID:parseInt(e,10)})},fetchFolderDependencies:function(e){var t=this.state.get("folderID")!==this.collection.getFilters("id");(e||t)&&(this.fetchPermissions(),this.fetchCache(),this.fetchFiles())},folderTour:function(){var e=this;if("folder"!==this.app.queryParams.tour){if(this.app.user.isLoggedIn()&&this.app.features.isFeatureEnabled("New Folder Tour")){var t=this.app.features.get("New Folder Tour"),i=t?t.get("value"):{minFiles:10,useSite:0},s=this.app.userSettings.get("newFolderTourViewed"),a=this.folders.find(function(e){return e.get("count")>=i.minFiles}),o=(Date.now()-this.app.user.get("registered"))/1e3>=60*i.useSite*60*24;l.delay(function(){if(!s&&a&&o){var t=e.app.userSettings.get("newFolderTourShown");(!t||t+432e3<Math.round(Date.now()/1e3))&&e.showFolderTour()}},2e3)}}else this.showFolderTour()},showFolderTour:function(){this.setView("FolderTourModal",new I({app:this.app})).show()},actualizeCache:function(e,t){var i=t.changes,s=t.at;if(i){var a=i.added.map(function(e){return{id:e.get("id")}}),o=i.removed.map(function(e){return e.get("id")});this.cache.add(a,{at:s,silent:!0}),this.cache.remove(o,{silent:!0}),this.cache.trigger("update",this.cache,{changes:i,at:s,refetch:!0})}},getSelectedFiles:function(){return this.cache.where({selected:!0})},getSelectedFilesPlain:function(){return this.getSelectedFiles().map(function(e){return e.get("id")})},getSelectedFilesPositionsPlain:function(e){var t=this;return e.map(function(e){return t.cache.indexOf(t.cache.get(e))})},selectAllFiles:function(e){void 0===e&&(e=!0),this.isGranted("auth")&&(this.cache.each(function(t){return t.set({selected:e})}),this.getView("._files").render(),this.checkCacheSelection())},fetchFolders:function(e){return this.folders.getQueryParams={limit:2e3,offset:0},this.folders.fetch(e)},fetchCache:function(){var e=this.getActiveFolder();e&&(this.cache.getQueryParams={id:e.get("id")},this.cache.fetch({reset:!0}))},fetchFiles:function(){this.$("._scroll").scrollTop(0),this.collection.setFilters({id:this.state.get("folderID")}),this.collection.fetchPage(1,{reset:!0})},fetchPermissions:function(){return this.permissions.getQueryParams={folderId:this.state.get("folderID")},this.permissions.fetch({reset:!0})},innerCreateFolder:function(e){return this.folders.createFolder(e)},innerUpdateFolder:function(e){var t=this;return this.folders.updateFolder(this.state.get("folderID"),e).then(function(){t.getView("._folders").render(),t.getView("._editor").render(),t.app.observer.fire("Notification",{type:"success"})})},innerDeleteFolder:function(){var e=this;return this.folders.deleteFolder(this.getActiveFolder().get("id")).then(function(){return e.app.observer.fire("Notification",{type:"success"})})},innerAddFile:function(e,t){var i=this;void 0===t&&(t=0),this.folders.length?this.collection.addFile(e,this.getActiveFolder().get("id"),t):this.autoCreateFolder().then(function(){return i.collection.addFile(e,i.getActiveFolder().get("id"),t)})},innerCartFiles:function(e){var t=this;this.app.observer.fire("Cart:add",{fileId:e}),this.app.observer.fire("Notification",{type:"success"}),this.app.observer.broadcast("Track:UE:FavoritesPanel:AddToCart",{file:e.map(function(e){var i=t.collection.get(e);return(0,o.default)(i.toJSON(),{position:t.collection.indexOf(i)})}),route:this.app.router.routeName,view:this.name})},innerCopyFiles:function(e){var t=this,i=this.getSelectedFilesPlain(),s=this.getSelectedFilesPositionsPlain(i);this.collection.copyFiles({items:i,positions:s,source:this.state.get("folderID"),target:e.folder}).then(function(){t.selectAllFiles(!1),t.fetchFolders(),t.app.observer.fire("Notification",{type:"success"})})},innerMoveFiles:function(e){var t=this,i=this.getSelectedFilesPlain(),s=this.getSelectedFilesPositionsPlain(i);this.collection.moveFiles({items:i,positions:s,source:this.state.get("folderID"),target:e.folder}).then(function(){t.selectAllFiles(!1),t.fetchFolders(),t.fetchCache(),t.app.observer.fire("Notification",{type:"success"})})},innerDeleteFile:function(e){var t=this,i=[e],s=this.cache.indexOf(this.cache.get(e));this.collection.deleteFiles({lightbox:this.state.get("folderID"),items:[e],positions:[s]}).then(function(){t.cache.remove(i),t.checkCacheSelection()})},innerDeleteFiles:function(){var e=this,t=this.getSelectedFilesPlain(),i=this.getSelectedFilesPositionsPlain(t);this.collection.deleteFiles({lightbox:this.state.get("folderID"),items:t,positions:i}).then(function(){e.selectAllFiles(!1),e.cache.remove(t),e.app.observer.fire("Notification",{type:"success"})})},createFolder:function(){var e=this;this.isGranted("auth")&&this.callModal("CreateFolder").show({model:new y({},{app:this.app})}).then(function(t){return e.innerCreateFolder(t)})},updateFolder:function(){return this.innerUpdateFolder.apply(this,arguments)},editFolder:function(){var e=this;this.isGranted("auth edit")&&this.callModal("EditFolder").show({model:this.getActiveFolder()}).then(function(t){return e.innerUpdateFolder(t)})},shareFolder:function(){this.isGranted("auth")&&this.callModal("ShareFolder",{model:this.getActiveFolder(),collection:this.collection,permissions:this.permissions}).show()},deleteFolder:function(){this.isGranted("auth")&&this.callModal("DeleteFolder").show({model:this.getActiveFolder()}).then(this.innerDeleteFolder.bind(this))},previewFolder:function(e){this.isGranted("auth")&&this.updatePanelState({preview:e})},moveFolder:function(){var e=this;this.isGranted("auth edit")&&(this.selectAllFiles(),this.isGranted("selection")&&this.callModal("MoveFiles",{getActiveFolder:function(){return e.getActiveFolder()},folders:this.folders}).show().then(this.innerMoveFiles.bind(this)))},toggleFile:l.throttle(function(e){var t=0|e.id;this.cache.get(t)?this.deleteFile(t):this.addFile(t)},400),cartFiles:function(){this.isGranted("auth selection")&&this.innerCartFiles(this.getSelectedFilesPlain())},copyFiles:function(){var e=this;this.isGranted("auth selection")&&this.callModal("CopyFiles",{getActiveFolder:function(){return e.getActiveFolder()},folders:this.folders}).show().then(function(t){return e.innerCopyFiles(t)})},moveFiles:function(){var e=this;this.isGranted("auth selection edit")&&this.callModal("MoveFiles",{getActiveFolder:function(){return e.getActiveFolder()},folders:this.folders}).show().then(function(t){return e.innerMoveFiles(t)})},deleteFile:function(){this.isGranted("auth edit")&&this.innerDeleteFile.apply(this,arguments)},deleteFiles:function(){this.isGranted("auth selection edit")&&this.callModal("DeleteFiles").show().then(this.innerDeleteFiles.bind(this))},updateSorting:function(e,t){var i=this;this.collection.get(e)?this.cache.reorder(e,t).then(function(){i.cache.add(i.cache.remove(e,{silent:!0}),{at:t,silent:!0}),i.collection.add(i.collection.remove(e,{silent:!0}),{at:t})}):this.addFile(e,t)},addFile:function(e,t){e&&(this.isGranted("auth edit")?(this.app.store.unlink("FileForFavorite"),this.innerAddFile(e,t)):this.updateCookieState({key:"nonAuthFavFileAdding",value:e}))},callModal:function(e,t){return this.insertView(e,new W[e]((0,o.default)({app:this.app,destroyOnHide:!0},t)))},readPanelState:function(){return this.state.clone()},updatePanelState:function(e){e.liftLevel&&(this.updateNoFilesSlider(e.liftLevel),this.updateNotesEditor(e.liftLevel)),this.state.set(e),this.app.userSettings.set({FavoritesPanel:this.state.clone()}),this.updateCookieState()},updateCookieState:function(e){var t={expires:"1Y"};if(e)V.set(e.key,e.value,t);else{var i=l.omit(this.state.attributes,["open","folderID","liftLevel"]);i.visible=this.state.get("open"),i.lightbox=this.state.get("folderID"),i.thumbs="big"===i.thumbs?"medium":"small",V.set("10_lbpSettings",(0,a.default)(i),t),V.set("10_currentLevel",this.state.get("liftLevel"),t)}},updateNoFilesSlider:function(e){this.getView("._no-files").updateSize(e)},updateNotesEditor:function(e){this.getView("._editor").updateView(e&&1===e)},getActiveFolder:function(){return this.folders.get(this.state.get("folderID"))||this.folders.first()},toggleNoFiles:function(e){void 0===e&&(e=!this.collection.length),e?(this.$("._no-files").removeClass("hidden"),this.$("._files").addClass("fav-panel__files_hidden")):(this.$("._no-files").addClass("hidden"),this.$("._files").removeClass("fav-panel__files_hidden"))},isGranted:function(e,t){var i=this;if(void 0===t&&(t=!0),!["string","object"].includes(typeof e))return!1;var s="string"==typeof e?e.split(" "):e,a={auth:{rule:function(){return i.app.user.isLoggedIn()},handler:function(){return i.callModal("Signup",{title:i.tr("Add to Favorites?")}).show()}},selection:{rule:function(){return i.getSelectedFiles().length>0},handler:function(){return i.callModal("EmptySelection").show()}},edit:{rule:function(){return i.canEditFolder()},handler:function(){return i.callModal("NeedPermission").show()}}};return l.every(s,function(e){var i=a[e]&&a[e].rule();return!i&&t&&a[e].handler(),i})},isNeedToFetchFolders:function(){return this.app.user.isLoggedIn()&&!this.folders.length},getStoreyHeight:function(){return O[this.readPanelState().thumbs]},canEditFolder:function(){var e=this.getActiveFolder();return!!e&&"edit"===e.get("permission")},autoCreateFolder:function(){return this.innerCreateFolder({title:"",isPublic:!0})},checkCacheSelection:function(){var e=this.cache.length&&!this.cache.find(function(e){return!e.get("selected")}),t=this.cache.find(function(e){return e.get("selected")});this.getView("._files-menu").setState({shown:t,selectAll:e})},checkFileToAddQueue:function(){var e=V.get("nonAuthFavFileAdding");e&&"null"!==e&&(this.updateCookieState({key:"nonAuthFavFileAdding",value:null}),this.openPanel(),this.innerAddFile(+e))},openPanel:function(){this.state.get("open")||this.togglePanel()},togglePanel:function(){this.$("._pull").toggleClass("hidden"),this.$("._panel").toggleClass("hidden");var e=this.isOpened();this.updatePanelState({open:e}),e?this.webSocketInit():this.webSocketClient&&this.webSocketClient.disconnect()},isOpened:function(){return!this.$("._panel").hasClass("hidden")},toggleEditor:function(e){var t=this;this.$("._editor").toggleClass("note-editor_closed",e),l.delay(function(){t.$("._container").toggleClass("note-editor_closed",e),t.getView("._files").favoriteArrangeFiles()},500),this.updatePanelState({editor:!e})},toggleLayout:function(){this.updatePanelState({thumbs:"normal"===this.readPanelState().thumbs?"big":"normal"}),this.$("._layout-icon").toggleClass("icon-thumbs-normal icon-thumbs-big"),this.getView("._files").render(),this.lift.trigger("adjust")},setFolderToEditor:function(e){this.getView("._editor").setFolder(e||this.getActiveFolder())},folderCacheUpdateCallback:function(e,t){var i=this.getActiveFolder();i&&(i.set({count:e.length},{observable:!0}),this.app.observer.fire("Favorites:PanelCacheUpdate",{folderId:i.get("id"),options:t}))},onPanelScroll:function(e){e.currentTarget.scrollHeight-2*e.currentTarget.clientHeight<=e.currentTarget.scrollTop&&this.collection.fetchNextPage()},onPanelPullerClick:function(){this.togglePanel()},onPanelCloseClick:function(){this.togglePanel()},onCreateFolderClick:function(){this.createFolder()},onCartFilesClick:function(){this.cartFiles()},onOptionsClick:function(e){this.isGranted("auth")&&this.getView("options").toggle(e)},onEditModeClick:function(){this.toggleEditor(this.state.get("editor"))},onLayoutClick:function(){this.toggleLayout()},onActionMouseEnter:function(e){this.setView("actionTooltip",new d({params:R.darkTitle,classes:{tooltip_dark:!0},content:new c({el:!1,template:function(){return e.currentTarget.getAttribute("data-title")}})})),this.getView("actionTooltip").show(e)},onActionMouseLeave:function(){this.safeRemoveView("actionTooltip")},getLiftLevel:function(){return this.lift.getCurrentLevel()}})},481:function(e,t){e.exports=function(e){var t='<div class="tooltip__custom tooltip__custom_justify">';return e.extendedMessage&&(t+="<p>"+this.tr("Use of this image in advertising or for promotional purposes is prohibited.")+"</p>"),t+=this.tr('<p>Any file downloaded from Depositphotos can be used for "editorial" purposes; the Standard License Agreement permits many uses for downloaded files, including for editorial use. Files downloaded under the Editorial Use Only license can be used only for non-commercial purposes.</p><p>For example, a file licensed for Editorial Use Only can be used to illustrate a news article on a blog or website, for purely descriptive purposes, in a non-commercial setting.</p><p class="d_last_tips_p">An Editorial Use Only file cannot be used in advertising or promotional material, or in any published work that involves the payment or receipt of a fee.</p>')+"</div>"}},483:function(e,t,i){"use strict";e.exports=function(e){e.each(function(e,t){var i=t.getAttribute("data-preload");if(i){var s=t.cloneNode(!0);s.src=i,s.removeAttribute("style"),s.removeAttribute("data-preload"),s.addEventListener("load",function e(){t.parentNode.replaceChild(s,t),s.removeEventListener("load",e),s=null,t=null})}})}},486:function(e,t,i){"use strict";var s=i(0),a=i(2),o=i(471),l=i(473),n=i(472),r=i(129).filePublishedFormat,c=i(564),d=i(481);e.exports=o.extend({name:"FileInfo",el:!1,template:c,viewMode:"page",events:{"mouseenter ._editorial-tooltip":"toggleEditorialTooltip","mouseleave ._editorial-tooltip":"toggleEditorialTooltip","click ._portfolio":"onPortfolioClick"},serialize:function(){return{isEnterpriseUser:this.app.user.isEnterprise(),file:s.clone(this.model.attributes),published:a.unix(this.model.get("published")).format(r),products:"page"===this.viewMode?this.app.user.serializeUserPlans():[],viewMode:this.viewMode,subscribeLink:this.app.makeUrl("subscribe",{backURL:!0,query:{ref:this.model.get("id")}}),portfolioLink:this.getPortfolioLink(),avatar:this.model.get("avatar")||this.app.user.avatar.constructor.prototype.defaults.default}},clientAfterRender:function(){this.model.get("editorial")&&this.setNotExistView("editorialTooltip",l,{params:n.ViewInfoEditorial,content:new o({el:!1,template:d})})},getPortfolioLink:function(){var e={};if("page"===this.viewMode)e.absolute=!0;else if(this.app.user.isEnterprise()&&this.app.store.get("SearchQuery")){var t=this.app.store.get("SearchQuery").getNonDefaults(["dataSource"]);s.has(t,"dataSource")&&(e.query={data_source:t.dataSource})}return this.app.makeUrl({route:"Search",seller:this.model.get("sellerId")},e)},toggleEditorialTooltip:function(e){this.getView("editorialTooltip").toggle(e)},onPortfolioClick:function(e){e.preventDefault(),this.app.observer.broadcast("Track:UE:Portfolio:Click",{sellerId:this.model.get("sellerId")}),this.app.router.redirect(e.currentTarget.href)},enabledCuratedCollection:s.noop})},491:function(e,t,i){"use strict";var s=i(0),a=i(569),o=i(567).base,l=i(62);e.exports=function(e,t,n){i(651),e.draggable(s.extend(o,{helper:function(){return t.getView("fileDraggableHelper")||t.setViews({fileDraggableHelper:new a(n.helperOptions)}),Backbone.$("<div></div>")},start:function(e,i){t.getView("fileDraggableHelper").active=!0,t.getView("fileDraggableHelper").setData(s.extend({},{model:n.helperOptions.getModel(e)},t.getView("fileDraggableHelper").getDefaults())).done(function(){return i.helper.append(t.getView("fileDraggableHelper").$el)})},drag:function(e,t){t.position.top>window.innerHeight+window.scrollY-t.helper.height()&&l.fire("Favorites:OpenPanel")},stop:function(e,i){i.helper.remove(),t.getView("fileDraggableHelper").active=!1}}))}},493:function(e,t,i){"use strict";var s=i(0),a=i(16),o=i(9),l=i(14);e.exports=o.extend({url:"Download",LEGACY_DOWNLOAD:!0,defaults:{itemId:null,size:null,source:"item",license:null,method:null,subscription:0,fileType:"image",resolution:"standart",splitCount:0,sizeMask:0,link:null,purchased:!1,"g-recaptcha-response":""},idAttribute:"link",initialize:function(){this.LEGACY_DOWNLOAD=this.LEGACY_DOWNLOAD&&"Legacy"===this.app.features.get("Download mode").get("value"),this.LEGACY_DOWNLOAD&&(this.url=this.app.makeUrl("cart/purchase"),this.getQueryParams=null,this.toJSON=this.getLegacyQuery)},getQueryParams:function(){return s.extend({},this.attributes)},parse:function(e){if(this.set("g-recaptcha-response",""),e.errors)return this.validationError=e.errors,this.trigger("invalid",this,e.errors,{validationError:e.errors}),{};var t=this.LEGACY_DOWNLOAD?e.data.link:e.downloadLink;return{link:l.urlFormat(s.extend(l.urlParse(t),{protocol:null}))}},requestLink:function(){this.attributes.link=null,this[this.LEGACY_DOWNLOAD?"saveData":"save"]()},saveData:function(e,t){void 0===e&&(e={}),void 0===t&&(t={}),t.data=this.toJSON(),t.emulateJSON=!0,t.emulateHTTP=!0,a.Model.prototype.save.call(this,e,t)},getLegacyQuery:function(){return s.extend(s.omit(this.attributes,"link"),{source:"view_item",id:this.get("itemId"),product:this.get("fileType"),split_count:this.get("splitCount"),subproduct:this.get("resolution")})}})},495:function(e,t,i){"use strict";var s=i(0),a=i(16).$,o=i(573),l=i(533),n=i(489),r=i(11).fileViewButtons;e.exports=o.extend({name:"FilesList",el:!1,autoScrollToStart:!1,events:{"click ._to-cart":"onCartClick","click ._to-favorites":"onFavoritesClick","click ._to-similar":"onSimilarClick","click ._cover":"onCoverClick","contextmenu .file-box":"onFileContextMenu"},trackImpression:function(){this.collection.length&&this.$el.is(":visible")&&this.app.observer.broadcast("Track:UE:File:UserSeeFileThumb",{files:this.collection.toJSON(),relatedMode:this.relatedMode,view:this.name})},setFileEventsListeners:function(){var e=this;this.on("clientAfterRender",this.markFavorites),this.listenTo(this.app.observer,{"Favorites:PanelCacheUpdate":this.onFavoritesPanelCacheUpdate,"Cart:added":function(t){return e.markCart(!0,t.fileId)},"Cart:removed":function(t){return e.markCart(!1,t.fileId)},"Folder:AddCover":function(t){return e.markCover(!0,t.fileId)},"Folder:RemoveCover":function(){return e.markCover(!1)}})},getFileThumbID:function(e){return+a(e).parents("[data-id]").data("id")},onCartClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.getFileModel(e.currentTarget);this.app.observer.broadcast(t.get("inCart")?"Track:UE:File:RemoveFromCart":"Track:UE:File:AddToCart",{id:t.get("id"),file:t.toJSON(),position:this.collection.indexOf(t),view:this.name}),this.app.observer.fire(t.get("inCart")?"Cart:remove":"Cart:add",{fileId:t.get("id")}),t.get("inCart")||this.app.user.isLoggedIn()||new n({app:this.app,title:this.tr("Add to Cart?"),subTitle:"video"===t.get("type")?this.tr('<span class="%s">Create your Account</span> to add this video to your Cart',"sub-text"):this.tr('<span class="%s">Create your Account</span> to add this image to your Cart',"sub-text")}).show()},onFavoritesClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.getFileModel(e.currentTarget);this.app.observer.broadcast(t.get("inFavorites")?"Track:UE:File:RemoveFromFavorites":"Track:UE:File:AddToFavorites",{id:t.get("id"),file:t.toJSON(),position:this.collection.indexOf(t),view:this.name}),t.get("inFavorites")||this.app.store.link("FileForFavorite",t),this.app.observer.fire("Favorites:ToggleFile",{id:t.get("id")})},onSimilarClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.getFileModel(e.currentTarget);this.app.observer.broadcast("Track:UE:File:ToSimilar",{file:t,position:this.collection.indexOf(t)+1});var i=t.makeRelatedUrl({relatedTo:"similar"});this.app.router.redirect(i)},onCoverClick:function(e){if(e.stopPropagation(),e.preventDefault(),this.$(e.currentTarget).hasClass("active"))this.app.observer.fire("Folder:RemoveCover");else{var t=this.getFileModel(e.currentTarget);this.coverCrop(t)}},onFileContextMenu:function(e){3===e.which&&this.app.observer.broadcast("Track:UE:File:OpenContextMenu",{file:this.collection.get(this.$(e.currentTarget).closest("[data-id]").data("id")),view:this.name})},onFavoritesPanelCacheUpdate:function(e){var t=e.folderId,i=e.options,s=void 0===i?{}:i,a=this.app.store.get("FolderCache"),o=this.app.store.get("Folder");if(a){var l=s.changes,n=s.refetch;if(this.collection.syncWithPanelCache&&o.get("id")===t){var r=l?l.added.map(function(e){return e.id}):[],c=l?l.removed.map(function(e){return e.id}):[];if(r.length&&n)return void this.collection.fetch();if(c.length)return void this.collection.remove(c)}this.markFavorites()}},markFavorites:function(){var e=this,t=this.app.store.get("FolderCache");t&&this.collection.each(function(i){var a=!!t.get(i.get("id")),o=a?"removeFavorites":"addToFavorites",l=s.findWhere(r,{key:o}).label;i.set({inFavorites:a});var n=e.$('[data-id="'+i.get("id")+'"]');n.find("._label-in-favorites").toggleClass("hidden",!a),n.find("._to-favorites").toggleClass("active",a).attr({title:l})})},markCart:function(e,t){var i=this,a=this.collection.where(function(e){return s.contains(t,e.get("id"))});s.each(a,function(t){t.set("inCart",e);var a=i.$("[data-id="+t.get("id")+"]");a.find("._label-in-cart").toggleClass("hidden",!e),a.find("._to-cart").toggleClass("active",e).attr({title:s.findWhere(r,{key:e?"removeFromCart":"addToCart"}).label})})},markCover:function(e,t){this.app.store.get("Folder")&&(this.$("._cover.active").removeClass("active"),e&&this.$("[data-id="+t+"] ._cover").addClass("active"))},coverCrop:function(e){new l({app:this.app,file:e,destroyOnHide:!0}).show()},getFileModel:function(e){return this.collection.get(this.getFileThumbID(e))}})},496:function(e,t,i){"use strict";var s=i(0),a=i(9).extend({url:"itemViewedInternal",getQueryParams:function(){return s.clone(this.attributes)}},{write:function(e,t){return new a(e,t).save()}});e.exports=a},497:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(22).capitalize,l=i(126);e.exports=a.extend({el:!1,viewMode:"page",globals:{"resize window":"onWindowResize"},events:{"click ._title-file":"onFileTitleClick"},serialize:function(){return{file:s.clone(this.model.attributes),capitalize:o}},clientAfterRender:function(){this.setTitleWidth()},setTitleWidth:function(){var e=this.$el.width();if(l.mobileTablets())this.$el.find("._title-name").css("max-width",e);else if("page"===this.viewMode)this.$el.find("._title-name").css("max-width",this.$el.width()-this.$el.find("._title-type").width()-this.$el.find("._title-sep").width()-2);else if("modal"===this.viewMode){var t=l.mobilePhone()?2:1.4,i=Math.floor(e/t);this.$el.find("._title-name").css("max-width",i),this.$el.find("._title-seller").css("max-width",e-i-this.$el.find("._title-sep").width())}},onWindowResize:function(){this.setTitleWidth()},onFileTitleClick:function(e){this.fileTitleClickCallback(this.model.get("id"))},fileTitleClickCallback:s.noop})},498:function(e,t,i){"use strict";(function(t){var s=i(0),a=i(471),o=i(490),l=i(516),n=i(473),r=i(561),c=i(489),d=i(127),h=i(472),u=i(11).fileViewButtons,p=i(483),f=i(491),m=i(130),v=i(126),g=i(513),b=i(560),_=i(481),w=i(22).classNames,x=a.extend({name:"FileViewThumb",el:!1,insert:!0,template:b,viewMode:"page",preloadFileSize:"huge",player:null,dimensions:{},isCartBtnEnabled:!0,isFavoriteBtnEnabled:!0,showDownloadButtonInZoomMode:!1,maxHeight:null,events:{"click .button-zoom":"zoomIn","click ._zoom-image":"zoomIn","click ._to-cart":"onAddToCart","click ._to-favorites":"onFavoritesClick","click ._share":"onShareClick","click ._share-close":"onShareCloseClick","click ._share-button":"onShareButtonClick","click ._download_comp":"onDownloadCompClick","click ._file-box-description":"onFileBoxDescriptionClick","mouseenter ._editorial-tooltip":"toggleEditorialTooltip","mouseleave ._editorial-tooltip":"toggleEditorialTooltip"},globals:{"resize window":"onWindowResize"},initialize:function(){var e=this;t.browser&&(this.maxHeight=this.getThumbMaxHeight()),this.preloadFileSize=this.getThumbSize(),this.listenTo(this.app.observer,{"Cart:added":function(t){return e.markCart(!0,t.fileId)},"Cart:removed":function(t){return e.markCart(!1,t.fileId)},"Favorites:PanelCacheUpdate":this.markFavorites})},prepareRender:function(){this.model.generateSeoTitle();var e="huge";this.useBroadSize()&&!this.useHugeSize()?e="broad":"modal"===this.viewMode&&this.app.features.isFeatureOnValue("File View Modal Image Max Thumb")&&"video"!==this.model.get("type")&&(this.compactMode=v.desktopMedium(),e=this.compactMode?"huge":"modal"),this.dimensions.huge=m.getThumbSizes(this.model.serialize(),e)},serialize:function(){var e=this.getThumbSize();return{fileViewBoxClassNames:this.getFileViewBoxClassNames(),isEnterpriseUser:this.app.user.isEnterprise(),file:s.clone(this.model.attributes),dimensions:this.dimensions,maxHeight:this.checkIfHugeVideo()?this.maxHeight:null,thumb:{hasLabel:m.hasLabel(this.model.serialize(),e),src:this.model.get("thumbs")[e],preload:this.model.get("thumbs")[this.preloadFileSize],preloadMax:this.model.get("hasHugeImageThumb")||this.model.get("hasHugeVectorThumb")?this.model.get("thumbs").max:"",seo:this.model.get("thumbs").max,download:"video"===this.model.get("type")?this.getVideoThumb():this.model.get("thumbs").max},viewMode:this.viewMode,canDownloadComp:this.app.user.isLoggedIn(),actionsSmallMode:this.checkActionsSmallMode(),isCartBtnEnabled:!this.app.user.isEnterprise()&&this.isCartBtnEnabled,isFavoriteBtnEnabled:this.isFavoriteBtnEnabled,showVKSocial:"ru"===this.app.lang,hideDescription:!1,pushProportion:this.getPushProportion()}},getPushProportion:function(){return this.dimensions.huge.h/this.dimensions.huge.w*100+"%"},getFileViewBoxClassNames:function(){return w({"view-file-box_video-editorial":"modal"===this.viewMode&&"video"===this.model.get("type")&&this.model.get("editorial"),"view-file-box_video":"video"===this.model.get("type"),"view-file-box_image":"video"!==this.model.get("type")})},clientAfterRender:function(){var e=this;"video"===this.model.get("type")&&this.enableVideoPlayer(),"modal"===this.viewMode&&this.model.get("editorial")&&this.initEditorialToolTip(),"video"!==this.model.get("type")&&p(this.$("._image")),f(this.$el,this,{helperOptions:{mode:"filePage",defaults:this.serialize.bind(this),getModel:function(){return s.clone(e.model.attributes)}}}),this.initSocial(),this.markFavorites()},cleanup:function(){this.getView("FilePreviewVideo")&&this.getView("FilePreviewVideo").remove()},getThumbSize:function(){var e="huge";return this.app.store.get("SearchSettings")&&(e=this.app.store.get("SearchSettings").get("layout")),(this.useMaxModalSize()||this.useBroadSize()&&!this.useHugeSize())&&(e="large"),this.useMaxSize()&&(e="max"),e},checkActionsSmallMode:function(){return this.dimensions.huge.h<=100},checkIfHugeVideo:function(){return this.model.get("hasHugeVideoThumb")},enableVideoPlayer:function(){this.setView("FilePreviewVideo",new o({app:this.app,$mount:this.$("._video-placeholder"),$poster:this.$("._video-poster"),file:this.model,blackBackground:"modal"===this.viewMode,viewMode:this.viewMode})).render()},getVideoThumb:function(){var e=this.model.getVideoThumbs("huge");return e.mp4||this.app.features.isFeatureOnValue("Is webm video thumb allowed")&&e.webm||e.ogg||this.model.get("thumbs").huge},getThumbMaxHeight:function(){return m.getThumbMaxHeight({width:this.model.get("width"),height:this.model.get("height"),viewMode:this.viewMode})},useBroadSize:function(){return"page"===this.viewMode&&this.app.features.isFeatureOnValue("File View Classic")&&this.app.features.isFeatureOnValue("Broad size file view")},useHugeSize:function(){return"page"===this.viewMode&&"video"===this.model.get("type")&&(this.app.features.isFeatureOnValue("Broad size file view")&&this.model.get("hasHugeVideoThumb"))},useMaxModalSize:function(){return"video"!==this.model.get("type")&&"modal"===this.viewMode&&this.app.features.isFeatureOnValue("File View Modal Image Max Thumb")},useMaxSize:function(){return"video"!==this.model.get("type")&&"page"===this.viewMode&&this.app.features.isFeatureOnValue("File View Classic")&&this.app.features.isFeatureOnValue("Max size file view")},zoomIn:function(e){e.stopPropagation(),e.preventDefault(),this.setView("ZoomModal",l.createInstance({placeholderSRC:this.model.get("hasHugeImageThumb")||this.model.get("hasHugeVectorThumb")?this.$("._zoom-image").attr("data-preload-max"):this.$("._zoom-image").attr("src"),file:this.model,app:this.app,showDownloadButton:this.showDownloadButtonInZoomMode,zoomCallback:this.zoomCallback,zoomShowCallback:this.zoomShowCallback,zoomHideCallback:this.zoomHideCallback,zoomNavCallback:this.zoomNavCallback,zoomLeftCallback:this.zoomLeftCallback,zoomRightCallback:this.zoomRightCallback})),this.getView("ZoomModal").show(),this.$("._zoom-image").removeAttr("data-preload-max")},onWindowResize:s.throttle(function(){this.maxHeight=this.getThumbMaxHeight(),this.$("._video-poster").css({maxHeight:this.maxHeight});var e=t.browser?v.desktopMedium():this.compactMode;e!==this.compactMode&&(this.compactMode=e)},10),onFavoritesClick:function(e){e.stopPropagation(),e.preventDefault(),this.app.observer.broadcast(this.model.get("inFavorites")?"Track:UE:File:RemoveFromFavorites":"Track:UE:File:AddToFavorites",{id:this.model.get("id"),file:this.model.toJSON(),position:0,view:this.name}),this.model.get("inFavorites")||this.app.store.link("FileForFavorite",this.model),this.app.observer.fire("Favorites:ToggleFile",{id:this.model.get("id")})},onAddToCart:function(e){e.stopPropagation(),e.preventDefault(),this.app.observer.broadcast(this.model.get("inCart")?"Track:UE:File:RemoveFromCart":"Track:UE:File:AddToCart",{id:this.model.get("id"),file:this.model.toJSON(),position:0,view:this.name}),this.app.observer.fire(this.model.get("inCart")?"Cart:remove":"Cart:add",{fileId:this.model.get("id")}),this.model.get("inCart")||this.app.user.isLoggedIn()||new c({app:this.app,title:this.tr("Add to Cart?"),subTitle:"video"===this.model.get("type")?this.tr('<span class="%s">Create your Account</span> to add this video to your Cart',"sub-text"):this.tr('<span class="%s">Create your Account</span> to add this image to your Cart',"sub-text")}).show()},onShareClick:function(){this.$("._file-box").addClass("view-file-box_share"),this.$("._share-box").addClass("view-file-box__share_active")},onShareCloseClick:function(){this.$("._file-box").removeClass("view-file-box_share"),this.$("._share-box").removeClass("view-file-box__share_active")},onDownloadCompClick:function(e){if(!this.app.user.isLoggedIn())return e.stopPropagation(),e.preventDefault(),void new r({message:"video"===this.model.get("type")?this.tr(d.NeedAuthToDownloadVideoMessage):this.tr(d.NeedAuthToDownloadImageMessage)}).show();this.app.observer.broadcast("Track:UE:File:CompDownload",{file:this.model,option:"comp"})},onFileBoxDescriptionClick:function(e){var t=this.$("._file-box-description");v.mobileMode()&&t.hasClass("view-file-box__description_short")&&(e.preventDefault(),e.stopPropagation(),t.removeClass("view-file-box__description_short"))},toggleEditorialTooltip:function(e){this.getView("editorialTooltip").toggle(e)},initEditorialToolTip:function(){this.setNotExistView("editorialTooltip",n,{params:h.ViewInfoEditorial,content:new a({el:!1,template:_,serialize:function(){return{extendedMessage:!0}}})})},initSocial:function(){var e={facebook:1,twitter:2,google:3,pinterest:4},t={facebook:!0,twitter:!0,google:!1,pinterest:!1};"ru"===this.app.lang&&(e.vk=5,t.vk=!1),this.initSocialButtons({shortenMap:t,socialNameMap:e,shareData:{title:this.model.get("title"),description:this.model.get("description"),image:this.model.get("thumbs").huge}})},markCart:function(e,t){s.contains(t,this.model.get("id"))&&(this.model.set({inCart:e}),this.$("._label-in-cart").toggleClass("hidden",!e),this.$("._to-cart").toggleClass("active",e).attr({title:s.findWhere(u,{key:e?"removeFromCart":"addToCart"}).label}))},markFavorites:function(){var e=this.app.store.get("FolderCache");if(e){var t=!!e.get(this.model.get("id")),i=t?"removeFavorites":"addToFavorites",a=s.findWhere(u,{key:i}).label;this.model.set({inFavorites:t}),this.$("._label-in-favorites").toggleClass("hidden",!t),this.$("._to-favorites").toggleClass("active",t).attr({title:a})}},zoomCallback:s.noop,zoomShowCallback:s.noop,zoomHideCallback:s.noop,zoomNavCallback:s.noop,zoomLeftCallback:s.noop,zoomRightCallback:s.noop});s.extend(x.prototype,g),e.exports=x}).call(this,i(5))},501:function(e,t){e.exports=function(e){return'<h1 class="file-view__title"><a class="file-view__title-link file-view__title-file _title-file" href="'+e.file.url+'">'+e.capitalize(e.file.calculatedTitle)+"</a></h1>"}},502:function(e,t){e.exports=function(e){var t='<div class="file-view__info-wrapper hidden _related" data-tab="info"><div class="file-view__info"><div class="file-view__info-line"><span class="file-view__info-name">';return"video"===e.file.type?t+=""+this.tr("Clip ID"):"vector"===e.file.type?t+=""+this.tr("Vector ID"):e.file.editorial?t+=""+this.tr("Photography ID"):t+=""+this.tr("Image ID"),t+=':</span><span class="file-view__info-value"><a class="link-white" href="'+e.file.url+'">'+e.file.id+'</a></span></div><div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Copyright")+this.tr(":")+'</span><span class="file-view__info-value"><a class="link-white _portfolio" href="'+e.portfolioLink+'"><span>'+e.file.sellerName+"</span></a></span></div>","video"===e.file.type&&(t+='<div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Length")+this.tr(":")+'</span><span class="file-view__info-value">'+e.file.mp+' s</span></div><div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Aspect Ratio")+this.tr(":")+'</span><span class="file-view__info-value">'+e.file.ar+"</span></div>"),e.file.editorial&&(t+='<div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Release Information")+this.tr(":")+'</span><span class="file-view__info-value"><span class="file-view__info-editorial-title">'+this.tr("Editorial Use Only.")+'</span><span class="file-view__info-editorial">'+this.tr("Use of this image in advertising or for promotional purposes is prohibited.")+'<i class="file-view__info-help icon icon-help _editorial-tooltip"></i></span></span></div>'),e.file.limitedDistribution&&(t+='<div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Note")+this.tr(":")+'</span><span class="file-view__info-value">'+this.tr("Images by this contributor can be purchased for print media with a maximum circulation of 250,000 copies per publication.")+"</span></div>"),t+="</div></div>"}},503:function(e,t){e.exports=function(e){var t='<ul class="file-view__tabs view-tabs view-tabs_light">',i=e.scheme;if(i)for(var s,a=-1,o=i.length-1;a<o;)(s=i[a+=1]).enabled&&(t+='<li class="view-tabs__item _tab ',s.active&&(t+=" view-tabs__item_active"),t+='">'+this.tr(s.label)+"</li>");return t+="</ul>"}},504:function(e,t){e.exports=function(e){return'<div class="file-view__bottom" style="opacity: '+e.opacity+'"></div>'}},505:function(e,t,i){"use strict";var s=i(48);e.exports=s.extend({getEnabled:function(){return this.where({enabled:!0})},getActiveTab:function(){return this.findWhere({active:!0})},resetToFirstTab:function(){this.changeActiveTab(0)},changeActiveTab:function(e){this.getActiveTab()&&this.getActiveTab().set({active:!1},{silent:!0}),this.getEnabled()[e].set({active:!0})}})},506:function(e,t,i){"use strict";var s=i(0),a=i(16),o=i(471);e.exports=o.extend({name:"FileViewModalTabs",el:!1,events:{"click ._tab":function(e){e.stopPropagation(),this.changeActiveTab(Math.max(a.$(e.currentTarget).index(),0))}},initialize:function(){s.findWhere(this.scheme,{active:!0})||s.first(this.scheme.getEnabled()).set({active:!0}),this.listenTo(this.scheme,"change",this.render)},serialize:function(){return{scheme:this.scheme.toJSON()}},toTracking:function(){return this.scheme.filter(function(e){return e.get("enabled")})},changeActiveTab:function(e){this.scheme.changeActiveTab(e),this.changeTabCallback()},changeTabCallback:s.noop})},507:function(e,t,i){"use strict";(function(t){var s=i(1)(i(4)),a=i(0),o=i(475),l=i(534),n=i(14),r=i(126),c=i(22),d=i(658).modal;e.exports=o.extend({name:"FileViewModal",single:!0,noBorder:!0,toCenter:!1,draggable:!1,destroyOnHide:!0,classes:{},canHideModal:!0,zoomModalEnabled:!0,fullScreenSizeReserve:d.fullScreenSizeReserve.fileView,displayNavigation:{left:!1,right:!1},events:(0,s.default)({},o.prototype.events,{"click .button-nav-left":"leftNavigation","click .button-nav-right":"rightNavigation"}),prepareRender:function(){t.browser&&(this.heightBigMode=r.heightBigMode())},serialize:function(){return this.classes={"file-view-modal_image":"video"!==this.model.get("type")&&this.app.features.isFeatureOnValue("File View Modal Image Max Thumb"),"file-view-modal_huge":this.model.get("hasHugeVideoThumb"),"file-view-modal_hidden":this.zoomModalEnabled},{file:this.model.serialize(),displayLeftNavigation:this.displayNavigation.left,displayRightNavigation:this.displayNavigation.right,classNames:c.classNames(this.classes)}},clientAfterRender:function(){this.setModalHeight(),this.trackModalShow(),this.zoomModalEnabled&&this.findView("FileViewThumb").$el.find("._zoom-image").trigger("click");for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o.prototype.clientAfterRender.apply(this,t),this.isFullScreenMode()||this.tuneScroll(this.model.get("id"))},show:function(e){o.prototype.show.call(this,e),e.needToUpdateHistoryState&&this.updateHistoryState(e.model.get("id"),e.replaceState),this.app.history.write({route:"FileViewModal"})},hide:function(e){return this.updateHistoryState(null,!1),this.app.history.write({route:this.app.router.routeName}),o.prototype.hide.call(this,e)},leftNavigation:function(e){e.stopPropagation(),this.onLeftNavigation()},rightNavigation:function(e){e.stopPropagation(),this.onRightNavigation()},toggleNavigation:function(e,t){this.displayNavigation[e]=t},updateHistoryState:function(e,t){if(history&&history.pushState&&parseInt(this.app.queryParams.qview,10)!==e){var i=n.urlFormat(n.urlParse(this.app.url).path,{query:{qview:e||null}});this.app.router.appNavigate(i,t)}},getMobileMode:function(){return r.mobileMode()||r.searchModalInMobileMode()},getContainerHeight:function(e){return this.$(a.isUndefined(e)?"._file-view-container":e).outerHeight()},setModalHeight:function(e){this.$el.height(this.getContainerHeight(e))},zoomShowCallback:function(){this.zoomModalEnabled=!0},zoomHideCallback:function(){this.zoomModalEnabled=!1,this.$el.removeClass("file-view-modal_hidden");var e=l.getModal(this.cid);e&&e.config.className.indexOf("hidden")>-1&&(e.config.className=e.config.className.replace("hidden","")),this.canHideModal?this.hide():this.app.observer.broadcast("Track:UE:FileViewModal:Ready",{file:this.model,view:this.name,source:{source:"closeZoom",action:"click",pagetype:"zoom"}})},zoomNavCallback:function(){return{left:this.displayNavigation.left,right:this.displayNavigation.right}},zoomLeftCallback:function(){this.onLeftNavigation()},zoomRightCallback:function(){this.onRightNavigation()},onWindowResize:function(){var e=r.heightBigMode();e!==this.heightBigMode?(this.heightBigMode=e,this.setModalHeight()):this.isFullScreenMode()||this.setModalHeight();for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];o.prototype.onWindowResize.apply(this,i)},onTouchStart:function(e){this.$el.removeClass("file-view-modal_animate"),this.touch={startPositionX:e.originalEvent.touches[0].pageX,startPositionY:e.originalEvent.touches[0].pageY,endPositionX:e.originalEvent.touches[0].pageX,endPositionY:e.originalEvent.touches[0].pageY,startLeft:0,curLeft:0,startTime:Date.now(),isChecked:!1,lock:!1}},onTouchMove:function(e){this.touch.endPositionX=e.originalEvent.touches[0].pageX,this.touch.endPositionY=e.originalEvent.touches[0].pageY;var t=Math.abs(this.touch.startPositionX-this.touch.endPositionX),i=Math.abs(this.touch.startPositionY-this.touch.endPositionY);!this.touch.isChecked&&i>t&&(this.touch.lock=!0),this.touch.isChecked=!0,this.touch.lock||(this.touch.curLeft=this.touch.startLeft+(this.touch.endPositionX-this.touch.startPositionX),this.setLeftPosition(this.touch.curLeft,!1))},onTouchEnd:function(e){if(this.touch.lock)return!1;var t=this.$el.width();return Math.round(this.touch.curLeft/t)||Date.now()-this.touch.startTime<=250?this.displayNavigation.left&&this.touch.startPositionX<this.touch.endPositionX?(this.onLeftNavigation(),this.setLeftPosition(t)):this.displayNavigation.right&&this.touch.startPositionX>this.touch.endPositionX?(this.onRightNavigation(),this.setLeftPosition(-t)):this.setLeftPosition(0):this.setLeftPosition(0),!0},setLeftPosition:function(e,t){void 0===t&&(t=!0),t&&this.$el.addClass("file-view-modal_animate"),this.$el.css("transform","translateX("+e+"px)")},onAfterHideCallback:function(){this.cleanup()},tuneScroll:function(){},trackModalShow:function(){},onLeftNavigation:function(){},onRightNavigation:function(){}})}).call(this,i(5))},513:function(e,t,i){"use strict";var s=i(14),a=i(40);e.exports={initSocialButtons:function(e){var t=this,i=this.app.user.isLoggedIn()?"-"+this.convertBaseNumber(this.app.user.get("id")):"";this.$("._share-button").each(function(s,a){var o=a.getAttribute("data-social"),l=t.getCustomSocialRedirectUrl({socialSuffix:e.socialNameMap[o],isShortenUrl:e.shortenMap[o],refId:i});switch(o){case"facebook":a.href=t.app.makeUrl("facebookSharer",{query:{u:l,title:e.shareData.title,caption:t.app.host,picture:e.shareData.image,description:e.shareData.description}});break;case"twitter":a.href=t.app.makeUrl("twitterSharer",{query:{url:l,via:"depositphotos",text:e.shareData.title+" #stock #photo"}});break;case"google":a.href=t.app.makeUrl("googleSharer",{query:{url:l}});break;case"pinterest":a.href=t.app.makeUrl("pinterestSharer",{query:{url:l,media:e.shareData.image,description:e.shareData.title}});break;case"vk":a.href=t.app.makeUrl("vkSharer",{query:{url:l,image:e.shareData.image,title:e.shareData.title,description:e.shareData.description}});break;default:a.href=""}})},convertBaseNumber:function(e){return parseInt(e,10).toString(36)},getCustomSocialRedirectUrl:function(e){return this.getSocialRedirectUrl?this.getSocialRedirectUrl(e):this.getDefaultSocialRedirectUrl(e)},getDefaultSocialRedirectUrl:function(e){var t=this.convertBaseNumber(""+e.socialSuffix+this.model.get("id"));return s.urlFormat({protocol:e.isShortenUrl?"http:":this.app.parsedUrl.protocol,host:e.isShortenUrl?a.hostnameShorthand:this.app.host,pathname:"/v/"+t+e.refId})},onShareButtonClick:function(e){e.preventDefault(),e.stopPropagation();var t=e.currentTarget,i=e.currentTarget.getAttribute("data-width"),s=e.currentTarget.getAttribute("data-height"),a="\n\t\t\ttop="+(screen.height/2-s/2).toFixed(0)+",left="+(screen.width/2-i/2).toFixed(0)+",width="+i+",height="+s+",resizable=yes,\n\t\t\tscrollbars=no,status=yes,location=no";window.open("about:blank",t.getAttribute("data-title"),a).location.href=t.href}}},514:function(e,t,i){"use strict";var s=i(537),a=i(555),o=i(515);e.exports={sendFiles:function(e,t,i,a){void 0===t&&(t=[]),void 0===i&&(i="transaction"),void 0===a&&(a={}),a.showModal&&this.showModal(e);var o=new s({transactions:t,type:i},{app:e});a.errorCallback&&o.on("error",function(e,t){return a.errorCallback(t.errors)}),a.onSuccess&&o.on("sync",function(e,t){return a.onSuccess(t)}),o.save()},singleDownload:function(e,t){o.downloadByUrl({app:e,link:t})},showModal:function(e){new a({app:e}).show()}}},516:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(475),l=i(490),n=i(534),r=i(130),c=i(126),d=i(483),h=i(562),u=o.extend({name:"ZoomModal",template:h,file:null,noBorder:!0,draggable:!1,fullScreen:!1,overlayConfig:{className:"overlay_bg-dark",closeButton:!0},reserve:{mobile:{width:24,height:18},desktop:{width:50,height:90}},modalClasses:"",dimensions:{},placeholderSRC:null,showDownloadButton:!1,events:(0,s.default)({},o.prototype.events,{click:"onCloseClick","click ._opacity-switcher":"onOpacitySwitcherClick","click ._download":"onDownloadClick","click ._zoom-prev":"onZoomPrev","click ._zoom-next":"onZoomNext"}),getDimensionsSize:function(){return"video"!==this.file.get("type")?"max":"huge"},getSeoAlt:function(){var e="image"===this.file.get("type")?this.tr("Stock Photo"):this.tr("Stock Illustration");return this.file.get("title")+" — "+e},prepareRender:function(){this.id=this.file.get("id"),this.seoAlt=this.getSeoAlt(),this.seoTitle=this.file.get("seoTitle"),this.dimensions=r.getThumbSizes(this.file.serialize(),this.getDimensionsSize()),this.file&&"video"===this.file.get("type")?this.setView("._body",new l({app:this.app,controls:!1,file:this.file,width:this.dimensions.w,height:this.dimensions.h,blackBackground:!0})):this.views["._body"]&&this.views["._body"].remove()},serialize:function(){return{file:{seoAlt:this.seoAlt,seoTitle:this.seoTitle,src:this.makePlaceholderSRC(),preload:this.makeZoomSRC()},navigation:this.zoomNavCallback()||{},modalClasses:this.modalClasses,dimensions:this.dimensions,showDownloadButton:this.showDownloadButton,opacity:[]}},makePlaceholderSRC:function(){return this.placeholderSRC?this.placeholderSRC:this.file.get("thumbs")[this.isHugeImageVectorThumb()?"max":"huge"]},makeZoomSRC:function(){return"video"!==this.file.get("type")?this.file.get("thumbs").max:this.file.get("thumbs").huge},show:function(){if(c.canShowZoomModal()){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o.prototype.show.apply(this,t)}},hide:function(){n.isLocked=!1,this.zoomHideCallback();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o.prototype.hide.apply(this,t),this.remove()},clientAfterRender:function(){d(this.$("img.modal__zoom-image")),this.zoomShowCallback(),n.isLocked=!0;for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o.prototype.clientAfterRender.apply(this,t),this.setModalSize(),a.isArray(this.overlayConfig.opacity)&&n.changeOpacity(a.findWhere(this.overlayConfig.opacity,{active:!0}).value/100),this.app.user.isLoggedIn()||this.app.observer.broadcast("Track:UE:ZoomModal:DownloadShow",{id:this.id}),this.app.observer.broadcast("Track:UE:Zoom:Show",{file:this.file})},observeHideAll:function(){this.$el.remove()},onOpacitySwitcherClick:function(e){if(e.stopPropagation(),a.isArray(this.overlayConfig.opacity)){var t=this.overlayConfig.opacity[Backbone.$(e.currentTarget).index()].value;this.app.userSettings.set({zoomModalOverlay:t}),n.changeOpacity(t/100),this.$("._opacity-switcher").removeClass("bg-selector__handler_active"),Backbone.$(e.currentTarget).addClass("bg-selector__handler_active")}},onWindowResize:function(){c.canShowZoomModal()?this.setModalSize():this.hide()},onDownloadClick:function(e){e.stopPropagation(),this.app.observer.broadcast("Track:UE:ZoomModal:DownloadClick",{id:this.id}),this.app.observer.broadcast("Track:UE:Zoom:Click",{type:"Download"}),this.zoomCallback(e)},onZoomPrev:function(e){e.stopPropagation(),this.app.observer.broadcast("Track:UE:Zoom:Click",{type:"Prev",file:this.file}),this.zoomLeftCallback()},onZoomNext:function(e){e.stopPropagation(),this.app.observer.broadcast("Track:UE:Zoom:Click",{type:"Next",file:this.file}),this.zoomRightCallback()},getReserve:function(e){return c.mobileMode()?this.reserve.mobile[e]:this.reserve.desktop[e]},setModalSize:function(){var e=this.dimensions.w+this.getReserve("width"),t=this.dimensions.h+this.getReserve("height"),i=this.dimensions.w,s=this.dimensions.h;if(e>window.innerWidth||t>window.innerHeight){var a=window.innerWidth-this.getReserve("width"),o=Math.floor(a*this.dimensions.h/this.dimensions.w),l=window.innerHeight-this.getReserve("height"),n=Math.floor(l*this.dimensions.w/this.dimensions.h);a+this.getReserve("width")<=window.innerWidth&&o+this.getReserve("height")<=window.innerHeight?(i=a,s=o):(i=n,s=l)}if(!(i<=this.getReserve("width")||s<=this.getReserve("height"))){if(this.isHugeImageVectorThumb()){var r=Math.ceil(100/(this.dimensions.h/s));this.$("._body").width(i).height(s-r)}else this.$("._body").width(i).height(s);this.$("._wrap").width(i).height(s),this.$el.toggleClass("modal-zoom-compact",window.innerWidth-i<=200),this.$("._caption").width(i),this.centering()}},isHugeImageVectorThumb:function(){return this.file.get("hasHugeImageThumb")||this.file.get("hasHugeVectorThumb")},fullScreenMode:function(){},zoomCallback:function(){},zoomShowCallback:function(){},zoomHideCallback:function(){},zoomNavCallback:function(){},zoomLeftCallback:function(){},zoomRightCallback:function(){}},{createInstance:function(e){return new u((0,s.default)({modalClasses:e.file.get("hasHugeImageThumb")||e.file.get("hasHugeVectorThumb")?"modal_zoom-huge":""},e))}});e.exports=u},517:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(61),l=i(476),n=i(474),r=i(471),c=i(559),d=i(557),h=i(556),u=i(479),p=i(477),f=i(22).classNames,m=i(488),v=i(514),g=i(485),b=i(127),_=i(11).licensingFileTypes,w=i(551),x=r.extend({name:"LicenseWizard",el:!1,template:w,errorTitlesMap:{17001:b.InsufficientFundsTitle},errorMessagesMap:{17001:b.InsufficientFundsMessage},events:{"input  ._field":"onFormFieldChange","change ._license":"onLicenseAndSizeChange","change ._size":"onLicenseAndSizeChange","keypress input":"onInputKeyPress","keyup ._field":"onFieldKeyUp","submit form":"onFormSubmit","click ._submit":"onSubmitClick","click ._submit-download":"onSubmitAndDownloadClick","click ._option-checkbox":"onOptionCheck"},files:[],splitData:{},splitTypes:["image","vector","video"],splitTypesLables:[],typedConfigFileSizes:{},availableLicenses:{},downloadAfterLicensing:!1,initialize:function(){this.collection=new h(this.files,{parse:!0,app:this.app}),this.model=new d,this.listenTo(this.model,"error",this.onModelError),this.purgeSplitData(),this.fillSplitData(),this.applyDefaultLicenses(),this.applyDefaultSizes()},beforeRender:function(){this.setTotalView(),this.applyIncludedOptions()},setTotalView:function(){var e=this;this.showTotal()&&this.setView("._total",new r({getTotalPrice:function(){return e.getTotalPrice()},template:function(){return'<h2 class="license-wizard__title-price">'+this.tr("Total")+this.tr(":")+" "+this.getTotalPrice()+"</h2>"}}))},showTotal:function(){return this.collection.length>1||this.isOptionsVisible()},serialize:function(){var e=this.collection.slice(0,5).reverse().map(function(e){return e.toJSON()}),t={};_.forEach(function(e){return t[e.key]=e.label});var i={"images-fan_has-more":e.length>5};return i["images-fan_counts-"+e.length]=e.length<=5,{files:e,licensingFileTypes:t,splitTypes:this.splitTypes,classNames:f(i),maxFilesListCount:5,licensingParams:this.model.serialize(),availableLicenses:this.availableLicenses,availableSizes:this.getAllAvailableSizesForLicensing(),fields:a.map(this.app.user.serializeUserLicenseFields({enabled:!0}),function(e){return a.extend({},e,{placeholder:o(e.placeholder)})}),showTotal:this.showTotal(),ableToLicense:this.isAbleToLicense(),vatRate:+this.app.user.get("enterprise").vatRate,vatEnabled:this.app.user.get("enterprise").vatEnabled,downloadBtnText:this.files.length>1?this.tr("Confirm & Bulk Download"):this.tr("Confirm & Download"),isOptionsVisible:this.isOptionsVisible(),options:this.getOptionsSchema()}},getTotalPrice:function(){return this.app.currencies.get(this.app.user.get("enterprise").currencyId).format(this.calculateTotal())},isOptionsVisible:function(){return a.some(this.getOptionsSchema(),function(e){return e.length>0})},applyIncludedOptions:function(){var e=this;a.each(this.model.get("licensing").models,function(t){t.set({optionsBitMask:null});var i=e.getOptionsSchema()[t.get("type")];if(i){var s=e.model.get("licensing").findWhere({type:t.get("type")});a.each(i,function(e){0!==e.total&&!0!==e.selected||s.set({optionsBitMask:s.get("optionsBitMask")|e.bit})})}})},getOptionsSchema:function(){var e=this,t={};return a.each(this.model.get("licensing").models,function(i){var s=e.app.config.prices.sizes[i.get("size")],o=a.findWhere(e.app.user.get("enterprise").licenses,{id:i.get("licenseId")});if(o){var l=a.find(o.prices,function(e){return e.fileSizes&s}).options,n=e.processOptions(l,i.get("type"));t[i.get("type")]=e.formatOptions(n)}}),t},processOptions:function(e,t){var i=this,s=this.collection.where({type:t}),o=this.model.get("licensing").findWhere({type:t}).get("size"),l=this.app.config.prices.sizes[o],n=a.map(e,function(e){return a.extend({},e,{total:0})});return a.each(s,function(t){var s=a.find(t.get("exclusivePrice"),function(e){return e.fileSizes&l});if(s){var o=i.mergeOptions(e,s.options);a.each(n,function(e){var t=a.findWhere(o,{bit:e.bit});e.total+=t.price,t.price<0&&(e.disabled=!0)})}else a.each(n,function(t){t.total+=a.findWhere(e,{bit:t.bit}).price})}),a.reject(n,function(e){return e.disabled})},mergeOptions:function(e,t){return a.map(e,function(e){return a.extend({},e,a.findWhere(t,{bit:e.bit}))})},formatOptions:function(e){var t=this;return a.map(e,function(e){return a.extend({},e,{name:t.tr(e.name),totalFormatted:t.app.currencies.get(t.app.user.get("enterprise").currencyId).format(parseFloat(e.total))})})},clientAfterRender:function(){p(this.$el,Backbone.$),u(this.$("._buttons"),{color:"#fff"}),l.initialize(this.$("._scroll").get(0),{suppressScrollX:!0,wheelSpeed:.6})},onOptionCheck:function(e){var t,i=e.currentTarget.checked,s=e.currentTarget.getAttribute("data-type"),a=+e.currentTarget.getAttribute("data-bit"),o=this.model.get("licensing").findWhere({type:s});t=i?o.get("optionsBitMask")|a:o.get("optionsBitMask")^a,o.set({optionsBitMask:t}),this.getView("._total").render()},onFormFieldChange:function(e){this.model.set(e.currentTarget.name,e.currentTarget.value)},onLicenseAndSizeChange:function(e){var t=e.currentTarget.name,i="licenseId"===t?+e.currentTarget.value:e.currentTarget.value;this.model.get("licensing").findWhere({type:e.currentTarget.getAttribute("data-type")}).set(t,i),"licenseId"===t&&this.applyDefaultSizes(e.currentTarget.dataset.type),this.render()},onInputKeyPress:function(e){(e.which||e.keyCode)===g.enter&&(e.preventDefault(),e.stopPropagation(),this.onSubmitAndDownloadClick())},onFieldKeyUp:function(e){e.stopPropagation()},onFormSubmit:function(e){e.preventDefault()},onSubmitClick:function(){this.$("._buttons").trigger("loading"),this.purchase()},onSubmitAndDownloadClick:function(){this.downloadAfterLicensing=!0,this.onSubmitClick()},purgeSplitData:function(){this.splitData={},this.splitTypesLables=[],this.typedConfigFileSizes={},this.availableLicenses={}},fillSplitData:function(){var e=this;this.splitTypes.forEach(function(t){var i=e.collection.where({type:t});i.length&&(e.splitData[t]=i.map(function(e){return e.id}),e.model.get("licensing").add({fileIds:e.splitData[t],type:t}),e.availableLicenses[t]=e.getAvailableLicensesForType(t),e.typedConfigFileSizes[t]=e.getSizesIntersection(t))})},getAvailableLicensesForType:function(e){var t=this.getLicensesIntersection(e);return this.filterLicensesByUser(t)},getLicensesIntersection:function(e){var t=this,i={};return this.collection.each(function(s){s.get("type")===e&&t.getAvailableLicensesForFile(s).forEach(function(e){var t=e.name+" "+e.model;i[t]=i[t]||{data:e,count:0},i[t].count++})}),a.chain(i).where({count:this.collection.where({type:e}).length}).map(function(e){return e.data}).value()},filterLicensesByUser:function(e){var t=this.app.user.getUserType();if("enterprise"===t)return a.filter(e,function(e){return"enterprise"===e.model});if("premiumEnterprise"===t){var i=a.filter(e,function(e){return"enterprise"===e.model});return i.length?i:a.filter(e,function(e){return"premium"===e.model})}return"premium"===t?a.filter(e,function(e){return"premium"===e.model}):e},getSizesIntersection:function(e){var t=this,i={};return this.collection.each(function(s){s&&s.get("type")===e&&s.getSizes().forEach(function(e){i[e.name]=i[e.name]||{data:e,count:0},i[e.name].count++,t.collection.length>1&&-1!==i[e.name].data.label.search("&times;")&&(i[e.name].data.label="")})}),a.where(i,{count:this.collection.where({type:e}).length}).map(function(e){return e.data})},applyDefaultLicenses:function(){var e=this;this.splitTypes.forEach(function(t){({}).hasOwnProperty.call(e.availableLicenses,t)&&e.availableLicenses[t].length&&e.model.get("licensing").findWhere({type:t}).set({licenseId:a.first(e.availableLicenses[t]).id})})},applyDefaultSizes:function(e){e?this.updateDefaultSizes(e):this.splitTypes.forEach(this.updateDefaultSizes.bind(this))},updateDefaultSizes:function(e){var t=this.getAvailableSizesForLicensing(e);t&&this.model.get("licensing").findWhere({type:e}).set({size:a.first(t).size})},getAvailableLicensesForFile:function(e){var t=this;return a.chain(this.getLicensesByFilePermissions(e)).filter(function(i){return t.getFullLicenseSizeMask(i)&e.get("sizeMask")}).value()},getLicensesByFilePermissions:function(e){return this.isFileExclusivelyRegular(e)?a.filter(this.app.user.serializeUserLicenses(),function(e){return"enterprise"===e.model}):a.filter(this.app.user.serializeUserLicenses(),function(t){return e.get("permissions")[t.model]})},isFileExclusivelyRegular:function(e){return!0===e.get("permissions").regular&&1===a.compact(e.get("permissions")).length},getFullLicenseSizeMask:function(e){return e?a.chain(e.prices).pluck("fileSizes").reduce(function(e,t){return e|t}).value():0},getAllAvailableSizesForLicensing:function(){var e=this,t={};return this.splitTypes.forEach(function(i){return t[i]=e.getAvailableSizesForLicensing(i)}),t},isAbleToLicense:function(){var e=this;return this.splitTypes.some(function(t){return e.availableLicenses[t]&&e.availableLicenses[t].length&&e.getAllAvailableSizesForLicensing()[t].length})},getAvailableSizesForLicensing:function(e){var t,i=this,s=this.model.get("licensing").findWhere({type:e});return s&&(t=a.findWhere(this.availableLicenses[e],{id:s.get("licenseId")})),t?a.filter(this.typedConfigFileSizes[e],function(s){var o=!1;return a.each(t.prices,function(t){i.app.config.prices.sizes[s.size]&t.fileSizes&&(s.cost=i.getCustomPrice(e,s)||t.cost,s.costWithCurrency=i.showCurrencyForCost(e)?i.app.currencies.get(i.app.user.get("enterprise").currencyId).format(s.cost):null,o=i.isSizeEnabled(e,s))},i),o}):null},isSizeEnabled:function(e,t){var i=this.collection.where({type:e}),s=this.app.config.prices.sizes[t.size],o=!0;return a.each(i,function(e){if(e.get("exclusivePrice").length){var t=a.find(e.get("exclusivePrice"),function(e){return e.fileSizes&s});t&&t.cost<0&&(o=!1)}}),o},showCurrencyForCost:function(e){var t=this.collection.where({type:e});return t.length<2||!this.isCollectionHasExclusivePrices(t)},isCollectionHasExclusivePrices:function(e){return a.some(e,function(e){return e.get("exclusivePrice").length})},getCustomPrice:function(e,t){var i=this.collection.where({type:e}),s=this.app.config.prices.sizes[t.size];if(i.length>1)return!1;var o=a.find(i[0].get("exclusivePrice"),function(e){return e.fileSizes&s});return!!(o&&o.cost&&this.isCustomPriceAllowed(e))&&o.cost},isCustomPriceAllowed:function(e){var t=this.model.get("licensing").findWhere({type:e}).get("licenseId");return"premium"===a.findWhere(this.app.user.get("enterprise").licenses,{id:t}).model},onGeneralError:function(e){var t=e[0];17001===t.error_code?this.app.router.redirect(this.app.makeUrl("subscribe/billing",{backURL:!0,query:{product:"account"}})):63002===t.error_code?this.app.router.redirect(this.app.makeUrl("login",{protocol:"https",backURL:!0})):this.showError(t.error_code,t.error_message)},showError:function(e,t){var i=this,s=this.errorTitlesMap[e]?this.errorTitlesMap[t]:b.ServiceModalTitle,a=this.errorMessagesMap[e]?this.errorMessagesMap[t]:t;this.insertView("ServiceModal",new n({title:s,message:a,onHideCallback:function(){i.getView("ServiceModal")&&i.getView("ServiceModal").remove()}})).show()},showSummary:function(e,t){var i=this;void 0===e&&(e=[]),void 0===t&&(t=[]);var s=this.app.user.get("firstName")&&this.app.user.get("lastName")?this.app.user.get("firstName")+" "+this.app.user.get("lastName"):this.app.user.get("username");this.insertView("ServiceModal",new n({title:b.ServiceModalTitle,body:function(){return new c({data:{username:s,filesOk:e.length?e.map(function(e){return"#"+e.id}).join(", "):null,filesFail:t.length?t.map(function(e){return"#"+e.id}).join(", "):null,filesOkAmount:e.length,filesFailAmount:t.length}})},onHideCallback:function(){i.getView("ServiceModal")&&i.getView("ServiceModal").remove()}})).show()},purchase:function(){this.model.save({},{success:this.onLicenseSuccess.bind(this)})},onModelError:function(e,t){t.errors.length&&this.onGeneralError(t.errors)},parseLicensingResult:function(e){var t=[],i=[];return a.each(e,function(e){"success"===e.result?t.push({id:e.fileId,link:e.downloadLink,transaction:e.transaction[0]}):i.push({id:e.fileId})}),[t,i]},handleLicensingResult:function(e,t){e.length&&!t.length?this.app.observer.fire("Notification",{type:"success",description:b.SuccessfullyLicensed}):this.showSummary(e,t)},handleLicensingResultAndDownload:function(e,t){1===this.files.length?e.length?v.singleDownload(this.app,a.first(e).link):this.app.observer.fire("Notification",{type:"error"}):v.sendFiles(this.app,e.map(function(e){return e.transaction.transactionId}),"transaction",{showModal:!0,errorCallback:this.onGeneralError.bind(this)})},onLicenseSuccess:function(e,t){if(this.$("._buttons").trigger("loaded"),"success"===t.status){this.app.user.fetch();var i=this.parseLicensingResult(t.result),s=i[0],a=i[1];this.downloadAfterLicensing?this.handleLicensingResultAndDownload(s,a):this.handleLicensingResult(s,a),this.trackSuccessLicense(e,s),this.onLicenseSuccessCallback(s,this.collection.serialize(),e.serialize(),this.downloadAfterLicensing)}},calculateTotal:function(){var e=this,t=0;return this.model.get("licensing").each(function(i){var s=a.findWhere(e.typedConfigFileSizes[i.get("type")],{size:i.get("size")});if(s){var o=e.collection.where({type:i.get("type")});a.each(o,function(i){var a=e.getFileExclusiveOptions(i,s);a&&a.cost?t+=+a.cost:t+=+s.cost});var l=a.filter(e.getOptionsSchema()[i.get("type")],function(e){return e.bit&i.get("optionsBitMask")});a.each(l,function(e){t+=e.total})}}),t},getFileExclusiveOptions:function(e,t){var i=this.getAvailableLicensesForType(e.get("type"))[0].model,s=this.app.config.prices.sizes[t.size];return"premium"===i?a.find(e.get("exclusivePrice"),function(e){return e.fileSizes&s}):null},trackSuccessLicense:function(e,t){var i=this;void 0===t&&(t=[]);var a={id:"",size:"",route:this.app.router.routeName,cost_type:"enterprise",view:this.name},o=e.get("licensing");t.forEach(function(e){var t=o.findWhere({licenseId:e.transaction.license});i.app.observer.broadcast("Track:UE:File:License",(0,s.default)(a,{id:e.id,size:t.get("size"),file:i.collection.get(e.id)}))})},onLicenseSuccessCallback:a.noop});a.extend(x.prototype,m),e.exports=x},518:function(e,t,i){"use strict";var s=i(0),a=i(473),o=i(472).PreviewFiles,l=i(572),n=i(490),r=i(126);e.exports=a.extend({name:"FilePreviewTooltip",insert:!0,initialize:function(){return a.prototype.initialize.apply(this,[{params:o}])},cleanup:function(){this.content&&this.content.remove()},show:function(e,t){if(r.canShowPreviewTooltips())return"video"===t.contentData.file.get("type")?this.makeVideoPreview(t):this.makeImagePreview(t),a.prototype.show.apply(this,arguments)},makeImagePreview:function(e){this.content=new l(s.extend(s.pick(e.contentData,"file","layout"),{app:this.app}))},makeVideoPreview:function(e){this.content=new n({template:i(570),file:e.contentData.file,controls:!1,muted:!0,viewMode:"tooltip",app:this.app})}})},519:function(e,t,i){"use strict";var s=i(0),a=i(16).$,o=i(495),l=i(489),n=i(592),r=i(63),c=i(126),d=["Search","Folder","CustomFolder"],h=o.extend({name:"fileList",events:s.extend({},o.prototype.events,{"click .file-box":"onFileClick"}),globals:{keyup:"onKeyUpModal"},onFileClick:function(e){if(e.preventDefault(),e.stopPropagation(),!this.tryShowSignUpModal()){var t=a(e.currentTarget).closest("[data-id]"),i=this.collection.get(t.data("id")),s=a(e.target).hasClass("_zoom");i&&this.app.observer.broadcast("Track:UE:File:ThumbClick",{id:t.data("id"),file:i,index:t.index(),query:this.app.store.get("SearchQuery").get("query"),sorting:this.app.store.get("SearchQuery").toTracking("sorting"),view:this.name}),s&&this.app.observer.broadcast("Track:UE:Zoom:Click",{type:"FastZoom",file:i,view:this.name}),this.canHideModal=s,this.zoomModalEnabled=s,this.showDownloadButtonInZoomMode=s,this.showFileViewModal(t.data("id"))}},getTrackingInfo:function(){return{callingView:this.name}},tryShowSignUpModal:function(){var e=1===parseInt(r.get("signUpFileShown"),10);return!(!d.includes(this.app.router.routeName)||!this.app.features.isFeatureOnValue("Sign Up Modal instead of File View Modal")||e||this.app.user.isLoggedIn()||c.mobilePhone())&&(new l({app:this.app}).show(),r.set("signUpFileShown",1,{expires:365}),this.app.observer.broadcast("Track:UE:SignUp:ModalShow",{label:1}),!0)}});s.extend(h.prototype,n),e.exports=h},521:function(e,t){e.exports=function(e){var t='<div class="price-table-classic price-table-classic_mode-'+e.viewMode+'"><form autocomplete="off" method="GET" class="price-table-classic__form" action="/cart/purchase.html"><input type="hidden" name="id" value="'+e.download.itemId+'" /><input type="hidden" name="source" value="view_item" /><input type="hidden" name="license" value="'+e.download.license+'" /><input type="hidden" name="size" value="'+e.download.size+'" /><input type="hidden" name="method" value="'+e.download.method+'" /><input type="hidden" name="purchased" value="'+e.download.purchased+'" /><input type="hidden" name="product" value="'+e.download.fileType+'" /><input type="hidden" name="subproduct" value="'+e.download.resolution+'" /><input type="hidden" name="split_count" value="'+e.download.splitCount+'" /><input type="hidden" name="subscription" value="'+e.download.subscription+'" />';e.searchQuery&&(t+='<input type="hidden" name="sq" value="'+e.searchQuery.hash+'" /><input type="hidden" name="sst" value="'+e.searchQuery.offset+'" />'),t+='<div class="price-table-classic__content"><div class="price-table-classic__head ',e.table.availableMethods.length&&!e.isEnterpriseUser&&(t+=" price-table-classic__head_methods"),t+='">';var i=e.table.head;if(i)for(var s=-1,a=i.length-1;s<a;){if(t+='<div class="price-table-classic__th',"Resolution"===(p=i[s+=1]).label&&(t+=" price-table-classic__th_resolution"),"Price"===p.label&&(t+=" price-table-classic__th_price"),t+='">',"Resolution"===p.label?t+='<div class="price-table-classic__col-name price-table-classic__col-name_alt">'+this.tr("Size")+'</div><div class="price-table-classic__col-name price-table-classic__col-name_simple">'+this.tr(p.label)+"</div>":"Size"===p.label?t+='<div class="price-table-classic__col-name price-table-classic__col-name_alt">'+this.tr("Resolution")+'</div><div class="price-table-classic__col-name price-table-classic__col-name_simple">'+this.tr(p.label)+this.tr(":")+"</div>":t+='<div class="price-table-classic__col-name">'+this.tr(p.label)+"</div>",p.switcher){t+='<div class="price-table-classic__col-switch col-switch">';var o=p.switcher;if(o)for(var l,n=-1,r=o.length-1;n<r;)t+='<div class="col-switch__item _tab ',(l=o[n+=1]).active&&(t+=" col-switch__item_active"),t+='" data-key="'+l.key+'">'+this.tr(l.label)+"</div>";t+="</div>"}t+="</div>"}t+='</div><div class="price-table-classic__space"><div class="price-table-classic__space-item"></div></div>';var c=e.table.body;if(c)for(var d=-1,h=c.length-1;d<h;)t+='<div class="price-table-classic__row _row ',(p=c[d+=1]).active&&(t+=" price-table-classic__row_active"),t+='"><div class="price-table-classic__cell price-table-classic__cell_resolution"><label class="price-table-classic__radio field-box radio-box radio-only radio-box-m"><input class="radio" type="radio" name="size" value="'+p.key+'"',p.active&&(t+=' checked="checked"'),t+=' /><i class="icon icon-radio icon-radio-m"></i></label><span class="price-table-classic__size">',"vect"===p.key?(t+='<i class="icon icon-size',"modal"===e.viewMode&&(t+=" icon-size-air"),t+=" icon-size-vector ",p.active&&(t+=" active"),t+='"></i>'):"el0"===p.key?(t+='<i class="icon icon-size',"modal"===e.viewMode&&(t+=" icon-size-air"),t+=" icon-size-extended ",p.active&&(t+=" active"),t+='"></i>'):(t+='<i class="icon icon-size ',"modal"===e.viewMode&&(t+=" icon-size-air"),"video"!==e.file.type?t+=" icon-size-photo":t+=" icon-size-video",t+=" icon-size-"+p.indicator,p.active&&(t+=" active"),t+='"></i>'),t+='</span><div class="price-table-classic__size-info"><span class="price-table-classic__text-size">'+this.tr(p.label)+", </span>",p.extension.tooltip?t+='<span class="price-table-classic__text-type" title="'+p.extension.tooltip+'">'+this.tr(p.extension.label)+"</span>":t+='<span class="price-table-classic__text-type">'+this.tr(p.extension.label)+"</span>",e.isEnterpriseUser||(t+='<div class="price-table-classic__text-license">'+this.tr(p.license)+"</div>"),t+='</div></div><div class="price-table-classic__cell price-table-classic__cell_frame-rate">',p.size.tooltip?(t+='<span class="price-table-classic__text">'+this.tr(p.size.value)+'<i class="price-table-classic__help icon icon-help icon-help-',"modal"===e.viewMode?t+="light":t+="dark",t+=' _tooltip-vector"></i></span>'):t+='<div class="price-table-classic__text price-table-classic__text-alt">'+this.tr(p.label)+'</div><div class="price-table-classic__text price-table-classic__text-size-details">'+p.size.value+"</div>",t+='</div><div class="price-table-classic__cell price-table-classic__cell_price">',p.purchase.size?(t+='<span class="price-table-classic__redownload">',p.purchase.data.error||(t+='<span class="price-table-classic__text price-table-classic__text_middle">'+this.tr("Re-Download")+"</span>"),t+='<a class="price-table-classic__redownload-item price-table-classic__redownload-item_ok icon icon-round-ok',p.purchase.size&&!p.purchase.data.error||(t+=" hidden"),t+='" href="'+this.app.makeUrl("purchased",{query:{"filter[id]":p.fileID}})+'" target="_blank"></a><i class="price-table-classic__redownload-item icon icon-round-fail ',p.purchase.data.error||(t+=" hidden"),t+='" ',p.purchase.data.error&&(t+='title="'+p.purchase.data.error+'"'),t+='></i><i class="price-table-classic__redownload-item icon icon-loading icon-loading-gray hidden"></i></span>'):(t+='<span class="price-table-classic__label">',p.price.free?t+='<span class="price-table-classic__text price-table-classic__text_red">'+this.tr("Free")+"</span>":p.price.discounted&&p.price.discounted!==p.price.value?t+='<span class="price-table-classic__discount"><s class="price-table-classic__price-old">'+p.price.value+'</s><span class="price-table-classic__price-new price-table-classic__text_red">'+p.price.discounted+"</span></span>":p.price.value&&(t+='<span class="price-table-classic__text">'+p.price.value,"-"!==p.price.value&&(t+="&nbsp;"),t+="</span>"),""!==p.price.label&&(t+='<span class="price-table-classic__label-description price-table-classic__text">'+this.tr(p.price.label,"")+'</span><span class="price-table-classic__label-item price-table-classic__label-item_ok icon icon-round-ok',p.price.isLicensed||(t+=" hidden"),t+='"></span>'),t+="</span>"),t+="</div></div>";e.isEnterpriseUser&&e.userHasPermissionsToLicense&&(t+='<div class="price-table-classic__row price-table-classic__license-btn-row"><div class="price-table-classic__cell price-table-classic__cell_resolution"></div><div class="price-table-classic__cell"></div><div class="price-table-classic__cell price-table-classic__cell_price"><div class="price-table-classic__license-btn-container"><button type="button" class="price-table-classic__license-btn button button-xxl',"modal"===e.viewMode?t+=" button-black-blue":t+=" button-white-blue",t+=' _license">'+this.tr("License")+"</button></div></div></div>"),t+='</div><div class="price-table-classic__footer"><div class="price-table-classic__captcha g-recaptcha" data-sitekey="'+e.captcha.siteKey+'"></div><div class="price-table-classic__download',e.isEnterpriseUser&&(t+=" price-table-classic__download_enterprise"),t+='">',e.userHasPermissionsToDownload&&(t+='<button class="price-table-classic__download-btn button button-xxxl button-red _download-button" type="submit">'+e.downloadButtonText+"</button>"),e.isEnterpriseUser&&e.userHasPermissionsToLicense&&(t+='<button type="button" class="price-table-classic__license-btn_mobile button button-xxl',"modal"===e.viewMode?t+=" button-black-blue":t+=" button-white-blue",t+=' _license">'+this.tr("License")+"</button>"),t+="</div>","video"===e.file.type||e.canBeDownload||e.isEnterpriseUser||(t+='<span class="price-table-classic__note _note">'+this.tr("Files under the Extended license can be<br /> downloaded using On Demand Downloads<br /> for Extended License only.")+"</span>");var u=e.table.body;if(u)for(var p,f=-1,m=u.length-1;f<m;)(p=u[f+=1]).active&&(t+='<div class="price-table-classic__footer-info"><div class="price-table-classic__footer-info-row"><div class="price-table-classic__footer-info-cell">'+this.tr("License")+this.tr(":")+'</div><div class="price-table-classic__footer-info-cell">'+this.tr(p.license)+'</div></div><div class="price-table-classic__footer-info-row"><div class="price-table-classic__footer-info-cell">'+this.tr("File Type")+this.tr(":")+'</div><div class="price-table-classic__footer-info-cell">'+this.tr(p.extension.label)+"</div></div></div>");return t+='<span class="price-table-classic__download-error _download-error"></span></div></form></div>'}},522:function(e,t){e.exports=function(e){var t='<div class="price-table price-table_mode-'+e.viewMode+'"><form autocomplete="off" method="GET" class="price-table__form" action="/cart/purchase.html"><input type="hidden" name="id" value="'+e.download.itemId+'" /><input type="hidden" name="source" value="view_item" /><input type="hidden" name="license" value="'+e.download.license+'" /><input type="hidden" name="size" value="'+e.download.size+'" /><input type="hidden" name="method" value="'+e.download.method+'" /><input type="hidden" name="purchased" value="'+e.download.purchased+'" /><input type="hidden" name="product" value="'+e.download.fileType+'" /><input type="hidden" name="subproduct" value="'+e.download.resolution+'" /><input type="hidden" name="split_count" value="'+e.download.splitCount+'" /><input type="hidden" name="subscription" value="'+e.download.subscription+'" />';e.searchQuery&&(t+='<input type="hidden" name="sq" value="'+e.searchQuery.hash+'" /><input type="hidden" name="sst" value="'+e.searchQuery.offset+'" />'),t+='<div itemscope itemtype="depositphotos.com"><meta itemprop="infinite" content="1" /><meta itemprop="subscription" content="1" /><meta itemprop="licenses" content="'+e.table.licenseMeta+'" /></div><div class="price-table__content"><div class="price-table__sizes">';var i=e.table.body;if(i)for(var s=-1,a=i.length-1;s<a;)t+='<div class="price-table__size-box',(l=i[s+=1]).active&&(t+=" price-table__size-box_active"),t+=' _size-box">',(l.purchase.size||l.price.isLicensed)&&(t+='<div class="price-table__redownload"><i class="price-table__redownload-cover"></i>',l.purchase.size?(t+='<a class="price-table__redownload-item icon icon-round-ok-large',l.purchase.size&&!l.purchase.data.error||(t+=" hidden"),t+='"href="'+this.app.makeUrl("purchased",{query:{"filter[id]":l.fileID}})+'" target="_blank" title="'+this.tr("Already Downloaded")+'"></a><i class="price-table__redownload-item icon icon-round-fail-large ',l.purchase.data.error||(t+=" hidden"),t+='"',l.purchase.data.error&&(t+=' title="'+l.purchase.data.error+'"'),t+="></i>"):l.price.isLicensed&&(t+='<i class="price-table__redownload-item icon icon-round-ok-large"></i>'),t+="</div>"),t+='<label class="price-table__size-btn',"video"===e.file.type&&"4k"!==l.key&&(t+=" price-table__size-btn_lower"),t+=' _row"><input class="price-table__size-radio" type="radio" name="size" value="'+l.key+'"',l.active&&(t+=' checked="checked"'),t+=" />","vect"===l.key?"modal"===e.viewMode?(t+='<i class="price-table__size-icon icon',l.active?t+=" icon-vector-black":t+=" icon-vector-white",t+='"></i>'):(t+='<i class="price-table__size-icon icon',l.active?t+=" icon-vector-white":t+=" icon-vector-black",t+='"></i>'):"el0"===l.key?t+="EL":(t+=""+l.indicator,"video"===e.file.type&&"4k"!==l.key&&(t+="p")),t+='</label><div class="price-table__info-box',e.isEnterpriseUser&&(t+=" price-table__info-box_es"),t+='">',e.isEnterpriseUser?""!==l.price.label&&(t+='<span class="price-table__info-text">'+this.tr(l.price.label,"")+'</span><span class="price-table__info-sep price-table__info-sep_first"> | </span>'):(t+='<span class="price-table__info-text',"extended"===l.licenseName&&(t+=" price-table__info-text_bold"),t+='">',"modal"===e.viewMode?t+='<a class="price-table__info-link" href="'+this.app.makeUrl("license-comparison")+'" target="_blank">'+this.tr(l.licenseShort)+"</a>":t+=""+this.tr(l.licenseShort),t+='</span><span class="price-table__info-sep price-table__info-sep_first"> | </span>'),t+='<span class="price-table__info-text">'+this.tr(l.label)+", "+this.tr(l.extension.label)+'</span><span class="price-table__info-sep"> | </span>',"video"===e.file.type||"vector"===e.file.type&&("vect"===l.key||"el0"===l.key)?(t+='<span class="price-table__info-text">'+l.size.value,"vector"!==e.file.type||"vect"!==l.key&&"el0"!==l.key||(t+='<i class="price-table__info-help icon icon-help icon-help-',"modal"===e.viewMode?t+="light":t+="dark",t+=' _tooltip-vector"></i>'),t+="</span>"):t+='<span class="price-table__info-text price-table__info-text_switch _tab" data-key="'+l.switchNextSize+'">'+l.size.value+"</span>",t+="</div>",e.priceNearButton&&e.canBeDownload&&!e.isEnterpriseUser&&!l.purchase.size&&(t+='<div class="price-table__price-box _price-box">',l.price.free?t+='<span class="price-table__price-title">'+this.tr("Price")+this.tr(":")+this.seo.space+'</span><span class="price-table__text price-table__text_red">'+this.tr("Free")+"</span>":l.price.discounted&&l.price.discounted!==l.price.value?t+='<span class="price-table__price-title">'+this.tr("Price")+this.tr(":")+this.seo.space+'</span><span class="price-table__discount"><s class="price-table__text price-table__text_push">'+l.price.value+'</s><span class="price-table__text price-table__text_red">'+l.price.discounted+"</span></span>":"-"!==l.price.value&&(t+='<span class="price-table__price-title">'+this.tr("Price")+this.tr(":")+this.seo.space+'</span><span class="price-table__text">'+l.price.value+"&nbsp;</span>"),""!==l.price.label&&(t+='<span class="price-table__text">'+this.tr(l.price.label,"")+"</span>"),t+="</div>"),t+="</div>";if(t+='</div></div><div class="price-table__footer',e.isEnterpriseUser&&(t+=" price-table__footer_es"),e.canBeDownload||e.isEnterpriseUser||(t+=" price-table__footer_has-note"),t+='"><div class="price-table__captcha g-recaptcha" data-sitekey="'+e.captcha.siteKey+'"></div><div class="price-table__download',e.isEnterpriseUser&&(t+=" price-table__download_enterprise"),t+='">',e.userHasPermissionsToDownload){t+='<button class="price-table__download-btn button button-5xl button-red _download-button" type="submit"><span class="price-table__download-btn-wrap price-table__download-btn-wrap_with-price">';var o=e.table.body;if(o)for(var l,n=-1,r=o.length-1;n<r;)(l=o[n+=1]).active&&(!e.priceInButton&&!l.price.free||!e.canBeDownload||e.isEnterpriseUser||l.purchase.size||""===l.priceLabel||!l.price.free&&"credits"!==e.download.method&&1===l.price.value?t+=""+e.downloadButtonText:t+='<span class="price-table__download-btn-title">'+e.downloadButtonText+'</span><span class="price-table__download-btn-price">'+this.tr("Price")+this.tr(":")+this.seo.space+l.priceLabel+"</span>");t+='</span><span class="price-table__download-btn-wrap price-table__download-btn-wrap_classic">'+e.downloadButtonText+"</span></button>"}return e.isEnterpriseUser&&e.userHasPermissionsToLicense&&(t+='<button type="button" class="price-table__license-btn button button-5xl',"modal"===e.viewMode?t+=" button-black-blue":t+=" button-white-blue",t+=' _license">'+this.tr("License")+"</button>"),t+='</div><span class="price-table__download-error _download-error"></span>',"video"===e.file.type||e.canBeDownload||e.isEnterpriseUser||(t+='<span class="price-table__note',e.file.editorial&&"page"===e.viewMode&&(t+=" price-table__note_push"),t+=' _note">'+this.tr("Files under the Extended license can be<br /> downloaded using On Demand Downloads<br /> for Extended License only.")+"</span>"),e.file.editorial&&"page"===e.viewMode&&(t+='<div class="price-table__editorial"><p class="price-table__editorial-title">'+this.tr("Editorial Use Only.")+'</p><span class="price-table__editorial-desc">'+this.tr("Use of this image in advertising or for promotional purposes is prohibited.")+'<i class="price-table__editorial-help icon icon-help-new _editorial-tooltip"></i></span></div>'),t+="</div></form></div>"}},523:function(e,t,i){"use strict";var s=i(493);e.exports=s.extend({url:"ComplimentaryDownload",LEGACY_DOWNLOAD:!1})},524:function(e,t,i){"use strict";var s=i(0),a=i(9),o=i(22),l=i(134),n=i(11),r=i(127),c=["US","GB","LR","MM"],d=["smallweb","bigweb","hd720","hd1080","4k"],h=["xl-2015","vect","cl","cs"].concat(d),u=["s-2015","m-2015","l-2015","xl-2015","vect"].concat(d),p=["el0"].concat(u);e.exports=a.extend({defaults:{file:void 0,product:void 0,available:[],defaultUnits:!0,units:"inch",chosen:""},initialize:function(){this.config=o.deepClone(this.app.config.prices)},getActiveSize:function(e){var t=this;return this.getUserSizes(e.getTypedConfig(),e).some(function(e){return e.size===t.get("chosen")})?this.get("chosen"):this.getDefaultSize(e)},buildTable:function(e){var t=this.getActiveSize(e);return this.set({chosen:t}),{preferredMethod:this.get("product"),availableMethods:this.get("available"),head:this.buildHead(e),body:this.buildBody(e,this.get("product"),t),licenseMeta:this.getLicenseMeta(e)}},getLicenseMeta:function(e){var t=s.chain(e.getTypedConfig()).sortBy("order").value(),i=t[t.length-1].shortName;return"EL"===i&&(i=t[t.length-2].shortName+" | "+t[t.length-1].shortName),t[0].shortName+"-"+i},buildHead:function(e){return[{label:r.Resolution,switcher:null},{label:"video"===e.get("type")?r.FrameRate:r.Size,switcher:"video"===e.get("type")?null:[{key:"inch",label:r.Inches,active:"inch"===this.getUnits()},{key:"cm",label:r.Cm,active:"cm"===this.getUnits()}]},{label:this.app.user.isEnterprise()?r.License:r.Price,switcher:null}]},getSizeMaskByType:function(e){switch(e){case"enterprise":return this.getEnterpriseSizeMask();case"premium":return this.getPremiumSizeMask();default:return this.getDefaultSizeMask()}},getSizeMask:function(e){var t=this.app.config.prices.sizes;return o.generateSizeMask(t,e)},getPremiumSizeMask:function(){return this.getSizeMask(h)},getEnterpriseSizeMask:function(){return this.getSizeMask(u)},getDefaultSizeMask:function(){return this.getSizeMask(p)},getUserSizes:function(e,t){var i=this,a=this.app.user.getUserType(),o=t.getPermissionType(),l=this.getSizeMaskByType(a),n=this.getSizeMaskByType(o),r=this.app.features.get("Premium collection for ES").get("value"),c=t.isPremiumOnlyAvailable(),d=!t.get("permissions").premium&&"premium"===a;return s.filter(e,function(e){var t=e.size,s=i.app.config.prices.sizes[t];return r?c?s&i.getPremiumSizeMask():d?s&n:s&l:s&i.getDefaultSizeMask()})},buildBody:function(e,t,i){var a=this;return s.chain(this.getUserSizes(e.getTypedConfig(),e)).sortBy("order").map(function(s){return e.get("exclusivePrice")&&e.get("exclusivePrice")[s.size]&&(s.price=a.applyExclusivePrice(s.price,e.get("exclusivePrice")[s.size])),a.row(e,s,t,i)}).value()},row:function(e,t,i,a){var o=this.getLicenseName(t),n=this.app.user.isEnterprise()?this.makeLicense(e,t):this.makePrice(e,t,i);return{fileID:e.get("id"),key:t.size,active:t.size===a,purchase:!this.app.user.isEnterprise()&&e.getPurchase(t.size)||{},indicator:this.makeIndicator(t),label:e.makeSizeLabel(t),extension:l.makeExtension(e.get("type"),t),license:l.makeLicenseFullInfo(o).label,licenseShort:l.makeLicenseShortInfo(o).label,licenseName:o,size:l.makeSize(e,t,this.getUnits()),switchNextSize:this.getNextSize(),price:n,priceLabel:this.getPriceLabel(n),prices:this.app.user.isEnterprise()?this.makeLicenses(e,t):this.makePrices(e,t,s.size(this.get("available"))&&this.get("available")||[i])}},getLicenseName:function(e){return this.get("product")&&"ondemand"===this.get("product").type&&"el"===this.get("product").subproduct?"extended":e.license},getPriceLabel:function(e){var t="";return e.free?t=this.app.translator.tr("Free"):e.discounted&&e.discounted!==e.value?t="<s>"+e.value+"</s> "+e.discounted:"-"!==e.value&&(t=e.value+" "),""!==e.label&&(t+=this.app.translator.tr(e.label,"")),t},makeIndicator:function(e){return n.renameSizes[e.size]||e.size.replace("hd","").replace("-2015","")},makePrices:function(e,t,i){var s=this,a=[];return i.map(function(i){return s.makePrice(e,t,i)}).filter(function(e){return-1===a.indexOf(e.bit_price)&&(a.push(e.bit_price),!0)})},makePrice:function(e,t,i){var a=s.find(t.price,function(e){return e.bits&i.bit_price}),l="credits"===i.type?this.getPriceKoef(e,this.app.user,t):1,n=e.get("free")&&"extended"!==t.license,c=a?o.formatPrice(a.cost):"-",d=1!==c?r.Downloads:r.Download;return{bit_price:i.bit_price,free:n,value:c,discounted:l<1?o.formatPrice(a.cost*l):null,label:this.makePriceLabel(i,a,n,d)}},makePriceLabel:function(e,t,i,s){return this.app.features.isFeatureOnValue("File View Classic")||"credits"!==e.type?i||!t||"credits"===e.type?"":s:this.app.translator.tr("%s Credits")},makeLicense:function(e,t){var i=e.isLicensed(t.size);return{free:!1,isLicensed:i,label:i?r.Licensed:r.NotLicensed}},makeLicenses:function(e,t){return[this.makeLicense(e,t)]},getUnits:function(){var e=c.indexOf(this.app.config.country)>=0?"inch":"cm";return this.changed.units&&this.secureSet({defaultUnits:!1}),this.get("defaultUnits")&&this.get("units")!==e&&this.secureSet({units:e}),this.get("units")},getNextSize:function(){return"inch"===this.getUnits()?"cm":"inch"},applyExclusivePrice:function(e,t,i){var a,o=i||"bits";return s.each(t,function(t){(a=s.find(e,function(e){return t[o]===e[o]}))?a=s.extend(a,t):e.push(t)}),e},getPriceKoef:function(e,t,i){var s="vector"===e.get("type")?"image":e.get("type"),a=e.get("discount")||0,o=this.app.user.get("id")?t.get("discounts")[s]&&t.get("discounts")[s][i.size]:0;return o*=100,"extended"===i.license&&"100"===e.get("discount")?1:1-Math.max(a,o)/100},getDefaultSize:function(e){return s.chain(this.getUserSizes(e.getTypedConfig(),e)).where({license:"standard"}).last().value().size}})},525:function(e,t,i){"use strict";(function(e){var t=i(1)(i(131)),s=i(0),a=i(16),o=i(471),l=i(473),n=i(474),r=i(633),c=i(524),d=i(493),h=i(523),u=i(6)(e),p=i(477),f=i(479),m=i(515),v=i(126),g=i(615),b=i(100).apiErrors,_=i(100).captchaErrors,w=i(40),x=i(472),k=i(127),y=i(522),C=i(521),F=i(481);e.exports=o.extend({name:"PriceTable",el:!1,template:y,viewMode:"page",mobileTablets:!1,sideBarAllowed:!1,quickSwitch:!1,downloadModels:{},downloading:0,refPrefix:"",isDesktopSmall:!1,events:{"click ._row":"onTableRowClick","click ._tab":"onSwitcherTabClick","click ._license":"onLicenseClick","click ._download-button":"onDownloadClick","mouseenter ._tooltip-vector":"showVectorTooltip","mouseleave ._tooltip-vector":"hideVectorTooltip","mouseenter ._editorial-tooltip":"toggleEditorialTooltip","mouseleave ._editorial-tooltip":"toggleEditorialTooltip"},globals:{"resize window":"onWindowResize"},initialize:function(){var e=this;this.setTemplate(),this.userPlansManager=this.userPlansManager||this.app.store.get("UserPlansManager"),this.priceTable=new c({file:this.file,product:this.userPlansManager.get("preferred"),available:this.userPlansManager.get("available")},{app:this.app}),this.listenTo(this.file,"change:purchase_info change:sizeMask change:licensed",this.render),this.on("item.downloaded",this.render),this.listenTo(this.priceTable,{change:this.render}),this.quickSwitch?this.listenTo(this.app.observer,"PriceTable:SetAttributes",function(t){e.priceTable.set({product:t},{silent:!0}),e.priceTable.trigger("manualSync"),e.toggleProductLabel(t.bit_price)}):(this.listenTo(this.userPlansManager,{change:function(){return e.priceTable.set({product:e.userPlansManager.get("preferred")})}}),this.listenTo(this.app.observer,"Sidebar:PurchaseComplete",function(){e.render().promise().done(function(){return e.proceedDownloadForAuthUser()})}))},prepareRender:function(){var e=this;return this.table=this.priceTable.buildTable(this.file),0===this.downloading&&(s.each(this.downloadModels,function(t,i){i!==e.file.get("id")&&delete e.downloadModels[i]}),!0)},serialize:function(){var e=this.priceTable.getActiveSize(this.file);return{searchQuery:this.app.store.get("SearchQuery")?s.pick(this.app.store.get("SearchQuery").attributes,"offset","hash"):void 0,userHasPermissionsToLicense:this.app.user.hasPermissionsTo("enterprise","license"),userHasPermissionsToDownload:this.app.user.hasPermissionsToDownload()||this.file.isLicensed(e),isEnterpriseUser:this.app.user.isEnterprise(),file:this.file.serialize(),table:this.table,canBeDownload:this.checkSizeCanBeDownload(e),download:this.getDownloadModel(e).toJSON(),viewMode:this.viewMode,priceInButton:this.app.user.isLoggedIn(),priceNearButton:!1,captcha:{siteKey:w.recaptcha.publicKey},downloadButtonText:this.getDownloadButtonText()}},clientAfterRender:function(){var e=this;"vector"===this.file.get("type")&&this.setNotExistView("vectorTooltip",l,{name:"VectorTooltip",params:x.PriceTableVector,content:new o({el:!1,template:function(){return this.tr(k.AIFilesHelpMessage)}})}),this.file.get("editorial")&&this.setNotExistView("editorialTooltip",l,{params:x.ViewInfoEditorial,content:new o({el:!1,template:F})}),p(this.$el,a.$),this.$("._download-button").each(function(t,i){return f(e.$(i),{color:"modal"===e.viewMode?"#fff":void 0})}),this.setPricePosition(),this.sizeChangedCallback()},checkSizeCanBeDownload:function(e){if(this.file.isPurchased(e)||this.file.isLicensed(e))return!0;var t=this.priceTable.get("product").bit_price;return(this.userPlansManager.getPlansMaskForFileSize(this.file.get("type"),e)&t)>0},setTemplate:function(){this.app.features.isFeatureOnValue("File View Classic")&&(this.template=C)},getDownloadButtonText:function(){var e=this.priceTable.get("chosen"),t=this.getFileTypeOverride(this.file.get("type"),e),i=[{type:"image",label:this.tr("Download Image")},{type:"vector",label:this.tr("Download Vector")},{type:"video",label:this.tr("Download Video")}];return this.file.isPurchased(e)||this.file.isLicensed(e)?this.tr("Re-Download_full"):this.app.user.isEnterprise()?this.tr("Download Comp"):i.find(function(e){return e.type===t}).label},getFileTypeOverride:function(e,t){return"vector"!==this.file.get("type")||["vect","el0"].includes(t)?this.file.get("type"):"image"},setPricePosition:function(){var e=this.$("._size-box"),t=parseInt(e.css("marginLeft"),10)+parseInt(e.css("marginRight"),10),i=e.outerWidth()*e.length+t*(e.length-1),s=this.$("._price-box"),a=this.$("._download-button"),o=a.length?a.outerWidth():0,l=0;l=o+s.outerWidth()<=i?i-s.outerWidth():o,s.css({left:l})},onTableRowClick:function(e){this.setChosenSize(a.$(e.currentTarget).find('input[name="size"]').val())},onSwitcherTabClick:function(e){this.priceTable.set({units:e.currentTarget.getAttribute("data-key")})},onLicenseClick:function(e){e.preventDefault(),e.stopPropagation(),this.onLicenseBtnClick()},onDownloadClick:function(e){e.preventDefault(),this.resetError(),this.app.observer.broadcast("Track:UE:File:DownloadClick",{id:this.file.get("id"),file:this.file,product:this.file.get("free")?0:this.userPlansManager.get("preferred").bit_price,size:this.priceTable.getActiveSize(this.file),route:this.app.router.routeName,view:this.name}),this.app.user.isLoggedIn()?this.proceedDownloadForAuthUser():this.proceedDownloadForGuest()},proceedDownloadForGuest:function(){"Cart"!==this.app.router.routeName?(this.listenToOnce(this.app.observer,"Cart:added",this.doPurchaseAndDownload),this.app.observer.fire("Cart:add",{fileId:this.file.get("id")})):this.doPurchaseAndDownload()},proceedDownloadForAuthUser:function(){var e=this.$("._note");e.is(":visible")&&!e.hasClass("animation-el-note")&&this.app.user.checkExtendedProduct()?(e.addClass("animation-el-note"),this.getDownloadButton(this.priceTable.getActiveSize(this.file)).trigger("loaded")):this.doPurchaseAndDownload()},getDownloadButton:function(e){var t=this.$('._download-button[value="'+e+'"]');return t.length>0?t:this.$("._download-button")},toggleProductLabel:function(e){this.$("[data-bit]").addClass("hidden").filter('[data-bit="'+e+'"]').removeClass("hidden")},injectPurchased:function(e,t){this.file.setPurchase(e,!t||!t.message&&!t.error_message||{error:t.message||t.error_message})},createDownloadModel:function(){return this.app.user.isEnterprise()?new h({},{app:this.app}):new d({},{app:this.app})},getDownloadModel:function(e){var t=this,i=this.file.get("id"),a=this.priceTable.get("product"),o=this.file.getTypedConfig().find(function(t){return t.size===e})||{};this.downloadModels[i]=this.downloadModels[i]||{};var l=this.downloadModels[i][e];return l||((l=this.downloadModels[i][e]=this.createDownloadModel()).listenTo(this.priceTable,"change manualSync",function(){s.each(t.downloadModels[i],function(s){s.secureSet({source:"item",itemId:i,size:e,license:o.license,purchased:t.file.isPurchased(e),fileType:"video"===t.file.get("type")?"video":"image",method:"imagepack"===a.type?"bonus":a.type,subscription:"subscription"===a.type?a.id:0,resolution:a.subproduct||"standart",splitCount:a.split_count||0})})}),this.priceTable.trigger("manualSync"),this.listenTo(l,{"change:link":this.onGetDownloadLink,invalid:this.onInvalidDownload,error:this.onDownloadError})),l.set("g-recaptcha-response",this.$(".g-recaptcha-response").val()||""),l},doPurchaseAndDownload:function(){var e=this.priceTable.getActiveSize(this.file),t=this.file.isPurchased(e),i=this.file.get("free");t||i||!this.isNeedToShowSidebar()?t||i||!this.isNeedToRefillPlan()?(this.downloading++,this.getDownloadButton(e).trigger("loading"),this.getDownloadModel(e).requestLink()):this.showRefillMembershipModal():this.app.observer.fire("Sidebar:PurchaseEnable",{file:this.file})},isNeedToShowSidebar:function(){return this.sideBarAllowed&&!this.app.user.isEnterprise()&&!v.mobileMode()&&this.app.features.isFeatureOnValue("Purchase Sidebar on File View")&&!this.app.user.hasPlans()},isNeedToRefillPlan:function(){var e=this.priceTable.get("product").type;if("membership"!==e)return!1;var t=s.chain(this.app.user.serializeUserPlans({type:e})).sortBy("order").first().value();return!this.app.user.products[e].get(t.id).canBePurchased()},onGetDownloadLink:function(e,t){var i=this,s=e.get("size");m.downloadByUrl({app:this.app,link:t,callback:function(){i.getDownloadButton(s).trigger("loaded"),0==--i.downloading&&i.trigger("item.downloaded"),i.app.user.fetch()}});var a=this.file.isLicensed(this.priceTable.getActiveSize(this.file)),o=["EnterpriseLicensedDownloads","EnterpriseCompDownloads"].indexOf(this.app.router.routeName)>-1;if(!this.app.user.isEnterprise()||a||o){if(!this.app.user.isEnterprise()){var l=this.userPlansManager.get("preferred").bit_price;this.file.get("free")&&(l=this.file.isFreeCurated()?"FreeCurated":"Free"),this.app.observer.broadcast("Track:UE:File:Download",{route:this.app.router.routeName,id:this.file.get("id"),file:this.file,size:e.get("size"),reDownload:this.file.isPurchased(e.get("size")),plan:this.app.tracking.rewriteProduct(this.userPlansManager.get("preferred").type),cost_type:l,view:this.name})}}else this.app.observer.broadcast("Track:UE:File:AddToCart",{id:this.file.get("id"),file:this.file.serialize(),view:this.name});this.injectPurchased(e.get("size")),this.onDownloadBegins()},onInvalidDownload:function(e,i){var a=this;if(this.downloading--,i.length&&s.some(i,function(e){return e.error_code===b.haveNoPermissionToSection}))return this.getDownloadButton(e.get("size")).trigger("loaded"),new n({title:this.tr("Service Message"),message:s.map(i,function(e){return e.error_message}).join(" ")}).show(),void u.warn("DOWNLOAD ERROR: Cannot get download link. Something wrong with arrived data",i);var o=s.find(i,function(e){return!!s.contains((0,t.default)(_),+e.error_code)&&e});if(o)return this.getDownloadButton(e.get("size")).trigger("loaded"),this.showError(o.error_code,o.error_message),void g.injectScript(this.$(".g-recaptcha")[0],this.sizeChangedCallback.bind(this));(i.key||i.length)&&("Cart"!==this.app.router.routeName&&this.app.observer.broadcast("Track:UE:File:AddToCart",{id:this.file.get("id"),file:this.file.serialize(),view:this.name}),this.injectPurchased(e.get("size"),e.LEGACY_DOWNLOAD?i:s.first(i)),this.app.chain.initChain("download",{refPrefix:this.refPrefix,fileId:e.get("itemId"),fileType:e.get("fileType")}).then(function(){e.LEGACY_DOWNLOAD?a.app.chain.startLegacy(i):a.app.chain.start(s.first(i))}))},onDownloadError:function(e,t){g.reset(this.$(".g-recaptcha-response")),t.responseJSON&&t.responseJSON.errors?this.onInvalidDownload(e,t.responseJSON.errors):u.warn("DOWNLOAD ERROR: Cannot get download link. Server returns error: ",t)},setChosenSize:function(e,t){this.priceTable.set({chosen:e},t||{})},showRefillMembershipModal:function(){new r({app:this.app,type:"notAvailable"}).show()},resetError:function(e,t){this.$("._download-error").text("")},showError:function(e,t){this.$("._download-error").text(e+"::"+t),this.sizeChangedCallback()},getActiveTableRowData:function(){return this.table&&this.table.body&&s.findWhere(this.table.body,{active:!0})||null},showVectorTooltip:function(e){e.preventDefault(),this.getView("vectorTooltip").show(e)},hideVectorTooltip:function(e){e.preventDefault(),this.getView("vectorTooltip").hide(e)},toggleEditorialTooltip:function(e){this.getView("editorialTooltip").toggle(e)},onWindowResize:s.throttle(function(){v.desktopSmall()!==this.isDesktopSmall&&(this.isDesktopSmall=v.desktopSmall(),this.setPricePosition())},100),onLicenseBtnClick:function(){},onDownloadBegins:function(){},sizeChangedCallback:function(){}})}).call(this,i(3)(e))},526:function(e,t){e.exports=function(e){var t='<div class="download-method download-method_file-view-'+e.viewMode+'"><div class="download-method__method _methods"><i class="download-method__icon icon';return"modal"===e.viewMode&&(t+=" color-white"),t+=" icon-plans-"+e.type+'"></i><span class="download-method__title">'+this.tr("Download Using")+this.tr(":")+'</span><span class="download-method__description">'+this.tr(e.label)+" "+(e.serialIndex||"")+'<input class="download-method__radio" type="radio" name="method" value="'+e.type+'" /></span><i class="download-method__arrow arrow ',"modal"===e.viewMode?t+=" arrow-gray":t+=" array-black",t+=' arrow-bottom arrow-block-1 _arrow"></i></div><div class="download-method__products-box _mobile-products"></div></div>'}},527:function(e,t){e.exports=function(e){return'<div class="user-plans-list user-plans-list_mobile _list"></div>'}},528:function(e,t,i){"use strict";var s=i(0),a=i(16),o=i(471),l=i(527),n={credits:{},subscription:{},ondemand:{},membership:{},imagepack:{}};n.credits.view=i(614),n.credits.template=i(647),n.subscription.view=i(595),n.subscription.template=i(646),n.ondemand.view=i(594),n.ondemand.template=i(645),n.imagepack.view=i(613),n.imagepack.template=i(644),n.membership.view=i(538),n.membership.template=i(643),e.exports=o.extend({name:"UserProductsListMobile",el:!1,template:l,viewMode:"modal",linksEnabled:!1,plans:void 0,events:{"click ._product":"onUserProductClick"},initialize:function(){this.listenTo(this.app.user,"sync",this.render)},prepareRender:function(){s.each(this.plans.serializeUserPlans(),function(e){this.insertView("._list",this.getProductView(e))},this)},serialize:function(){return{products:this.plans.serializeUserPlans()}},getProductView:function(e){var t=this.linksEnabled?this.app.makeUrl("subscribe",{backURL:!0}):"",i=n[e.type];return i?new i.view({app:this.app,template:i.template,product:e,serializeParams:{href:t}}):null},onUserProductClick:function(e){this.linksEnabled||(e.stopPropagation(),e.preventDefault()),this.chooseProductCallback(this.plans.serializeUserPlans()[a.$(e.currentTarget).index()])},toggle:function(){this.$el.toggle(),"modal"===this.viewMode&&this.app.observer.fire("Modal:CheckSize")},hide:function(){this.$el.hide(),"modal"===this.viewMode&&this.app.observer.fire("Modal:CheckSize")},chooseProductCallback:s.noop})},529:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(16),o=i(471),l=i(473),n=i(648),r=i(528),c=i(126),d=i(472),h=i(526);e.exports=o.extend({name:"DownloadMethodSelector",el:!1,template:h,viewMode:"page",onlyDesktopView:!1,mobileTablets:!1,events:{"click ._methods":"togglePlansToolTip"},globals:{click:"onGlobalClick","resize window":"onWindowResize"},initialize:function(){this.userPlansManager=this.userPlansManager||this.app.store.get("UserPlansManager"),this.listenTo(this.userPlansManager,"change",this.render),this.collection&&this.listenTo(this.collection,"reset",this.render)},prepareRender:function(){return!(!this.isNeedToBeShown()||this.collection&&0===this.collection.length)||(this.$el&&this.$el.hide&&this.$el.hide(),!1)},serialize:function(){return(0,s.default)({viewMode:this.viewMode},this.userPlansManager.get("preferred"))},clientAfterRender:function(){this.getView("PlansTooltip")&&this.getView("PlansTooltip").isOpen()&&this.getView("PlansTooltip").repin(this.$("._methods")),!this.onlyDesktopView&&c.mobileTablets()?this.makePlansListMobile():this.makePlansList()},makePlansList:function(){this.setNotExistView("PlansTooltip",l,{name:"PlansTooltip",keep:!0,params:d.Products,content:new n({app:this.app,plans:this.userPlansManager,handleProductClick:!1,chooseProductCallback:this.onChoosePlan.bind(this)})})},makePlansListMobile:function(){var e=new r({viewMode:this.viewMode,app:this.app,plans:this.userPlansManager,chooseProductCallback:this.onChoosePlan.bind(this)});this.setView("._mobile-products",e),e.render().promise().done(function(e){return a.$("._mobile-products").append(e.$el)})},isNeedToBeShown:function(){return this.userPlansManager.get("available").length>0},onGlobalClick:function(e){e.stopPropagation(),this.hidePlansToolTip()},onWindowResize:function(){if(!this.onlyDesktopView){var e=c.mobileTablets();e!==this.mobileTablets&&(this.mobileTablets=e,this.mobileTablets?(this.getView("PlansTooltip")&&this.getView("PlansTooltip").remove(),this.makePlansListMobile()):(this.getView("._mobile-products")&&this.getView("._mobile-products").remove(),this.makePlansList()))}},onChoosePlan:function(e){this.hidePlansToolTip(),this.userPlansManager.set({preferred:e}),this.chooseProductCallback(e)},togglePlansToolTip:function(e){e.preventDefault(),e.stopPropagation(),this.getView("._mobile-products")&&this.getView("._mobile-products").toggle(e),this.getView("PlansTooltip")&&this.getView("PlansTooltip").toggle(e),this.$("._arrow").toggleClass("arrow-top").toggleClass("arrow-bottom")},hidePlansToolTip:function(){this.getView("._mobile-products")&&this.getView("._mobile-products").hide(),this.getView("PlansTooltip")&&this.getView("PlansTooltip").hide(),this.$("._arrow").removeClass("arrow-top").addClass("arrow-bottom")},chooseProductCallback:function(){}})},531:function(e,t){e.exports=function(e){return'<div class="cover-crop" style="width: '+e.sizes.width+'px;"><div class="cover-crop__wrap"><img class="cover-crop__img _img" src="'+e.url+'" style="width: '+e.sizes.width+"px; height: "+e.sizes.height+'px;" /></div></div>'}},532:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(649),o=i(471),l=i(130),n=i(531);e.exports=o.extend({name:"CoverCropBody",el:!1,template:n,prepareRender:function(){this.sizes=this.getThumbSizes()},serialize:function(){return{sizes:this.sizes,url:l.getThumbUrl({file:this.file.serialize(),size:"wideSmall",protocol:this.app.parsedUrl.protocol})}},clientAfterRender:function(){this.cropper=new a(this.$("._img").get(0),{aspectRatio:5,minCropBoxWidth:this.sizes.width,minContainerHeight:this.sizes.height,zoomable:!1})},getThumbSizes:function(){var e=this.file.get("width"),t=this.file.get("height");return e>t?{width:450,height:Math.floor(450*t/e)}:{width:Math.floor(450*e/t),height:450}},crop:function(){var e=this.app.store.get("Folder"),t=this.cropper.getCropBoxData(),i=this.sizes.width/this.sizes.height>5,a=1600/this.sizes.width,o=(0,s.default)({fileId:this.file.get("id"),folderId:e.get("id")},{boxWidth:1600,boxHeight:Math.floor(1600*this.sizes.height/this.sizes.width),width:i?Math.floor(t.width*a):1600,height:Math.floor(t.height*a),top:Math.floor(t.top*a),left:Math.floor(t.left*a)});e.save({coverCropData:o})}})},533:function(e,t,i){"use strict";var s=i(1)(i(10)),a=i(475),o=i(532),l=function(e){function t(t){var i;return(i=e.call(this,t)||this).title=i.tr("Cover Crop"),i.body=function(){return new o({file:i.file,app:i.app})},i.footer=[{label:i.tr("Ok"),color:"blue",defaultAction:!0,callback:"cropCallback"},{label:i.tr("Cancel"),hide:!0}],i}return(0,s.default)(t,e),t.prototype.cropCallback=function(){var e=this,t=this.app.store.get("Folder");this.lockOverlay=!0,this.$el.addClass("modal_loading"),this.listenToOnce(t,"sync",function(){e.app.observer.fire("Folder:AddCover",{fileId:e.file.get("id")}),e.hide()}),this.findView("CoverCropBody").crop()},t}(a);e.exports=l},537:function(e,t,i){"use strict";var s=i(9);e.exports=s.extend({url:function(){return this.get("uuid")?"DownloadBulkOrder":"RequestBulkOrder"},defaults:{uuid:null,transactions:[],type:"transaction"}})},539:function(e,t,i){"use strict";e.exports={extraOffset:400,loadLimit:40,minItemsAmount:8}},540:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(495),l=i(518),n=i(14),r=i(126),c=i(530),d=i(491),h=i(40).app,u=i(539);e.exports=o.extend({name:"RelatedFilesList",el:!1,globals:(0,s.default)({},o.prototype.globals,{"scroll.infinite window":"checkLoadingNecessity","resize.infinite window":"checkLoadingNecessity"}),title:null,className:"",filesBoxClassName:"",seeMore:null,sliderShift:0,relatedMode:void 0,viewMode:"page",isCartBtnEnabled:!0,isFavoriteBtnEnabled:!0,isSimilarBtnEnabled:!1,infiniteScrollEnabled:!1,hasNavigation:!1,displaySeeMore:!0,displaySeeMoreLink:!1,filesListLargeEnabled:!1,filesListRelatedWideEnabled:!1,filesListFillEnabled:!1,events:(0,s.default)({},o.prototype.events,{"click ._nav-left":"onNavLeftClick","click ._nav-right":"onNavRightClick","mouseenter ._related-file:not(.related-file-box_see-more)":"showToolTip","mouseleave ._related-file:not(.related-file-box_see-more)":"hideToolTip","click ._related-file":"onFileClick","click ._see-more":"onSeeMoreClick"}),initialize:function(){this.setFileEventsListeners(),this.listenTo(this.collection,"update reset",this.render),this.collection.endless&&this.initInfiniteScroll(),this.on("clientAfterRender",this.trackImpression)},prepareRender:function(){this.prepareSeoTitle()},serialize:function(){return{isEnterpriseUser:this.app.user.isEnterprise(),title:this.title,hidden:this.app.features.isFeatureOnValue("Lazy File Relates"),layoutClassName:this.className,filesBoxClassName:this.filesBoxClassName,relatedMode:this.relatedMode,endless:this.collection.endless,viewMode:this.viewMode,seeMore:this.seeMore,sortImagesEnabled:h.sortFileViewRelatedImagesEnabled,items:this.serializeItems(),infiniteScrollEnabled:this.infiniteScrollEnabled,filesListLargeEnabled:this.filesListLargeEnabled,filesListFillEnabled:this.filesListFillEnabled,hasNavigation:this.hasNavigation,isCartBtnEnabled:!this.app.user.isEnterprise()&&this.isCartBtnEnabled,isFavoriteBtnEnabled:this.isFavoriteBtnEnabled,isSimilarBtnEnabled:this.isSimilarBtnEnabled,sliderShift:this.getSliderShift(),lockUploadFiles:this.lockFilesUpload()}},serializeItems:function(){var e=this,t=this.collection.serialize().map(function(t){return(0,s.default)({},t,{url:n.urlFormat(t.url,{protocol:e.app.parsedUrl.protocol,host:e.app.host})})});return t.length>=8&&!this.infiniteScrollEnabled&&(this.filesListRelatedWideEnabled||(t=t.slice(0,8)),this.seeMore={display:this.displaySeeMoreLink,type:this.model.get("type"),url:this.model.makeRelatedUrl({relatedTo:this.relatedMode})},this.displaySeeMore&&!this.filesListLargeEnabled&&(0,s.default)(t[t.length-1],{seeMore:!0,url:this.seeMore.url})),t},clientAfterRender:function(){var e=this;"page"===this.viewMode&&(this.setNotExistView("tooltip",l,{app:this.app}),this.setSeeMoreLink()),d(this.$("._related-file:not(.related-file-box_see-more)"),this,{helperOptions:{mode:"related",defaults:function(){return(0,s.default)({},e.getRenderData(),{viewMode:"page"})},getModel:function(t){return(0,s.default)({},e.collection.get(+Backbone.$(t.currentTarget).data("id")).attributes)}}}),this.lockFilesUpload()&&this.uploadFiles(),this.clientAfterRenderCallback()},trackImpression:function(){this.collection.length&&this.$el.is(":visible")&&this.app.observer.broadcast("Track:UE:File:UserSeeFileThumb",{page:1,files:this.collection.toJSON(),relatedMode:this.relatedMode,anchor:this.model.get("id"),view:this.name})},toTracking:function(){return this.serializeItems()},initInfiniteScroll:function(){this.listenTo(this.collection,{"update reset":this.checkLoadingNecessity,CollectionEnded:this.destroyInfiniteScroll})},destroyInfiniteScroll:function(){this.collection.endless=!1,this.collection.initialized=!1,this.$("._loader").remove()},checkLoadingNecessity:a.throttle(function(){this.collection.initialized&&this.needToLoad()&&this.collection.loadNext()},300),needToLoad:function(){var e=Backbone.$(window);return e.scrollTop()+e.height()+u.extraOffset>this.$el.offset().top+this.$el.outerHeight()},prepareSeoTitle:function(){this.collection.each(function(e){return e.generateSeoTitle({useSeoAltTemplate:!1,useSeoTitleTemplate:!1})})},getRenderData:function(){return a.pick(this,"relatedMode","viewMode")},setSeeMoreLink:function(){var e=this.$("._link");e.length&&c.transformToLink(e[0],this.model.makeRelatedUrl({relatedTo:this.relatedMode}))},onFileClick:function(e){if(Backbone.$(e.currentTarget).hasClass("_related-file-activate")){var t=this.collection.findWhere({id:+Backbone.$(e.currentTarget).data("id")});this.app.observer.broadcast("Track:UE:File:RelatedFileClick",{id:t.get("id"),index:this.$(e.currentTarget).index(),mode:this.relatedMode}),this.app.observer.broadcast("Track:UE:File:OpenFileView",{fileId:t.get("id"),file:t,sourceFile:this.model,mode:this.relatedMode,viewMode:this.viewMode,view:this.name}),this.onFileClickCallback(e,t)}else this.trackSeeMore()},onSeeMoreClick:function(){this.trackSeeMore()},trackSeeMore:function(){this.app.observer.broadcast("Track:UE:File:SeeMoreClick",{mode:this.relatedMode})},showToolTip:function(e){"page"===this.viewMode&&r.canShowPreviewTooltips()&&this.getView("tooltip").show(e,{anchor:e.currentTarget,contentData:{file:this.collection.at(Backbone.$(e.currentTarget).index())}})},hideToolTip:function(e){this.getView("tooltip")&&this.getView("tooltip").hide(!!e)},onNavLeftClick:function(e){this.navAction("left")},onNavRightClick:function(e){this.navAction("right")},navAction:function(e){var t="right"===e?"._nav-right":"._nav-left",i="right"===e?"._nav-left":"._nav-right",s=Math.abs(parseInt(this.$("._related-files-box").css("margin-left"),10)),a="right"===e?Math.max(this.totalItemsWidth-this.holderWidth-s,0):s,o="right"===e?-(s+Math.min(this.holderWidth,a)):-(s-Math.min(this.holderWidth,a));this.holderWidth>=a&&this.$(t).addClass("hidden"),this.$(i).removeClass("hidden"),this.$("._related-files-box").css({marginLeft:o}),this.sliderShift=o},getSliderShift:function(){if(!this.totalItemsWidth)return 0;var e=this.sliderShift;return e&&Math.abs(this.sliderShift)+this.holderWidth>this.totalItemsWidth&&(e=Math.min(-(this.totalItemsWidth-this.holderWidth),0)),e},lockFilesUpload:function(){return"page"===this.viewMode&&(this.app.features.isFeatureOnValue("Upload Related After")||this.app.features.isFeatureOnValue("Lazy File Relates"))},uploadFiles:function(){this.$el.removeClass("hidden"),this.$("._file-box-image-src").each(function(e,t){var i=Backbone.$(t);i.attr("data-src")&&i.attr("src",i.attr("data-src")).removeAttr("data-src")})},onFileClickCallback:function(){},clientAfterRenderCallback:function(){}})},546:function(e,t){e.exports=function(e){var t="";return e.showNotice&&(t+='<a class="file-view-notice__wrap" href="'+this.app.makeUrl("50freefiles")+'"><span class="file-view-notice__text">'+this.tr("You can download this file for free on our special offer landing page. Get it now!")+"</span></a>"),t}},547:function(e,t){e.exports=function(e){return'<div class="create-design create-design_'+e.viewMode+'"><button class="create-design__btn button _btn"><i class="create-design__icon icon"></i><span class="create-design__text">'+e.btnText+"</span></button></div>"}},548:function(e,t,i){"use strict";var s=i(0),a=i(136),o=i(471),l=i(40),n=i(547),r=i(22);e.exports=o.extend({name:"CreateDesign",el:!1,template:n,viewMode:"modal",events:{"click ._btn":"onBtnClick"},prepareRender:function(){return!this.isDisabled()},serialize:function(){var e="edit"===this.getCrelloButtonType()?this.tr("Edit with Crello"):this.tr("Create Design");return{viewMode:this.viewMode,btnText:e}},clientAfterRender:function(){this.isDisabled()||this.trackEvent("show")},getCrelloButtonType:function(){var e=this.app.features.get("Crello button type");return"enabled"===e.get("status")?e.get("value"):""},isDisabled:function(){return!(this.app.user.isLoggedIn()&&this.app.features.isFeatureOnValue("Create Design")&&!this.app.user.isEnterprise()&&"image"===this.model.get("type")&&!this.model.get("editorial"))},onBtnClick:function(e){e.stopPropagation(),window.open(this.getLink(),"_blank").focus(),this.trackEvent("click")},getLink:function(){var e={protocol:l.crello.protocol,host:l.crello.host,pathname:"home"};return this.app.features.isFeatureOnValue("Create Design Home")||(e=s.extend(e,{pathname:"create_design/depositphotos/"+this.model.get("id"),query:this.getQueryParams()})),a.format(e)},getQueryParams:function(){var e="modal"===this.viewMode?"Modal":"ItemPage";return{utm_source:"DepositPhotos",utm_medium:r.capitalize(this.getCrelloButtonType()),utm_campaign:e}},trackEvent:function(e){var t="modal"===this.viewMode?"FileViewModal":"FileView",i="edit"===this.getCrelloButtonType()?"EditWCrello":"CrelloCreate";this.app.observer.broadcast("Track:UE:"+t+":CrelloCreate",{eventCategory:i,action:e})}})},549:function(e,t){e.exports=function(e){var t='<div class="search-similar-box"><button class="search-similar-box__button button _find-similar-btn">';return"modal"===e.viewMode?(t+='<i class="search-similar-box__icon icon ',"video"===e.type?t+="icon-see-more-videos-light":t+="icon-see-more-images-light",t+='"></i>'):(t+='<i class="search-similar-box__icon icon ',"video"===e.type?t+="icon-see-more-videos-dark":t+="icon-see-more-images-dark",t+='"></i>'),t+='<span class="search-similar-box__text">',"video"===e.type?t+=""+this.tr("Find Similar Videos"):t+=""+this.tr("Find Similar Images"),t+="</span></button></div>"}},550:function(e,t,i){"use strict";var s=i(471),a=i(549);e.exports=s.extend({name:"SearchSimilarFiles",el:!1,template:a,viewMode:"modal",events:{"click ._find-similar-btn":"onFindSimilarBtnClick"},serialize:function(){return{viewMode:this.viewMode,type:this.file.get("type")}},onFindSimilarBtnClick:function(e){e.stopPropagation(),e.preventDefault(),this.app.observer.broadcast("Track:UE:File:ToSimilar"),this.app.router.redirect(this.file.makeRelatedUrl({relatedTo:"similar"}))}})},551:function(e,t){e.exports=function(e){var t='<div class="license-wizard _wizard"><div class="license-wizard__wrapper"><div class="license-wizard__fan images-fan images-fan_size-l '+e.classNames+'">',i=e.files;if(i)for(var s,a=-1,o=i.length-1;a<o;)s=i[a+=1],t+='<div class="images-fan__item images-fan__item_'+(e.files.length-1-a)+' cmp-file-thumb cmp-file-thumb_l"><img alt="'+s.seoAlt+'" src="'+s.thumbs.normal+'" class="images-fan__img',s.width>s.height?t+=" horizontal":s.width<s.height?t+=" vertical":t+=" square",t+='"></div>';e.files.length>e.maxFilesListCount&&(t+='<div class="images-fan__more">'+e.maxFilesListCount+"+</div>"),t+='</div><h2 class="license-wizard__title">'+this.tr("Licensing Wizard")+'</h2><div class="license-wizard__form-box"><div class="license-wizard__form"><form method="POST"><div class="license-wizard__fields-scroll-box _scroll"><div class="license-wizard__fields">';var l=e.splitTypes;if(l)for(var n,r=-1,c=l.length-1;r<c;)if(n=l[r+=1],e.availableLicenses.hasOwnProperty(n)){if(e.files.length>1&&(t+='<p class="files-amount">'+this.tr(e.licensingFileTypes[n])+": "+e.licensingParams.licensing[n].fileIds.length+"</p>"),t+='<label class="license-wizard__input license-wizard__input_plans-selector field-box select-box select-box-xl"><select class="select select-xl _license" name="licenseId" data-type="'+n+'">',e.availableLicenses[n]&&e.availableLicenses[n].length){var d=e.availableLicenses[n];if(d)for(var h,u=-1,p=d.length-1;u<p;)t+='<option value="'+(h=d[u+=1]).id+'"',e.licensingParams.licensing[n].licenseId===h.id&&(t+=" selected"),t+=">"+h.name+"</option>"}else t+="<option>"+this.tr("No Licenses")+"</option>";if(t+='</select><i class="arrow arrow-black arrow-bottom"></i></label><label class="license-wizard__input license-wizard__input_size-selector field-box select-box select-box-xl"><select class="select select-xl _size" name="size" data-type="'+n+'">',e.availableSizes[n]&&e.availableSizes[n].length){var f=e.availableSizes[n];if(f)for(var m,v=-1,g=f.length-1;v<g;)t+='<option value="'+(m=f[v+=1]).size+'"',e.licensingParams.licensing[n].size===m.size&&(t+=" selected"),t+=">",m.vector?t+=""+this.tr("Vect. Image"):(t+=""+m.shortName,m.label&&(t+=" | "+m.label)),m.costWithCurrency&&(t+=" | "+m.costWithCurrency),t+="</option>"}else t+="<option>"+this.tr("No Sizes")+"</option>";if(t+='</select><i class="arrow arrow-black arrow-bottom"></i></label>',e.options[n]&&e.options[n].length){t+='<div class="license-wizard__options">';var b=e.options[n];if(b)for(var _,w=-1,x=b.length-1;w<x;)t+='<div class="license-wizard__options-row">',0===(_=b[w+=1]).total?t+='<div class="license-wizard__free-option"><i class="icon license-wizard__free-option-icon"></i><span class="license-wizard__free-option-text">'+_.name+'</span><span class="checkbox-text checkbox-text_option-price">'+this.tr("Included")+"</span></div>":(t+='<label class="field-box checkbox-box checkbox-box-m"><input type="checkbox" class="checkbox _option-checkbox" data-bit="'+_.bit+'" data-type="'+n+'"',_.selected&&(t+=" checked"),t+='><i class="icon icon-checkbox icon-checkbox-m"></i><span class="checkbox-text">'+_.name+'</span><span class="checkbox-text checkbox-text_option-price">'+_.totalFormatted+"</span></label>"),t+="</div>";t+="</div>"}}var k=e.fields;if(k)for(var y,C=-1,F=k.length-1;C<F;)"input"===(y=k[C+=1]).tag?t+='<label class="license-wizard__input field-box input-box input-box-xl"><input type="'+y.type+'" class="input input-xl _field" placeholder="'+this.tr(y.placeholder)+'"name="'+y.name+'" value="'+(e.licensingParams[y.name]||"")+'"></label>':t+='<label class="license-wizard__input field-box textarea-box textarea-box-xl"><textarea class="textarea textarea-xl textarea-no-resize _field" placeholder="'+this.tr(y.placeholder)+'"name="'+y.name+'">'+(e.licensingParams[y.name]||"")+"</textarea></label>";return t+="</div></div>",e.vatRate&&e.vatEnabled&&(t+='<div class="license-wizard__vat-included">'+this.tr("Price includes VAT at %s&#37;",e.vatRate)+"</div>"),e.showTotal&&(t+='<div class="_total"></div>'),t+='<div class="license-wizard__buttons-container _buttons',e.vatRate||(t+=" license-wizard__buttons-container-margin"),t+='"><div class="license-wizard__buttons-cell license-wizard__buttons-cell_confirm"><button type="submit" class="license-wizard__submit button button-xl button-black-blue button-imitation _submit',e.ableToLicense||(t+=" disabled"),t+='"',e.ableToLicense||(t+=" disabled"),t+=">"+this.tr("Confirm")+'</button></div><div class="license-wizard__buttons-cell"><button type="submit" class="license-wizard__submit button button-xl button-blue button-imitation _submit-download',e.ableToLicense||(t+=" disabled"),t+='"',e.ableToLicense||(t+=" disabled"),t+=">"+e.downloadBtnText+"</button></div></div></form></div></div></div></div>"}},552:function(e,t){e.exports=function(e){return'<div class="batch-download-modal _modal"><i class="modal__close-button icon-close-cross icon-close-cross-white batch-download-modal__close _close"></i><div class="_body"></div></div>'}},553:function(e,t){e.exports=function(e){return'<div class="batch-download__wrapper"><div class="batch-download__box"><span class="batch-download__header">'+this.tr("Thank You for Purchase!")+'</span><span class="batch-download__info">'+this.tr('Your files are preparing to download. A link with ZIP folder will be sent to <span class="%s">%s</span>.',["link-blue",e.user.email])+'</span><i class="icon batch-download__icon"></i><button class="button button-watery button-blue button-xxl _close">'+this.tr("Ok, got it")+"</button></div></div>"}},554:function(e,t,i){"use strict";var s=i(471),a=i(553);e.exports=s.extend({name:"BatchDownload",el:!1,template:a,serialize:function(){return{user:this.app.user.serialize()}}})},555:function(e,t,i){"use strict";var s=i(475),a=i(554),o=i(552);e.exports=s.extend({template:o,draggable:!1,destroyOnHide:!0,noBorder:!0,licensed:[],notLicensed:[],footer:[],prepareRender:function(){this.setView("._body",new a({app:this.app,licensed:this.licensed,notLicensed:this.notLicensed}))},clientAfterRender:function(){this.setModalHeight();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s.prototype.clientAfterRender.apply(this,t)},setModalHeight:function(){this.$el.height(this.$("._body").height())},getContainerHeight:function(){return this.$("._body").outerHeight()}})},556:function(e,t,i){"use strict";var s=i(48),a=i(128);e.exports=s.extend({model:a})},557:function(e,t,i){"use strict";var s=i(0),a=i(9),o=i(48),l=i(99);e.exports=l.extend({url:"LicenseItem",defaults:{licensing:null,project:null,client:null,purchaseOrder:null,isbn:null,other:null},relations:{licensing:o.extend({model:a.extend({defaults:{type:null,fileIds:null,licenseId:null,size:null,optionsBitMask:null}})})},getQueryParams:function(){return this.toJSON()},serialize:function(){var e=this.toJSON(),t={};return s.each(e.licensing,function(e){return t[e.type]=e}),e.licensing=t,e}})},558:function(e,t){e.exports=function(e){var t='<div class="license-wizard__message-box"><p class="modal__text">';return e.username?t+=""+this.tr("Dear %s!",e.username):t+=""+this.tr("Dear user!"),t+="</p>",e.filesOk&&(t+='<p class="modal__text"><i class="icon icon-round-ok"></i>',e.filesOkAmount>1?t+=""+this.tr("Files %s have been licensed successfully.",e.filesOk):t+=""+this.tr("File %s has been licensed successfully.",e.filesOk),t+="</p>"),e.filesFail&&(t+='<p class="modal__text"><i class="icon icon-round-fail"></i>',e.filesFailAmount>1?t+=""+this.tr("Files %s have not been licensed. Your account does not have sufficient funds to do this operation.",e.filesFail):t+=""+this.tr("File %s has not been licensed. Your account does not have sufficient funds to do this operation.",e.filesFail),t+="</p>"),t+="</div>"}},559:function(e,t,i){"use strict";var s=i(1),a=s(i(10)),o=s(i(494)),l=i(0),n=function(e){function t(t){var s;return s=e.call(this,t)||this,l.extend((0,o.default)(s),{template:i(558)},t),s}return(0,a.default)(t,e),t.prototype.serialize=function(){return l.clone(this.data)},t}(i(471));e.exports=n},560:function(e,t){e.exports=function(e){var t='<div class="file-view__thumb-wrapper" data-id="'+e.file.id+'"><div class="file-box view-file-box _file-box '+e.fileViewBoxClassNames+'"><div class="view-file-box__holder _file-box-holder">';return"video"===e.file.type?(t+='<div class="view-file-box__video _video-placeholder"><img class="view-file-box__video-poster _video-poster" src="'+e.thumb.src+'"width="'+e.dimensions.huge.w+'" height="'+e.dimensions.huge.h+'"',e.thumb.preload&&(t+=' data-preload="'+e.thumb.preload+'"'),("modal"===e.viewMode||e.maxHeight)&&(t+='style="',"modal"===e.viewMode&&(t+="min-width: "+e.dimensions.huge.w+"px; min-height: "+e.dimensions.huge.h+"px;"),e.maxHeight&&(t+=" max-height: "+e.maxHeight+"px;")),t+='alt="'+e.file.seoAlt+'" title="'+e.file.seoTitle+'" /></div>'):(t+='<a class="view-file-box__image-box view-file-box__image-box_label view-file-box__image-clear _image-box" href="'+e.thumb.download+'"><img class="view-file-box__image',e.dimensions.huge.w>=e.dimensions.huge.h?t+=" view-file-box__image_h":t+=" view-file-box__image_v",t+=" ",e.thumb.hasLabel||(t+=" view-file-box__image-clear"),t+=' _image _zoom-image" src="'+e.thumb.src+'" ',e.thumb.preload?t+=' data-preload="'+e.thumb.preload+'"':t+=' data-src="'+e.thumb.seo+'"',t+=" ",e.thumb.preloadMax&&(t+=' data-preload-max="'+e.thumb.preloadMax+'"'),t+=' width="'+e.dimensions.huge.w+'" height="'+e.dimensions.huge.h+'" ',"modal"===e.viewMode&&(t+=' style="min-width: '+e.dimensions.huge.w+"px; min-height: "+e.dimensions.huge.h+'px; margin-bottom: 0;"'),t+=' alt="'+e.file.seoAlt+'" title="'+this.tr("Download")+" - "+e.file.seoTitle+'" itemprop="image"/></a>'),"page"!==e.viewMode||e.hideDescription||(t+='<p class="view-file-box__description view-file-box__description_short _file-box-description">',"video"===e.file.type?t+=e.file.visibleDescription+" &mdash; "+this.tr("Video by %s",e.file.sellerName):(t+='<a class="view-file-box__description-link _zoom-image" href="'+e.thumb.download+'"><span class="view-file-box__description-text" itemprop="description">'+e.file.visibleDescription+"</span> &mdash; ","vector"===e.file.type?t+=""+this.tr("Vector by %s",e.file.sellerName):t+=""+this.tr("Photo by %s",e.file.sellerName),t+="</a>"),t+="</p>"),t+='</div><div class="view-file-box__action',e.actionsSmallMode&&(t+=" view-file-box__action_small"),"video"===e.file.type&&(t+=" _view-file-box-video"),t+=' _action-box" style="max-width: '+e.dimensions.huge.w+'px"><div class="view-file-box__action-push" style="padding-bottom: '+e.pushProportion+'"></div><div class="view-file-box__action-box"><span class="view-file-box__action-holder',"modal"===e.viewMode&&e.file.editorial&&(t+=" view-file-box__action-holder_tall"),t+='">',e.isCartBtnEnabled&&(t+='<button class="view-file-box__action-item button-circle button-circle-xl button-add-to-cart',e.file.inCart&&(t+=" active"),t+=' _to-cart"title="',e.file.inCart?t+=""+this.tr("Remove from Shopping Cart"):t+=""+this.tr("Add to Shopping Cart"),t+='"></button>'),e.isFavoriteBtnEnabled&&(t+='<button class="view-file-box__action-item button-circle button-circle-xl button-add-to-favorites _to-favorites',e.file.inFavorites&&(t+=" active"),t+='"title="',e.file.inFavorites?t+=""+this.tr("Remove from Favorites"):t+=""+this.tr("Add to Favorites"),t+='"></button>'),t+='<button class="view-file-box__action-item button-circle button-circle-xl button-share _share" title="'+this.tr("Share")+'"></button>',e.isEnterpriseUser||(t+='<a class="view-file-box__action-item button-circle button-circle-xl button-download _download_comp" ',e.canDownloadComp&&(t+='href="'+e.thumb.download+'?download=true" '),t+='title="'+this.tr("Download Comp")+'"></a>'),t+='</span></div></div><div class="view-file-box__share _share-box" style="max-width: '+e.dimensions.huge.w+'px"><div class="view-file-box__action-push" style="padding-bottom: '+e.pushProportion+'"></div><div class="view-file-box__share-container"><div class="view-file-box__share-box"><div class="view-file-box__share-holder"><i class="view-file-box__close icon icon-close-cross icon-close-cross-white _share-close"></i><ul class="view-file-box__list"><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="730" data-height="420" data-title="Tweet" data-social="twitter"><span class="button-circle button-circle-xl button-social-twitter"></span></a></li><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="650" data-height="370" data-title="Facebook" data-social="facebook"><span class="button-circle button-circle-xl button-social-facebook"></span></a></li><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="700" data-height="450" data-title="Google" data-social="google"><span class="button-circle button-circle-xl button-social-google"></span></a></li><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="700" data-height="370" data-title="Pinterest" data-social="pinterest"><span class="button-circle button-circle-xl button-social-pinterest"></span></a></li>',e.showVKSocial&&(t+='<li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="700" data-height="370" data-title="VK" data-social="vk"><span class="button-circle button-circle-xl button-social-vk"></span></a></li>'),t+='</ul></div></div></div></div><div class="view-file-box__indicator">',e.isCartBtnEnabled&&(t+='<i class="view-file-box__indicator-item label-in-cart _label-in-cart',e.file.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></i>'),e.isFavoriteBtnEnabled&&(t+='<i class="view-file-box__indicator-item label-in-favorites _label-in-favorites',e.file.inFavorites||(t+=" hidden"),t+='" title="'+this.tr("Added to Favorites")+'"></i>'),t+="</div>","video"!==e.file.type&&(t+='<button class="view-file-box__lens button-zoom"></button>'),"modal"===e.viewMode&&e.file.editorial&&(t+='<div class="view-file-box__editorial-box',"video"===e.file.type&&(t+=" view-file-box__editorial-box-video"),t+='"><span class="view-file-box__editorial"><span class="view-file-box__editorial-text">'+this.tr("Editorial Use Only")+'</span><i class="view-file-box__editorial-icon icon icon-help icon-help-light-active _editorial-tooltip"></i></span></div>'),t+='<div class="view-file-box__similat-btn _thumb-find-similar"></div></div></div>'}},561:function(e,t,i){"use strict";var s=i(1)(i(10)),a=i(474),o=i(127),l=i(62),n=function(e){function t(t){var i;return void 0===t&&(t={}),(i=e.call(this,t)||this).title=t.title||o.NeedAuthTitle,i.message=t.message||i.tr(o.NeedAuthFavoritesMessage),i.footer=[{label:o.LoginBtn,hide:!0,callback:"loginHandler"},{label:o.CreateAccBtn,hide:!0,color:"blue",callback:"signupHandler"}],i}(0,s.default)(t,e);var i=t.prototype;return i.loginHandler=function(){this.app.observer.broadcast("Track:UE:Login:LoginButtonClick",{route:this.app.router.routeName,location:this.app.router.routeName+" "+this.app.url}),l.fire("Tooltip:LoginToggle",{options:{anchor:document.querySelector("._btn-sign-in")}})},i.signupHandler=function(){var e=this;this.app.observer.broadcast("Track:UE:SignUp:CreateAccButtonClick",{route:this.app.router.routeName,location:this.app.router.routeName+" "+this.app.url});var t="Free50Files"===this.app.router.routeName?"signup-simple":"signup";this.app.chain.initChain(t).then(function(){return e.app.chain.start()})},t}(a);e.exports=n},562:function(e,t){e.exports=function(e){var t='<div class="modal _modal '+e.modalClasses+'"><div class="modal__dialog"><div class="modal__zoom _body" style="width: '+e.dimensions.w+"px; height: "+e.dimensions.h+'px;"><div class="_wrap" style="width: '+e.dimensions.w+"px; height: "+e.dimensions.h+'px;"><img class="modal__zoom-image" src="'+e.file.src+'" data-preload="'+e.file.preload+'" alt="'+e.file.seoAlt+'" title="'+e.file.seoTitle+'"></div></div><div class="modal__zoom-caption';if(e.showDownloadButton&&(t+=" modal__zoom-caption_with-button"),t+=' _caption" style="width: '+e.dimensions.w+'px;"><div class="modal__zoom-caption-text-box"><span class="modal__zoom-caption-text">'+e.file.seoTitle+"</span>",e.showDownloadButton&&(t+='<span class="modal__zoom-caption-button"><button class="button button-xl button-watery button-blue _download">'+this.tr("Download")+"</button></span>"),t+="</div></div></div>",e.opacity.length){t+='<div class="bg-selector _opacity-range"><div class="bg-selector__content">';var i=e.opacity;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<div class="bg-selector__handler _opacity-switcher ',(s=i[a+=1]).active&&(t+="bg-selector__handler_active"),t+='"><i class="bg-selector__handler-item" style="opacity: '+(1-s.value/100)+';"></i></div>';t+="</div></div>"}return e.navigation.left&&(t+='<i class="modal__zoom-nav modal__zoom-nav_left button-nav button-nav-left _zoom-prev"></i>'),e.navigation.right&&(t+='<i class="modal__zoom-nav modal__zoom-nav_right button-nav button-nav-right _zoom-next"></i>'),t+="</div>"}},563:function(e,t,i){"use strict";var s=i(0),a=i(40),o=i(471),l=i(14);e.exports=o.extend({el:!1,serialize:function(){return{showNotice:this.isFree50DownloadEnabled()}},isFree50DownloadEnabled:function(){return!this.app.user.isEnterprise()&&this.app.user.isFreeDownloadEnabled()&&s.contains(a.free50Files,+this.model.get("id"))&&"Free50Files"!==l.getRoute(this.app.url).name}})},564:function(e,t){e.exports=function(e){var t='<div class="file-view__info-wrapper"><div class="file-view__info"><a class="file-view__info-avatar" href="'+e.portfolioLink+'"><span class="avatar-box avatar-box-m"><img class="avatar avatar-m" src="'+e.avatar+'" alt="'+e.file.sellerName+'"></span></a><div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Copyright")+": "+this.seo.space+'</span><span class="file-view__info-value"><a class="';return"modal"===e.viewMode?t+="link-blue-on-dark":t+="link-blue",t+=' _portfolio" href="'+e.portfolioLink+'"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">'+e.file.sellerName+'</span><meta itemprop="url" content="'+e.portfolioLink+'" /></span></a>'+this.seo.space+'<span class="hidden" itemprop="provider">Depositphotos</span></span></div><div class="file-view__info-line"><span class="file-view__info-name">',"video"===e.file.type?t+=""+this.tr("Clip ID"):"vector"===e.file.type?t+=""+this.tr("Vector ID"):e.file.editorial?t+=""+this.tr("Photography ID"):t+=""+this.tr("Image ID"),t+=":"+this.seo.space+'</span><span class="file-view__info-value">'+e.file.id+"</span></div></div></div>"}},565:function(e,t){e.exports=function(e){var t='<div class="series-box';e.series.className&&(t+=" "+e.series.className),t+=' _series-box">';var i=e.series.elements;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<a class="series-box__link-poster _link" href="'+((s=i[a+=1]).url||s.urlVar)+'" style="background-image: url('+s.resource.src.jpg+')">',s.trTitle?t+=""+s.trTitle:t+=""+s.title,t+="</a>";return t+="</div>"}},566:function(e,t,i){"use strict";e.exports={6:{similar:[34,37]},7:{similar:[18,42]},8:{similar:[13,23]},9:{similar:[15,16]},10:{similar:[12,29]},11:{similar:[10,33]},12:{similar:[10,29]},13:{similar:[8,30]},14:{similar:[13,22]},15:{similar:[9,16]},16:{similar:[9,15]},17:{similar:[25,36]},18:{similar:[7,42]},19:{similar:[10,35]},20:{similar:[16,35]},21:{similar:[34,37]},22:{similar:[36,39]},23:{similar:[8,15]},24:{similar:[10,12]},25:{similar:[17,44]},26:{similar:[29,42]},27:{similar:[8,13]},28:{similar:[18,42]},29:{similar:[10,12]},30:{similar:[8,13]},31:{similar:[8,29]},32:{similar:[17,29]},33:{similar:[10,11]},34:{similar:[6,21]},35:{similar:[19,20]},36:{similar:[17,22]},37:{similar:[6,21]},38:{similar:[22,44]},39:{similar:[22,29]},41:{similar:[8,30]},42:{similar:[7,18]},43:{similar:[13,30]},44:{similar:[22,25]}}},567:function(e,t,i){"use strict";e.exports.base={connectToSortable:"._sortable-files",cancel:".vjs-control-bar",addClasses:!1,appendTo:"body",cursor:"move",cursorAt:{top:15,left:0},scroll:!1,opacity:.5,zIndex:4001,distance:5,delay:150}},568:function(e,t){e.exports=function(e){var t="";return"search"===e.mode&&(t+='<div class="'+e.layoutClasses+'">',"wide"===e.settings.layout?(t+='<div data-id="'+e.model.id+'" class="'+e.fileBoxClasses+" file-box_"+e.model.type+' file-wide-box file-wide-box_align" ',e.itemsData[e.model.id]&&(t+='style="'+e.itemsData[e.model.id].boxStyle+'"'),t+=">",e.model.free&&(t+='<svg width="0" height="0" class="file-box__svg-label"><defs><clipPath id="red-label-clippath" clipPathUnits="objectBoundingBox"><polygon points="0 0, 0.5 1, 1 0"></polygon></clipPath></defs></svg>'),t+='<a class="file-wide-box__link _file-box-link file-wide-box__link_align" href="'+e.model.url+'"',e.settings.linkTarget&&(t+=' target="_blank"'),e.itemsData[e.model.id]&&(t+=' style="',"video"!==e.model.type?t+=""+e.itemsData[e.model.id].holderStyle:t+=""+e.itemsData[e.model.id].linkStyle,t+='"'),t+='><span class="file-wide-box__holder file-box-image _file-box-holder _file-box-image"><img src="',e.previousLayout?t+=""+e.model.thumbs[e.previousLayout]:t+=""+e.model.thumbs[e.settings.layout],t+='"',e.previousLayout&&(t+=' data-next-src="'+e.model.thumbs[e.settings.layout]+'"'),t+='class="file-wide-box__image',e.model.width>e.model.height?t+=" file-wide-box__image_v":e.model.width<e.model.height?t+=" file-wide-box__image_h":t+=" file-wide-box__image_s","video"===e.model.type&&(t+=" file-wide-box__image_video"),t+=' _file-box-image-src _remove-title-attr"alt="'+e.model.seoAlt+'" title="'+e.model.seoTitle+'"',e.itemsData[e.model.id]&&(t+=' style="'+e.itemsData[e.model.id].imageStyle+'"'),t+=' /></span></a><div class="file-wide-box__title"><a class="file-wide-box__title-link" href="'+e.model.url+'" ',e.settings.linkTarget&&(t+='target="_blank"'),t+=">"+e.model.calculatedSeoTitle+'</a></div><div class="file-wide-box__actions '+e.itemsData[e.model.id].className+'">',e.isEnterpriseUser||(t+='<button class="file-box__action-item button button-circle button-add-to-cart',e.model.inCart&&(t+=" active"),t+=' _to-cart"title="',e.model.inCart?t+=""+this.tr("Remove from Shopping Cart"):t+=""+this.tr("Add to Shopping Cart"),t+='"></button>'),t+='<button class="file-box__action-item button button-circle button-add-to-favorites',e.model.inFavorites&&(t+=" active"),t+=' _to-favorites"title="',e.model.inFavorites?t+=""+this.tr("Remove from Favorites"):t+=""+this.tr("Add to Favorites"),t+='"></button><button class="file-box__action-item button button-circle '+e.actionButtonType+' button-see-more-similars _to-similar"title="',"video"===e.model.type?t+=""+this.tr("Find Similar Videos"):t+=""+this.tr("Find Similar Images"),t+='"></button></div>',"video"!==e.model.type&&(t+='<div class="file-wide-box__zoom"><button class="file-box__action-zoom button-zoom button-zoom-small _zoom" title="'+this.tr("Quick Preview")+'"></button></div>',e.isFolder&&e.isEditableFolder&&(t+='<div class="file-wide-box__cover"><button class="file-box__action-cover button-cover _cover" title="'+this.tr("Set as Folder Cover")+'"></button></div>')),t+='<div class="file-wide-box__info">',e.model.free&&(t+='<div class="file-box__sale-free',e.model.isFreeCurated&&(t+=" file-box__sale-free_simple"),t+='"><div class="label label-sale',e.model.isFreeCurated&&(t+=" label-sale_curated"),t+='">'+e.model.freeLabel+"</div></div>"),t+='<div class="file-box__indicator">',e.isEnterpriseUser||(t+='<span class="file-box__indicator-item label label-in-cart _label-in-cart ',e.model.inCart||(t+=" hidden"),t+='"title="'+this.tr("In Shopping Cart")+'"></span>'),t+='<span class="file-box__indicator-item label label-in-favorites _label-in-favorites',e.model.inFavorites||(t+=" hidden"),t+='"title="'+this.tr("Added to Favorites")+'"></span></div><div class="file-box__type label label-type label-type-'+e.model.type+'"></div><div class="file-box__contributor label label-contributor">'+e.model.sellerName+'</div><div class="file-box__maxsize label label-maxsize">'+e.model.width+" x "+e.model.height+"</div>","video"===e.model.type&&(t+='<div class="file-box__video-length label label-video-length">'+e.model.formattedLength+"</div>"),t+="</div></div>"):(t+='<div data-id="'+e.model.id+'" class="'+e.fileBoxClasses+'" ',e.itemsData[e.model.id]&&(t+='style="'+e.itemsData[e.model.id].boxStyle+'"'),t+='><div class="file-box__link _file-box-link" ',e.itemsData[e.model.id]&&(t+='style="'+e.itemsData[e.model.id].linkStyle+'"'),t+='><a class="file-box__holder _file-box-holder" href="'+e.model.url+'" ',e.settings.linkTarget&&(t+='target="_blank"'),t+='><span class="'+e.imageHolderClasses,e.model.width>e.model.height?(t+=" file-box__image-holder_vertical",e.model.height/e.model.width<110/170&&(t+=" file-box__image-holder_limit")):e.model.width<e.model.height?(t+=" file-box__image-holder_horizontal",e.model.width/e.model.height<110/170&&(t+=" file-box__image-holder_limit")):t+=" file-box__image-holder_square",t+=' _file-box-image" ',e.itemsData[e.model.id]&&(t+='style="'+e.itemsData[e.model.id].holderStyle+'"'),t+='><img src="',e.previousLayout?t+=""+e.model.thumbs[e.previousLayout]:t+=""+e.model.thumbs[e.settings.layout],t+='"',e.previousLayout&&(t+=' data-next-src="'+e.model.thumbs[e.settings.layout]+'"'),t+=' class="file-box-image__image _file-box-image-src _remove-title-attr"  alt="'+e.model.seoAlt+'" title="'+e.model.seoTitle+'" /><span class="file-box-image__title">'+e.model.calculatedSeoTitle+"</span></span></a>",e.model.free&&(t+='<div class="file-box__sale-free',e.model.isFreeCurated&&(t+=" file-box__sale-free_simple"),t+='"><div class="label label-sale',e.model.isFreeCurated&&(t+=" label-sale_curated"),t+='">'+e.model.freeLabel+"</div></div>"),t+='<div class="file-box__indicator">',e.isEnterpriseUser||(t+='<span class="file-box__indicator-item label label-in-cart _label-in-cart ',e.model.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span>'),t+='<span class="file-box__indicator-item label label-in-favorites _label-in-favorites',e.model.inFavorites||(t+=" hidden"),t+='" title="'+this.tr("Added to Favorites")+'"></span></div><div class="file-box__type label label-type label-type-'+e.model.type+'"></div><div class="file-box__contributor label label-contributor">'+e.model.sellerName+'</div><div class="file-box__maxsize label label-maxsize">'+e.model.width+" x "+e.model.height+'</div><div class="file-box__action '+e.itemsData[e.model.id].className+'">',e.isEnterpriseUser||(t+='<button class="file-box__action-item button button-circle '+e.actionButtonType+" button-add-to-cart",e.model.inCart&&(t+=" active"),t+=' _to-cart"title="',e.model.inCart?t+=""+this.tr("Remove from Shopping Cart"):t+=""+this.tr("Add to Shopping Cart"),t+='"></button>'),t+='<button class="file-box__action-item button button-circle '+e.actionButtonType+" button-add-to-favorites",e.model.inFavorites&&(t+=" active"),t+=' _to-favorites"title="',e.model.inFavorites?t+=""+this.tr("Remove from Favorites"):t+=""+this.tr("Add to Favorites"),t+='"></button><button class="file-box__action-item button button-circle '+e.actionButtonType+' button-see-more-similars _to-similar"title="',"video"===e.model.type?t+=""+this.tr("Find Similar Videos"):t+=""+this.tr("Find Similar Images"),t+='"></button></div>',"video"!==e.model.type&&(t+='<div class="file-box__zoom"><button class="file-box__action-zoom button-zoom button-zoom-small _zoom" title="'+this.tr("Quick Preview")+'"></button></div>',e.isFolder&&(t+='<div class="file-box__cover"><button class="file-box__action-cover button-cover _cover" title="'+this.tr("Set as Folder Cover")+'"></button></div>')),t+="</div></div>"),t+="</div>"),"favorite"===e.mode&&(t+='<div class="files-list_layout-'+e.panel.thumbs+'"><div data-id="'+e.model.id+'" class="file-box folder-file-box _favorite-file',-1!==e.listOfSelected.indexOf(e.model.id)&&(t+=" file-box_selected"),t+='"><a class="file-box__link" href="'+e.model.url+'"><span class="file-box__holder"><span class="file-box-image file-box__image-holder',e.model.width>e.model.height&&e.model.height/e.model.width<.5&&(t+=" file-box__image-holder_limit"),t+='"style="background-image: url('+e.model.thumbs[e.thumbSizes[e.panel.thumbs]]+')"></span><span class="file-box-video"></span></span><span class="file-box__indicator"><span class="file-box__indicator-item label label-in-cart _label-in-cart ',e.model.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span></span><span class="file-box__control _prevent"><i class="file-box__control-item',e.viewOnly?t+=" file-box__control-item_disabled ":t+=" _delete",t+=' icon icon-item-remove"></i><i class="file-box__control-item',e.viewOnly&&(t+=" file-box__control-item_disabled"),t+=' icon icon-item-move"></i><i class="file-box__control-item icon icon-checkbox icon-checkbox-l _select',-1!==e.listOfSelected.indexOf(e.model.id)&&(t+=" checked"),t+='"></i><span class="file-box__blur"><img class="file-box__blur-image" src="'+e.model.thumbs[e.panel.thumbs]+'" style="filter: url(#blur'+e.model.id+')" />\x3c!--[if !(lte IE 8)]><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="0" height="0"><filter id="blur'+e.model.id+'"><feGaussianBlur in="SourceGraphic" stdDeviation="10" /></filter></svg><![endif]--\x3e</span></span></a></div></div>'),"filePage"===e.mode&&(t+='<div class="file-box view-file-box _file-box '+e.fileViewBoxClassNames+'"><div class="view-file-box__holder _file-box-holder">',"video"===e.file.type?(t+='<div class="view-file-box__video _video-placeholder"><img class="view-file-box__video-poster _video-poster" src="'+e.thumb.src+'"width="'+e.dimensions.huge.w+'" height="'+e.dimensions.huge.h+'"',e.thumb.preload&&(t+=' data-preload="'+e.thumb.preload+'"'),("modal"===e.viewMode||e.maxHeight)&&(t+='style="',"modal"===e.viewMode&&(t+="min-width: "+e.dimensions.huge.w+"px; min-height: "+e.dimensions.huge.h+"px;"),e.maxHeight&&(t+=" max-height: "+e.maxHeight+"px;")),t+='alt="'+e.file.seoAlt+'" title="'+e.file.seoTitle+'" /></div>'):(t+='<a class="view-file-box__image-box view-file-box__image-box_label view-file-box__image-clear _image-box" href="'+e.thumb.download+'"><img class="view-file-box__image',e.dimensions.huge.w>=e.dimensions.huge.h?t+=" view-file-box__image_h":t+=" view-file-box__image_v",t+=" ",e.thumb.hasLabel||(t+=" view-file-box__image-clear"),t+=' _image _zoom-image" src="'+e.thumb.src+'" ',e.thumb.preload?t+=' data-preload="'+e.thumb.preload+'"':t+=' data-src="'+e.thumb.seo+'"',t+=" ",e.thumb.preloadMax&&(t+=' data-preload-max="'+e.thumb.preloadMax+'"'),t+=' width="'+e.dimensions.huge.w+'" height="'+e.dimensions.huge.h+'" ',"modal"===e.viewMode&&(t+=' style="min-width: '+e.dimensions.huge.w+"px; min-height: "+e.dimensions.huge.h+'px; margin-bottom: 0;"'),t+=' alt="'+e.file.seoAlt+'" title="'+this.tr("Download")+" - "+e.file.seoTitle+'" itemprop="image"/></a>'),"page"!==e.viewMode||e.hideDescription||(t+='<p class="view-file-box__description view-file-box__description_short _file-box-description">',"video"===e.file.type?t+=e.file.visibleDescription+" &mdash; "+this.tr("Video by %s",e.file.sellerName):(t+='<a class="view-file-box__description-link _zoom-image" href="'+e.thumb.download+'"><span class="view-file-box__description-text" itemprop="description">'+e.file.visibleDescription+"</span> &mdash; ","vector"===e.file.type?t+=""+this.tr("Vector by %s",e.file.sellerName):t+=""+this.tr("Photo by %s",e.file.sellerName),t+="</a>"),t+="</p>"),t+='</div><div class="view-file-box__action',e.actionsSmallMode&&(t+=" view-file-box__action_small"),"video"===e.file.type&&(t+=" _view-file-box-video"),t+=' _action-box" style="max-width: '+e.dimensions.huge.w+'px"><div class="view-file-box__action-push" style="padding-bottom: '+e.pushProportion+'"></div><div class="view-file-box__action-box"><span class="view-file-box__action-holder',"modal"===e.viewMode&&e.file.editorial&&(t+=" view-file-box__action-holder_tall"),t+='">',e.isCartBtnEnabled&&(t+='<button class="view-file-box__action-item button-circle button-circle-xl button-add-to-cart',e.file.inCart&&(t+=" active"),t+=' _to-cart"title="',e.file.inCart?t+=""+this.tr("Remove from Shopping Cart"):t+=""+this.tr("Add to Shopping Cart"),t+='"></button>'),e.isFavoriteBtnEnabled&&(t+='<button class="view-file-box__action-item button-circle button-circle-xl button-add-to-favorites _to-favorites',e.file.inFavorites&&(t+=" active"),t+='"title="',e.file.inFavorites?t+=""+this.tr("Remove from Favorites"):t+=""+this.tr("Add to Favorites"),t+='"></button>'),t+='<button class="view-file-box__action-item button-circle button-circle-xl button-share _share" title="'+this.tr("Share")+'"></button>',e.isEnterpriseUser||(t+='<a class="view-file-box__action-item button-circle button-circle-xl button-download _download_comp" ',e.canDownloadComp&&(t+='href="'+e.thumb.download+'?download=true" '),t+='title="'+this.tr("Download Comp")+'"></a>'),t+='</span></div></div><div class="view-file-box__share _share-box" style="max-width: '+e.dimensions.huge.w+'px"><div class="view-file-box__action-push" style="padding-bottom: '+e.pushProportion+'"></div><div class="view-file-box__share-container"><div class="view-file-box__share-box"><div class="view-file-box__share-holder"><i class="view-file-box__close icon icon-close-cross icon-close-cross-white _share-close"></i><ul class="view-file-box__list"><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="730" data-height="420" data-title="Tweet" data-social="twitter"><span class="button-circle button-circle-xl button-social-twitter"></span></a></li><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="650" data-height="370" data-title="Facebook" data-social="facebook"><span class="button-circle button-circle-xl button-social-facebook"></span></a></li><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="700" data-height="450" data-title="Google" data-social="google"><span class="button-circle button-circle-xl button-social-google"></span></a></li><li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="700" data-height="370" data-title="Pinterest" data-social="pinterest"><span class="button-circle button-circle-xl button-social-pinterest"></span></a></li>',e.showVKSocial&&(t+='<li class="view-file-box__list-item"><a class="view-file-box__share-item button-social button-social-share _share-button" rel="nofollow" data-width="700" data-height="370" data-title="VK" data-social="vk"><span class="button-circle button-circle-xl button-social-vk"></span></a></li>'),t+='</ul></div></div></div></div><div class="view-file-box__indicator">',e.isCartBtnEnabled&&(t+='<i class="view-file-box__indicator-item label-in-cart _label-in-cart',e.file.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></i>'),e.isFavoriteBtnEnabled&&(t+='<i class="view-file-box__indicator-item label-in-favorites _label-in-favorites',e.file.inFavorites||(t+=" hidden"),t+='" title="'+this.tr("Added to Favorites")+'"></i>'),t+="</div>","video"!==e.file.type&&(t+='<button class="view-file-box__lens button-zoom"></button>'),"modal"===e.viewMode&&e.file.editorial&&(t+='<div class="view-file-box__editorial-box',"video"===e.file.type&&(t+=" view-file-box__editorial-box-video"),t+='"><span class="view-file-box__editorial"><span class="view-file-box__editorial-text">'+this.tr("Editorial Use Only")+'</span><i class="view-file-box__editorial-icon icon icon-help icon-help-light-active _editorial-tooltip"></i></span></div>'),t+='<div class="view-file-box__similat-btn _thumb-find-similar"></div></div>'),"related"===e.mode&&(t+='<div data-id="'+e.model.id+'"class="file-box',e.filesListFillEnabled&&(t+=" file-box_mode-fill"),t+=" related-file-box","video"===e.model.type?t+=" related-file-box_video":t+=" related-file-box_image",t+=" related-file-box_mode-"+e.viewMode,e.itemsData&&e.itemsData[e.model.id]&&(e.itemsData[e.model.id].isLastRow&&e.itemsData[e.model.id].row>2&&(t+=" related-file-box_last"),e.itemsData[e.model.id].isNarrow&&(t+=" related-file-box_narrow")),e.model.seeMore?t+=" related-file-box_see-more":t+=" _related-file-activate",e.titleInside&&(t+=" file-wide-box"),t+=' _related-file"',"page"!==e.viewMode&&e.sortImagesEnabled&&(t+=' style="opacity: 0"'),e.itemsData&&e.itemsData[e.model.id]&&(t+=' style="'+e.itemsData[e.model.id].boxStyle+'"'),t+=">",e.filesListFillEnabled&&(t+='<div class="file-box__overlay">'),t+='<a class="file-box__link _file-box-link',e.titleInside&&(t+=" file-wide-box__link"),t+='" href="'+e.model.url+'" ',e.itemsData&&e.itemsData[e.model.id]&&(t+=' style="'+e.itemsData[e.model.id].holderStyle+'"'),t+='><span class="file-box__holder"><span class="file-box-image file-box__image-holder',e.model.width>e.model.height?(t+=" file-box__image-holder_vertical",e.model.height/e.model.width<110/170&&(t+=" file-box__image-holder_limit")):e.model.width<e.model.height?(t+=" file-box__image-holder_horizontal",e.model.width/e.model.height<110/170&&(t+=" file-box__image-holder_limit")):t+=" file-box__image-holder_square",t+=' _file-box-image"><img onload="',"page"!==e.viewMode&&!e.model.seeMore&&e.sortImagesEnabled&&(t+="sortImagesByLoading(this)"),t+='"',e.lockUploadFiles&&(t+=' src="'+this.app.cdnPath+'_img/pixel.png" data-'),t+='src="',e.model.seeMore?t+=""+e.model.thumbs.big:e.filesListLargeEnabled?t+=""+e.model.thumbs.normalWide:e.filesListWideEnabled?t+=""+e.model.thumbs.wide:e.filesListFillEnabled?t+=""+e.model.thumbs.big:t+=""+e.model.thumbs.normal,t+='"class="file-box-image__image _file-box-image-src" alt="'+e.model.seoAlt+'"',e.hideImgTitle||(t+=' title="'+e.model.seoTitle+'"'),e.itemsData&&e.itemsData[e.model.id]&&(t+=' style="'+e.itemsData[e.model.id].imageStyle+'"'),t+=" /></span>",e.titleInside?t+='<span class="file-wide-box__title"><span class="file-wide-box__title-link">'+e.model.calculatedSeoTitle+"</span></span>":t+='<span class="file-box-image__title">'+e.model.calculatedSeoTitle+" #"+e.model.id+"</span>",t+='</span><span class="file-box__indicator">',e.isCartBtnEnabled&&(t+='<span class="file-box__indicator-item label label-in-cart _label-in-cart',e.model.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span>'),e.isFavoriteBtnEnabled&&(t+='<span class="file-box__indicator-item label label-in-favorites _label-in-favorites',e.model.inFavorites||(t+=" hidden"),t+='" title="'+this.tr("Added to Favorites")+'"></span>'),t+='</span><span class="file-box__action',e.titleInside&&(t+=" file-wide-box__action"),t+='">',e.isCartBtnEnabled&&(t+='<button class="file-box__action-item button button-circle button-add-to-cart',e.model.inCart&&(t+=" active"),t+=' _to-cart"title="',e.model.inCart?t+=""+this.tr("Remove from Shopping Cart"):t+=""+this.tr("Add to Shopping Cart"),t+='"></button>'),e.isFavoriteBtnEnabled&&(t+='<button class="file-box__action-item button button-circle button-add-to-favorites',e.model.inFavorites&&(t+=" active"),t+=' _to-favorites"title="',e.model.inCart?t+=""+this.tr("Remove from Favorites"):t+=""+this.tr("Add to Favorites"),t+='"></button>'),e.isSimilarBtnEnabled&&(t+='<button class="file-box__action-item button button-circle '+e.actionButtonType+' button-see-more-similars _to-similar"title="',"video"===e.model.type?t+=""+this.tr("Find Similar Videos"):t+=""+this.tr("Find Similar Images"),t+='"></button>'),t+="</span>",e.model.seeMore&&(t+='<span class="file-box__see-more"><i class="file-box__see-more-icon',"modal"===e.viewMode&&(t+="-hover"),t+=" icon ","video"===e.model.type?t+="file-box__see-more-icon_videos icon-see-more-videos-large":t+="file-box__see-more-icon_images icon-see-more-images-large",t+='"></i><i class="file-box__see-more-icon',"page"===e.viewMode&&(t+="-hover"),t+=" icon ","video"===e.model.type?t+="file-box__see-more-icon_videos icon-see-more-videos-large-hover":t+="file-box__see-more-icon_images icon-see-more-images-large-hover",t+='"></i><span class="file-box__see-more-text">',"image"===e.model.type?t+=""+this.tr("See More Pictures"):t+=""+this.tr("See More"),t+="</span></span>"),t+="</a>",e.filesListFillEnabled&&(t+="</div>"),t+="</div>"),t}},569:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(62);e.exports=a.extend({el:!1,defaultMode:"search",active:!1,template:i(568),initialize:function(e){e.mode&&(this.defaultMode=e.mode),this.listenTo(o,"Draggable:switchHelper",this.switchMode.bind(this))},serialize:function(){return this.data},clientAfterRender:function(){"search"===this.data.mode&&"wide"===this.data.thumbSize&&this.$("img").attr({style:this.data.itemsData[this.data.model.id].holderStyle})},setData:function(e){return e.mode||(e.mode=this.defaultMode),this.data=e,this.render().promise()},switchMode:function(e){if(this.active){var t=s.clone(this.data.model);s.size(s.omit(e,"mode"))<1&&(e=s.extend({},e,this.getDefaults())),this.setData(s.extend({},{model:t},e))}},getDefaults:function(){return s.result(this,"defaults")},defaults:s.noop})},570:function(e,t){e.exports=function(e){var t='<div class="file-preview';return e.editorial&&(t+=" file-preview_editorial"),t+='" style="width: '+e.width+'px;"><video class="video-js vjs-deposit-skin"width="'+e.width+'" height="'+e.height+'"',e.poster&&(t+=' poster="'+e.poster+'"'),e.autoplay&&(t+=" autoplay"),e.loop&&(t+=" loop"),e.preload&&(t+="  preload"),t+=">",e.files.mp4&&(t+='<source type="video/mp4" src="'+e.files.mp4+'"></source>'),e.isWebmAllowed&&e.files.webm&&(t+='<source type="video/webm" src="'+e.files.webm+'"></source>'),e.files.ogg&&(t+='<source type="video/ogg" src="'+e.files.ogg+'"></source>'),t+="</video>",e.showTitle&&e.title&&(t+='<p class="file-preview__title">'+e.title+"</p>"),e.isEditorial&&(t+='<span class="file-preview__editorial file-preview__editorial_video"><i class="file-preview__editorial-icon icon icon-editorial-red"></i><span>'+this.tr("Editorial Use Only")+"</span></span>"),t+="</div>"}},571:function(e,t){e.exports=function(e){var t='<div class="file-preview';return e.editorial&&(t+=" file-preview_editorial"),t+='" style="width:'+e.width+'px;"><img class="file-preview__img" src="'+e.thumb+'" data-preload="'+e.preload+'" />',e.showTitle&&e.title&&(t+='<p class="file-preview__title">'+e.title+"</p>"),e.isEditorial&&(t+='<span class="file-preview__editorial"><i class="file-preview__editorial-icon icon icon-editorial-red"></i><span>'+this.tr("Editorial Use Only")+"</span></span>"),t+="</div>"}},572:function(e,t,i){"use strict";var s=i(471),a=i(130),o=i(483),l=i(571);e.exports=s.extend({name:"FilePreviewImage",el:!1,template:l,file:null,layout:"normal",initialize:function(){this.showTitle=this.getShowTitle()},serialize:function(){var e=a.getThumbSizes(this.file.serialize(),"huge");return{width:e.w,height:e.h,preload:this.file.get("thumbs").huge,thumb:this.file.get("thumbs")[this.layout],isEditorial:this.file.get("editorial"),showTitle:this.showTitle,title:this.file.get("title")}},clientAfterRender:function(){o(this.$("img"))},getShowTitle:function(){return this.app&&this.app.features&&this.app.features.isFeatureOnValue("Show file title in preview")}})},575:function(e,t){e.exports=function(e){var t='<div class="file-view-modal file-view-modal_admin _modal '+e.classNames+'"><div class="file-view file-view_bg-black _file-view-container"><div class="file-view__title-box _title"></div><div class="file-view__left"><div class="file-view__thumb _file-view-thumb"></div></div><div class="file-view__right"><div class="file-view__rating _rating"></div></div><div class="file-view__bottom-wrapper _file-view-bottom"></div></div><div class="file-nav">';return e.displayLeftNavigation&&(t+='<i class="file-nav__item file-nav__item_left button-nav button-nav-left"></i>'),e.displayRightNavigation&&(t+='<i class="file-nav__item file-nav__item_right button-nav button-nav-right"></i>'),t+='</div><div class="file-view__btn-close _close"><i class="file-view__btn-close-icon icon icon-close-cross icon-close-cross-white _close"></i></div></div>'}},576:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(486),l=i(506),n=i(505),r=i(11).relatedTabs,c=i(504),d=i(503),h=i(502);e.exports=a.extend({name:"FileViewBottomModalAdmin",el:!1,template:c,prepareRender:function(){this.insertViews([new l({scheme:this.getTabs(),template:d}),new o({app:this.app,model:this.model,viewMode:"modal",template:h})])},serialize:function(){return{opacity:""}},clientAfterRender:function(){this.$("._related").filter('[data-tab="info"]').removeClass("hidden")},getTabs:function(){return new n([{key:"info",enabled:!0,label:s.findWhere(r,{key:"info",type:"all"}).label}])}})},577:function(e,t){e.exports=function(e){var t='<div class="file-rating';e.formLocked&&(t+=" file-rating_locked"),t+='"><div class="file-rating__buttons">';var i=e.buttons;if(i)for(var s,a=-1,o=i.length-1;a<o;)s=i[a+=1],t+='<button class="file-rating__button button button-black-blue _rate',e.attrs.rate===s&&(t+=" active"),t+='" data-value="'+s+'">'+s+"</button>";return t+='</div><div class="file-view__info-wrapper"><div class="file-view__info"><div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Rate")+':</span><span class="file-view__info-value">'+(e.attrs.rate||"-")+'</span></div><div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Actor")+':</span><span class="file-view__info-value">'+(e.attrs.actor||"-")+'</span></div><div class="file-view__info-line"><span class="file-view__info-name">'+this.tr("Date")+':</span><span class="file-view__info-value">'+(e.attrs.date||"-")+"</span></div></div></div></div>"}},578:function(e,t,i){"use strict";var s=i(0),a=i(9);e.exports=a.extend({url:"FileRating",defaults:{fileId:null,rate:null,actor:null,date:null},parse:function(e){return e.errors?{}:s.pick(e.data,s.keys(this.defaults))}})},579:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(578),l=i(474),n=i(485),r=i(577),c=s.range(n.numDigit1,n.numDigit9).concat(n.numDigit9);e.exports=a.extend({name:"FileRating",el:!1,template:r,keys:s.range(n.digit1,n.digit9).concat(n.digit9),events:{"click ._rate":"onRateClick"},globals:{keyup:"onGlobalKeyUp"},formLocked:!1,initialize:function(e){void 0===e&&(e={}),this.model=e.model||new o({},{app:this.app}),this.listenTo(this.model,{"change:rate":this.render.bind(this),request:this.onModelRequest.bind(this),sync:this.onModelSynch.bind(this)})},prepareRender:function(){return!s.isNull(this.model.get("fileId"))},serialize:function(){return{buttons:this.keys.map(function(e,t){return t+1}),attrs:this.model.serialize(),formLocked:this.formLocked}},setFile:function(e){this.model.resetToDefaults(),this.model.set({fileId:e}),this.model.fetch()},saveRate:function(e){this.model.save({rate:e},{success:this.onRateSuccess.bind(this)})},showServiceDialog:function(e){new l({title:this.tr("Service Message"),message:s.map(e,function(e){return e.error_message}).join(" ")}).show()},onRateClick:function(e){this.saveRate(parseInt(e.currentTarget.dataset.value,10))},getRateFromKeyCode:function(e){var t=this.keys.indexOf(e);return~t?t+1:c.indexOf(e)+1},onGlobalKeyUp:function(e){var t=this.getRateFromKeyCode(e.keyCode);t>0&&this.saveRate(t)},onModelRequest:function(){this.formLocked=!0,this.onRequestCallback()},onModelSynch:function(){var e=this;this.formLocked=!1,this.render().promise().done(function(){e.onSyncCallback()})},onRateSuccess:function(e,t){t.errors?(this.showServiceDialog(t.errors),this.model.resetToDefaults(s(this.model.defaults).keys().omit("fileId"))):t.result&&this.onRateCallback(t.data)},onRequestCallback:s.noop,onSyncCallback:s.noop,onRateCallback:s.noop})},580:function(e,t,i){"use strict";var s=i(0),a=i(507),o=i(498),l=i(497),n=i(579),r=i(576),c=i(575),d=i(501);e.exports=a.extend({name:"FileViewModalAdmin",el:!1,template:c,initialize:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];a.prototype.initialize.apply(this,t),this.setViews({"._file-view-thumb":new o({app:this.app,model:this.model,viewMode:"modal",zoomShowCallback:this.zoomShowCallback.bind(this),zoomHideCallback:this.zoomHideCallback.bind(this),zoomNavCallback:this.zoomNavCallback.bind(this),zoomLeftCallback:this.zoomLeftCallback.bind(this),zoomRightCallback:this.zoomRightCallback.bind(this)}),"._title":new l({app:this.app,model:this.model,template:d,viewMode:"modal"}),"._rating":new n({app:this.app,onRateSuccess:this.onRateSuccess.bind(this)}),"._file-view-bottom":new r({app:this.app,model:this.model})})},show:function(e){this.loadRating(e.model.get("id")),this.injectModel(e.model),a.prototype.show.call(this,e)},injectModel:function(e){s.each(this.views,function(t){"FileRating"!==t.name&&(t.model=e)})},loadRating:function(e){this.getView("._rating").setFile(e)},onRateSuccess:function(){this.onRightNavigation()}})},581:function(e,t){e.exports=function(e){return'<div class="file-view__loading hidden _loader"><div class="file-view__loading-icon icon icon-loader"><i class="part-circle1"></i><i class="part-circle2"></i><i class="part-circle3"></i></div></div>'}},582:function(e,t){e.exports=function(e){var t='<div class="file-view-modal _modal '+e.classNames+'"><div class="file-view-notice _notice"></div><div class="file-view _file-view-container '+e.fileViewClasses+'"><div class="file-view__title-box _title"></div><div class="file-view__left"><div class="file-view__thumb _file-view-thumb"></div><div class="file-view__links"><div class="file-view__find-similar-box _find-similar"></div><div class="file-view__design-box _design"></div></div></div><div class="file-view__right"><div class="file-view__info-box _file-view-info"></div><div class="file-view__download-method _download-method-selector"></div><div class="file-view__price-table-wrapper _price-table"></div></div><div class="file-view__bottom-wrapper _file-view-bottom"></div></div>';return e.isAvailableEnterpriseOnly&&(t+='<div class="file-view-lock"><div class="file-view-lock__wrap"><div class="file-view-lock__content"><span class="file-view-lock__text">'+this.tr("This file is available under Enterprise account only")+'</span><a class="file-view-lock__link button button-5xl button-watery button-blue" href="'+this.app.makeUrl("enterprise")+'" target="_blank">'+this.tr("Enterprise Solution")+"</a></div></div></div>"),t+='<div class="file-nav">',e.displayLeftNavigation&&(t+='<i class="file-nav__item file-nav__item_left button-nav button-nav-left"></i>'),e.displayRightNavigation&&(t+='<i class="file-nav__item file-nav__item_right button-nav button-nav-right"></i>'),t+='</div><a class="file-view__btn-back _back"><i class="license-wizard__back-arrow icon arrow-back-white _back"></i>'+this.tr("Back")+'</a><div class="file-view__btn-close _close"><i class="file-view__btn-close-icon icon icon-close-cross icon-close-cross-white _close"></i></div></div>'}},583:function(e,t,i){"use strict";e.exports=function(e){var t=function(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i]==t)return!0;return!1},i=function(e,i){for(var s=document.querySelectorAll(i),a=e.parentNode;a&&!t(s,a);)a=a.parentNode;return a};e.removeAttribute("onload");var s=i(e,".related-file-box");if(s){var a=s.parentNode;if(a){var o=i(a,".file-view__related");if(o){var l=window.rc[["portfolio","similar","model","series"].indexOf(o.getAttribute("data-tab"))]++;s.setAttribute("data-loaded",l+1);var n=o.querySelectorAll("[data-loaded]").length;if(n?a.insertBefore(s,a.childNodes[n-1]):a.insertBefore(s,a.firstChild),s.style.opacity=1,n===a.querySelectorAll("._related-file").length-1){var r=a.querySelector(".related-file-box_see-more");r&&(r.style.opacity=1)}}}}}},585:function(e,t){e.exports=function(e){var t='<div class="file-view__related file-view__related_categories related-item hidden _related" data-tab="'+e.relatedMode+'"><div class="related-item__content related-item__content_category" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><ul class="related-item__list"><li class="related-item__list-item _poster-box"></li>';if(e.file.categories.length){var i=e.file.categories;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<li class="related-item__list-item _item"><a class="related-item__category" href="'+(s=i[a+=1]).url+'" itemprop="url"style="background-image: url('+this.app.cdnPath+"_img/categories/"+s.alias+'.jpg)"><span class="related-item__category-text" itemprop="title">'+this.tr(s.name)+"</span></a></li>"}return t+="</ul></div></div>"}},586:function(e,t){e.exports=function(e){var t='<div class="file-view__related hidden _related" data-tab="'+e.relatedMode+'"><div class="file-view__related-nav file-view__related-nav_compact file-view__related-nav_left _nav-left';e.sliderShift||(t+=" hidden"),t+='"><i class="file-view__related-nav-icon icon icon-nav-arrow-left-white-big"></i></div><div class="file-view__related-files files-list files-list_related _related-files-box',(e.filesListWideEnabled||e.filesListLargeEnabled)&&(t+=" files-list_related-wide"),t+='"',e.sliderShift&&(t+=' style="margin-left: '+e.sliderShift+'px"'),t+=">";var i=e.items;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<div data-id="'+(s=i[a+=1]).id+'"class="file-box',e.filesListFillEnabled&&(t+=" file-box_mode-fill"),t+=" related-file-box","video"===s.type?t+=" related-file-box_video":t+=" related-file-box_image",t+=" related-file-box_mode-"+e.viewMode,e.itemsData&&e.itemsData[s.id]&&(e.itemsData[s.id].isLastRow&&e.itemsData[s.id].row>2&&(t+=" related-file-box_last"),e.itemsData[s.id].isNarrow&&(t+=" related-file-box_narrow")),s.seeMore?t+=" related-file-box_see-more":t+=" _related-file-activate",e.titleInside&&(t+=" file-wide-box"),t+=' _related-file"',"page"!==e.viewMode&&e.sortImagesEnabled&&(t+=' style="opacity: 0"'),e.itemsData&&e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].boxStyle+'"'),t+=">",e.filesListFillEnabled&&(t+='<div class="file-box__overlay">'),t+='<a class="file-box__link _file-box-link',e.titleInside&&(t+=" file-wide-box__link"),t+='" href="'+s.url+'" ',e.itemsData&&e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].holderStyle+'"'),t+='><span class="file-box__holder"><span class="file-box-image file-box__image-holder',s.width>s.height?(t+=" file-box__image-holder_vertical",s.height/s.width<110/170&&(t+=" file-box__image-holder_limit")):s.width<s.height?(t+=" file-box__image-holder_horizontal",s.width/s.height<110/170&&(t+=" file-box__image-holder_limit")):t+=" file-box__image-holder_square",t+=' _file-box-image"><img onload="',"page"!==e.viewMode&&!s.seeMore&&e.sortImagesEnabled&&(t+="sortImagesByLoading(this)"),t+='"',e.lockUploadFiles&&(t+=' src="'+this.app.cdnPath+'_img/pixel.png" data-'),t+='src="',s.seeMore?t+=""+s.thumbs.big:e.filesListLargeEnabled?t+=""+s.thumbs.normalWide:e.filesListWideEnabled?t+=""+s.thumbs.wide:e.filesListFillEnabled?t+=""+s.thumbs.big:t+=""+s.thumbs.normal,t+='"class="file-box-image__image _file-box-image-src" alt="'+s.seoAlt+'"',e.hideImgTitle||(t+=' title="'+s.seoTitle+'"'),e.itemsData&&e.itemsData[s.id]&&(t+=' style="'+e.itemsData[s.id].imageStyle+'"'),t+=" /></span>",e.titleInside?t+='<span class="file-wide-box__title"><span class="file-wide-box__title-link">'+s.calculatedSeoTitle+"</span></span>":t+='<span class="file-box-image__title">'+s.calculatedSeoTitle+" #"+s.id+"</span>",t+='</span><span class="file-box__indicator">',e.isCartBtnEnabled&&(t+='<span class="file-box__indicator-item label label-in-cart _label-in-cart',s.inCart||(t+=" hidden"),t+='" title="'+this.tr("In Shopping Cart")+'"></span>'),e.isFavoriteBtnEnabled&&(t+='<span class="file-box__indicator-item label label-in-favorites _label-in-favorites',s.inFavorites||(t+=" hidden"),t+='" title="'+this.tr("Added to Favorites")+'"></span>'),t+='</span><span class="file-box__action',e.titleInside&&(t+=" file-wide-box__action"),t+='">',e.isCartBtnEnabled&&(t+='<button class="file-box__action-item button button-circle button-add-to-cart',s.inCart&&(t+=" active"),t+=' _to-cart"title="',s.inCart?t+=""+this.tr("Remove from Shopping Cart"):t+=""+this.tr("Add to Shopping Cart"),t+='"></button>'),e.isFavoriteBtnEnabled&&(t+='<button class="file-box__action-item button button-circle button-add-to-favorites',s.inFavorites&&(t+=" active"),t+=' _to-favorites"title="',s.inCart?t+=""+this.tr("Remove from Favorites"):t+=""+this.tr("Add to Favorites"),t+='"></button>'),e.isSimilarBtnEnabled&&(t+='<button class="file-box__action-item button button-circle '+e.actionButtonType+' button-see-more-similars _to-similar"title="',"video"===s.type?t+=""+this.tr("Find Similar Videos"):t+=""+this.tr("Find Similar Images"),t+='"></button>'),t+="</span>",s.seeMore&&(t+='<span class="file-box__see-more"><i class="file-box__see-more-icon',"modal"===e.viewMode&&(t+="-hover"),t+=" icon ","video"===s.type?t+="file-box__see-more-icon_videos icon-see-more-videos-large":t+="file-box__see-more-icon_images icon-see-more-images-large",t+='"></i><i class="file-box__see-more-icon',"page"===e.viewMode&&(t+="-hover"),t+=" icon ","video"===s.type?t+="file-box__see-more-icon_videos icon-see-more-videos-large-hover":t+="file-box__see-more-icon_images icon-see-more-images-large-hover",t+='"></i><span class="file-box__see-more-text">',"image"===s.type?t+=""+this.tr("See More Pictures"):t+=""+this.tr("See More"),t+="</span></span>"),t+="</a>",e.filesListFillEnabled&&(t+="</div>"),t+="</div>";return t+='</div><div class="file-view__related-nav file-view__related-nav_compact file-view__related-nav_right _nav-right',e.hasNavigation||(t+=" hidden"),t+='"><i class="file-view__related-nav-icon icon icon-nav-arrow-right-white-big"></i></div>',e.seeMore&&e.seeMore.display&&(t+='<a class="file-view__see-more-link link-blue-on-dark" href="'+e.seeMore.url+'">',"image"===e.seeMore.type?t+=""+this.tr("See More Pictures"):t+=""+this.tr("See More"),t+='<i class="file-view__see-more-icon icon icon-link-blue"></i></a>'),t+="</div>"}},587:function(e,t,i){"use strict";var s=i(0),a=i(22),o=i(48),l=i(128);e.exports=o.extend({url:"FileViewRelated",model:l,initialize:function(e,t){this.store=s.clone(t)},getQueryParams:function(){return s.clone(this.store)},parse:function(e,t){return e.result=a.beautifyApiResponse(e.items||e.result||[]),t.parser="parseFromSearch",o.prototype.parse.call(this,e.result,t)}})},589:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(471),l=i(588),n=i(128),r=i(603),c=i(11),d=i(566),h=i(596),u=i(565);e.exports=o.extend({name:"RelatedContentDefault",el:!1,relatedMode:void 0,viewMode:"modal",events:{"click ._item":"onSeriesBoxClick"},initialize:function(){this.file=new n({id:this.model.get("id")},{app:this.app}),this.listenTo(this.file,"sync",this.render),this.file.fetch({parser:"parseFromFile"}),this.series=new r(a.extend({},a.findWhere(h.series,{name:"curatedCollectionPoster"}),{lang:this.app.lang}),{app:this.app}),this.listenTo(this.series,"sync",this.render),this.series.fetch()},prepareRender:function(){var e=this;this.insertView("._poster-box",new l({app:this.app,template:u,model:this.series,onSeriesBoxClick:function(t){return e.onSeriesBoxClick(t)}}))},serialize:function(){var e=a.clone(this.file.attributes);return e.categories=this.prepareCategories(e.categories),{file:e,relatedMode:this.relatedMode}},clientAfterRender:function(){this.clientAfterRenderCallback()},trackClick:function(e){this.app.observer.broadcast("Track:UE:File:CategoriesClick",(0,s.default)({mode:"modal"},e))},toTracking:function(){return[this.series.serialize()].concat(this.prepareCategories(this.file.get("categories")))},prepareCategories:function(e){var t=this,i=[],s=a.clone(e)||[],o=e?3-e.length:3,l=a.clone(e)||[];return o>0&&(a.each(e||[],function(e){d[e]&&a.each(d[e].similar,function(e){s.push(e)})}),l=a.difference(a.uniq(s),e),l=a.union(e,a.shuffle(l).slice(0,o))),a.each(l||[],function(e){var s=a.findWhere(c.categories,{id:e});s&&i.push(a.extend({},s,{url:t.app.makeUrl({route:"Search",category:e},{absolute:!0})}))}),i},onSeriesBoxClick:function(e){var t=this.$(e.currentTarget);this.trackClick({position:t.index()+1,text:t.text()})},clientAfterRenderCallback:a.noop})},590:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(16),l=i(471),n=i(540),r=i(589),c=i(506),d=i(486),h=i(587),u=i(505),p=i(126),f=i(62),m=i(11),v=i(504),g=i(503),b=i(502),_=i(586),w=i(585);e.exports=l.extend({name:"FileViewBottomModal",el:!1,template:v,viewMode:"modal",related:["models","series","similar"],relatedCounter:0,isCartBtnEnabled:!0,isFavoriteBtnEnabled:!0,categories:!0,initialize:function(){var e=this;a.each(this.related,function(t){e[t]=new h([],{app:e.app,relatedTo:"models"===t?"model":t}),e.listenTo(e[t],"sync",e.checkRelated)}),this.tabs=this.makeFileViewModalTabs()},prepareRender:function(){var e=this,t=this.app.features.isFeatureOnValue("File View Modal Big Related"),i=[new c({scheme:this.tabs,template:g,changeTabCallback:function(){var t=e.tabs.getActiveTab().get("key");e.showActiveTab(),e.changeTabCallback(),e.trackFilesImpression(t)}}),new n({template:_,app:this.app,relatedMode:"model",model:this.model,viewMode:this.viewMode,displaySeeMore:!0,collection:this.models,clientAfterRenderCallback:this.tabsAfterRender.bind(this,"models"),onFileClickCallback:this.onRelatedFileClick.bind(this),isCartBtnEnabled:this.isCartBtnEnabled,isFavoriteBtnEnabled:this.isFavoriteBtnEnabled,filesListFillEnabled:t}),new n({template:_,app:this.app,relatedMode:"series",model:this.model,viewMode:this.viewMode,displaySeeMore:!0,collection:this.series,clientAfterRenderCallback:this.tabsAfterRender.bind(this,"series"),onFileClickCallback:this.onRelatedFileClick.bind(this),isCartBtnEnabled:this.isCartBtnEnabled,isFavoriteBtnEnabled:this.isFavoriteBtnEnabled,filesListFillEnabled:t}),new n({template:_,app:this.app,relatedMode:"similar",model:this.model,viewMode:this.viewMode,displaySeeMore:!0,collection:this.similar,clientAfterRenderCallback:this.tabsAfterRender.bind(this,"similar"),onFileClickCallback:this.onRelatedFileClick.bind(this),isCartBtnEnabled:this.isCartBtnEnabled,isFavoriteBtnEnabled:this.isFavoriteBtnEnabled,filesListFillEnabled:t}),new r({template:w,app:this.app,relatedMode:"categories",model:this.model,viewMode:this.viewMode,clientAfterRenderCallback:this.tabsAfterRender.bind(this,"categories")})];this.app.features.isFeatureOnValue("File View Classic")&&i.push(new d({viewMode:this.viewMode,template:b,app:this.app,model:this.model})),this.resetRelated(),this.setViews({"":i})},serialize:function(){return{opacity:0}},clientAfterRender:function(){this.$("._related").addClass("hidden"),this.toggleLoader(!0),this.setRelatedStore(this.model.get("id")),window.rc=[0,0,0,0]},setRelatedStore:function(e){var t=this;return a.each(this.related,function(i){t[i].store.id=e}),o.$.when(a.map(this.related,function(e){return t[e].fetch()}))},resetRelated:function(){var e=this;a.each(this.related,function(t){return e[t].reset()})},checkRelated:function(){var e=this;if(2==this.relatedCounter++){var t=0;this.toggleLoader(!1),this.el.style.opacity="",this.tabs.findWhere({key:"similar"}).set({active:!1}),a.each(this.related,function(t){e.tabs.findWhere({key:"models"===t?"model":t}).set({enabled:!!e[t].length},{silent:!0})}),this.tabs.where({enabled:!0}).forEach(function(i,s){!e.alreadySetDefaultIndex&&e.model.get("lightfield")&&("model"!==i.get("key")&&"series"!==i.get("key")||(t=s,e.alreadySetDefaultIndex=!0))}),this.tabs.changeActiveTab(t),this.showTab(this.tabs.getActiveTab().get("key")),this.onRelatedReadyCallback(),this.relatedCounter=0}},changeTabCallback:function(){this.app.observer.broadcast("Track:UE:FileViewModal:TabChange",{file:this.model.serialize(),tab:this.tabs.getActiveTab().serialize()}),this.onChangeTabCallback()},showTab:function(e){this.$("._related").addClass("hidden").filter('[data-tab="'+this.tabs.getActiveTab().get("key")+'"]').removeClass("hidden")},showActiveTab:function(){var e=this.tabs.getActiveTab().get("key");this.showTab(e),p.mobileMode()&&f.fire("Modal:CheckSize")},tabsAfterRender:function(e){(this[e]||this[e].length>0)&&this.showActiveTab()},makeFileViewModalTabs:function(){var e=[{key:"similar",enabled:!1,label:a.findWhere(m.relatedTabs,{key:"similar",type:this.model.get("type")}).label},{key:"model",enabled:!1,label:a.findWhere(m.relatedTabs,{key:"model",type:"all"}).label},{key:"series",enabled:!1,label:a.findWhere(m.relatedTabs,{key:"series",type:"all"}).label},{key:"categories",enabled:!0,label:a.findWhere(m.relatedTabs,{key:"categories",type:"all"}).label}];return this.app.features.isFeatureOnValue("File View Classic")&&e.push({key:"info",enabled:!0,label:a.findWhere(m.relatedTabs,{key:"info",type:"all"}).label}),new u(e)},trackFilesImpression:function(e){var t=this.findViews("RelatedFilesList").filter(function(t){return t.relatedMode===e})[0];t&&t.trackImpression()},updateFileInfo:function(e){var t=this.findView("FileInfo");t.model.get("id")!==e.get("id")&&((0,s.default)(t,{model:e}),t.render())},onRelatedFileClick:function(e,t){e.preventDefault(),e.stopPropagation(),t&&(this.app.observer.broadcast("Track:UE:FileViewModal:Open",{file:t.serialize(),route:"FileViewModal",view:this.name}),this.app.features.isFeatureOnValue("File View Classic")&&this.updateFileInfo(t),this.onRelatedClickCallback(t))},toggleLoader:function(){},onChangeTabCallback:function(){},onRelatedClickCallback:function(){},onRelatedReadyCallback:function(){}})},591:function(e,t,i){"use strict";(function(t){var s=i(1)(i(4)),a=i(0),o=i(471),l=i(507),n=i(590),r=i(563),c=i(498),d=i(497),h=i(486),u=i(529),p=i(525),f=i(517),m=i(550),v=i(548),g=i(133),b=i(22),_=i(126),w=i(583),x=i(496),k=i(582),y=i(546),C=i(501),F=i(581);e.exports=l.extend({name:"FileViewModalBuyer",el:!1,template:k,showDownloadButtonInZoomMode:!1,events:(0,s.default)({},l.prototype.events,{"click ._back":"onBackBtnClick"}),initialize:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];l.prototype.initialize.apply(this,t),this.userPlansManager=new g({fileTypes:[this.model.get("type")]},{app:this.app})},prepareRender:function(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];if(l.prototype.prepareRender.apply(this,i),t.browser&&(window.rc=[0,0,0,0],window.sortImagesByLoading=window.sortImagesByLoading||w),this.userPlansManager.set({fileTypes:[this.model.get("type")]}),this.isLicenseWizardOpen()){var a=this.onWindowResize.bind(this);this.setViews({"":new f({app:this.app,files:[this.model],onLicenseSuccessCallback:this.onLicenseSuccess.bind(this),clientAfterRender:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];f.prototype.clientAfterRender.apply(this,t),a()}})})}else this.setViews({"._notice":new r({template:y,model:this.model}),"._file-view-thumb":new c({viewMode:"modal",model:this.model,showDownloadButtonInZoomMode:this.showDownloadButtonInZoomMode,zoomCallback:this.zoomCallback.bind(this),zoomShowCallback:this.zoomShowCallback.bind(this),zoomHideCallback:this.zoomHideCallback.bind(this),zoomNavCallback:this.zoomNavCallback.bind(this),zoomLeftCallback:this.zoomLeftCallback.bind(this),zoomRightCallback:this.zoomRightCallback.bind(this),app:this.app}),"._find-similar":new m({app:this.app,file:this.model,viewMode:"modal"}),"._design":new v({app:this.app,model:this.model,viewMode:"modal"}),"._title":new d({template:C,viewMode:"modal",model:this.model,fileTitleClickCallback:this.onTitleClick.bind(this)}),"._file-view-info":this.getInfoView(),"._download-method-selector":new u({app:this.app,viewMode:"modal",userPlansManager:this.userPlansManager}),"._file-view-bottom":[new n({app:this.app,model:this.model,onRelatedClickCallback:this.setRelated.bind(this),onChangeTabCallback:this.onChangeBottomTab.bind(this),onRelatedReadyCallback:this.onRelatedReady.bind(this),toggleLoader:this.toggleLoader.bind(this)}),new o({el:!1,template:F,name:"RelatedLoader"})]});this.setupPriceTable()},serialize:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var a=l.prototype.serialize.apply(this,t);return(0,s.default)({},a,{isLicenseWizardOpen:this.isLicenseWizardOpen(),isAvailableEnterpriseOnly:this.isAvailableEnterpriseOnly(),similarUrl:this.model.makeRelatedUrl({relatedTo:"similar"}),classNames:b.classNames((0,s.default)({},this.classes,{"file-view-modal_wizard":this.isLicenseWizardOpen(),"file-view-modal_lock":this.isAvailableEnterpriseOnly()})),fileViewClasses:b.classNames({hidden:this.isLicenseWizardOpen(),"file-view_bg-black":!0,"file-view_has-methods":this.hasMethods(),"file-view_classic":this.app.features.isFeatureOnValue("File View Classic")})})},clientAfterRender:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];l.prototype.clientAfterRender.apply(this,t),this.updateFileInfo()},getInfoView:function(){return this.app.features.isFeatureOnValue("File View Classic")?[]:new h({model:this.model,app:this.app,viewMode:"modal"})},setupPriceTable:function(){this.setView("._price-table",new p({file:this.model,userPlansManager:this.userPlansManager,viewMode:"modal",app:this.app,onLicenseBtnClick:this.openLicenseWizard.bind(this),sizeChangedCallback:this.sizeChangedCallback.bind(this)}))},hide:function(e){return this.isLicenseWizardOpened=!1,l.prototype.hide.call(this,e)},setRelated:function(e){var t=this,i=this.findView("ProductsTooltip");this.$("._file-view-container").toggleClass("file-view-video-huge",e.get("hasHugeVideoThumb")),a.each(a.omit(this.views,"._file-view-bottom"),function(i){i.model&&i.model.get("id")===e.get("id")||("PriceTable"===i.name?(0,s.default)(i,{file:e}):(0,s.default)(i,{model:e}),i.render().promise().then(function(){t.setModalHeight(),_.mobileMode()&&t.app.observer.fire("Modal:CheckSize"),t.isFullScreenMode()&&window.scrollTo(0,0)}))}),x.write({itemId:e.get("id")},{app:this.app}),this.model=e,i&&i.detach(),this.app.observer.broadcast("Track:UE:FileViewModal:RelatedClick",{file:this.model,view:this.name})},updateFileInfo:function(){this.getView("FileViewBottomModal")&&this.getView("FileViewBottomModal").updateFileInfo(this.model)},openLicenseWizard:function(){return this.isLicenseWizardOpened=!0,this.render()},closeLicenseWizard:function(){return this.isLicenseWizardOpened=!1,this.render()},onLicenseSuccess:function(e,t,i,s){var a=e[0]&&e[0].transaction;if(a){var o=(this.model.get("licensed")||[]).slice();o.push(a),this.model.set({licensed:o})}this.closeLicenseWizard(),this.onLicenseSuccessCallback.call(this,e,t,i,s)},sizeChangedCallback:function(){this.setModalHeight()},isLicenseWizardOpen:function(){return!!this.isLicenseWizardOpened},hasMethods:function(){return!a.isEmpty(this.userPlansManager.get("available"))},isAvailableEnterpriseOnly:function(){return!this.app.user.isEnterprise()&&this.model.isAvailableEnterpriseOnly()},getContainerHeight:function(e){var t=e;return this.isLicenseWizardOpen()&&(t="._wizard"),this.$(a.isUndefined(t)?"._file-view-container":t).outerHeight()+this.$("._notice").outerHeight()},zoomCallback:function(e){this.canHideModal=!1,this.findView("ZoomModal").hide(),this.app.user.isLoggedIn()?this.findView("FileViewThumb").showDownloadButtonInZoomMode=!1:this.findView("PriceTable").onDownloadClick(e)},toggleLoader:function(e){this.findView("RelatedLoader").$el.toggleClass("hidden",!e)},trackModalShow:function(){this.app.observer.broadcast("Track:UE:FileViewModal:Show",{id:this.model.get("id"),file:this.model.toJSON(),query:this.app.store.get("SearchQuery").get("query")+"-"+this.model.get("id"),sorting:this.app.store.get("SearchQuery").get("sorting"),activeTableRow:this.findView("PriceTable")&&this.findView("PriceTable").getActiveTableRowData(),subtype:"total",view:this.name}),this.app.observer.broadcast("Track:UE:FileViewModal:DownloadShow")},onChangeBottomTab:function(){this.onChangeRelatedTabCallback()},onBackBtnClick:function(){this.closeLicenseWizard()},onTitleClick:function(e){var t=this.trackingInfo||{};this.app.observer.broadcast("Track:UE:File:OpenFileView",{fileId:e,view:t.callingView,sorting:t.sorting})},onRelatedReady:function(){this.zoomModalEnabled||this.app.observer.broadcast("Track:UE:FileViewModal:Ready",{file:this.model,view:this.name}),this.onRelatedReadyCallback()},onRelatedReadyCallback:function(){},onLicenseSuccessCallback:function(){},onChangeRelatedTabCallback:function(){}})}).call(this,i(5))},592:function(e,t,i){"use strict";(function(e){var t=i(0),s=i(16),a=i(128),o=i(591),l=i(580),n=i(496),r=i(485),c=i(6)(e);e.exports={asyncFileViewModalLoad:!0,enableListThroughNavigation:!0,enableKeyboardNavigation:!0,storeFileViewModalAsLastViewed:!1,shouldEnableAdminModal:!1,canHideModal:!1,zoomModalEnabled:!1,showDownloadButtonInZoomMode:!1,onKeyUpModal:function(e){this.enableListThroughNavigation&&this.isOwnModalOpened()&&(e.keyCode===r.left?this.navigatePrev():e.keyCode===r.right&&this.navigateNext())},navigatePrev:function(){var e=this.getPrevItem();this.currFile.id===e.id?(this.app.observer.broadcast("Track:UE:FileViewModal:Edge",{direction:"prev"}),this.leftEdgeCallback()):(this.app.observer.broadcast("Track:UE:FileViewModal:Navigate",{direction:"prev",file:e.toJSON(),sourceFile:this.currFile}),this.showFileViewModal(e.id))},navigateNext:function(){var e=this.getNextItem();e&&(this.currFile.id===e.id?(this.app.observer.broadcast("Track:UE:FileViewModal:Edge",{direction:"next"}),this.rightEdgeCallback()):(this.app.observer.broadcast("Track:UE:FileViewModal:Navigate",{direction:"next",file:e.toJSON(),sourceFile:this.currFile}),this.showFileViewModal(e.id)))},getPrevItem:function(){var e=this.getFileIndex();return this.collection.at(Math.max(e-1,0))},getNextItem:function(){var e=this.getFileIndex();return this.collection.at(Math.min(e+1,this.collection.length-1))},isAnyModalOpened:function(){return this.app.store.get("FileViewModal")&&this.app.store.get("FileViewModal").isOpen()},isOwnModalOpened:function(){return this.isAnyModalOpened()&&this.app.store.get("FileViewModal").openerCID===this.cid},getFileIndex:function(e){return void 0===e&&(e=this.currFile),this.collection.indexOf(this.collection.get(e.id))},fetchFile:function(e,i,s){var o=this;return this.currFile=new a({id:e},{app:this.app,validate:!0}),this.currFile.fetch({parser:"parseFromFile"}).then(function(){t.isFunction(s)&&s.call(o,o.currFile,i)})},isNeedToMakeNewModal:function(){return!this.app.store.get("FileViewModal")||this.app.store.get("FileViewModal").openerCID!==this.cid},initFileViewModal:function(e){var i,s=this;i=t.result(this,"shouldEnableAdminModal")?new l({app:this.app,model:e,canHideModal:this.canHideModal,zoomModalEnabled:this.zoomModalEnabled,tuneScroll:this.tuneScroll.bind(this),onLeftNavigation:this.navigatePrev.bind(this),onRightNavigation:this.navigateNext.bind(this),onHideCallback:function(){s.currFile=null,s.app.store.unlink("FileViewModal"),s.app.observer.fire("ToTopButton:Toggle",{state:!0})}}):new o({model:e,app:this.app,tuneScroll:this.tuneScroll.bind(this),canHideModal:this.canHideModal,zoomModalEnabled:this.zoomModalEnabled,overlayConfig:this.getOverlayConfig(),trackingInfo:this.getTrackingInfo?this.getTrackingInfo():null,showDownloadButtonInZoomMode:this.showDownloadButtonInZoomMode,onLeftNavigation:this.navigatePrev.bind(this),onRightNavigation:this.navigateNext.bind(this),onLicenseSuccessCallback:this.onFileViewLicenseSuccessCallback.bind(this),onHideCallback:function(){s.currFile=null,s.app.store.unlink("FileViewModal"),s.app.observer.fire("ToTopButton:Toggle",{state:!0})},onRelatedReadyCallback:function(){return s.trigger("relatedReady")}}),this.app.store.link("FileViewModal",i),this.app.store.get("FileViewModal").openerCID=this.cid},toggleViewModalNavigation:function(e){var t=this.pagerModel?this.pagerModel.get("page"):1,i=this.pagerModel?this.pagerModel.get("pagesCount"):1,s=this.getFileIndex(e);this.app.store.get("FileViewModal").toggleNavigation("left",!(1===t&&0===s)),this.app.store.get("FileViewModal").toggleNavigation("right",!(t===i&&!this.collection.at(s+1)))},forceDisableNavigation:function(){this.app.store.get("FileViewModal").toggleNavigation("left",!1),this.app.store.get("FileViewModal").toggleNavigation("right",!1)},showFileViewModal:function(e,t){void 0===t&&(t={}),this.asyncFileViewModalLoad?(!this.fetchXhr||this.fetchXhr&&"pending"!==this.fetchXhr.state())&&(this.fetchXhr=this.fetchFile(e,t,this.showModal)):this.showModal(this.collection.get(e),t)},showModal:function(e,t){e&&e.id?(this.currFile=e,this.isNeedToMakeNewModal()&&this.initFileViewModal(e),this.enableListThroughNavigation?this.toggleViewModalNavigation(e):this.forceDisableNavigation(),this.app.observer.fire("ToTopButton:Toggle",{state:!1}),this.storeFileViewModalAsLastViewed&&n.write({itemId:e.id},{app:this.app}),this.trackModalShow(e.serialize(),t),this.app.store.get("FileViewModal").show({model:e,needToUpdateHistoryState:this.needToUpdateHistoryState,replaceState:t.replaceState})):c.warn("Fail to get File data by id")},trackModalShow:function(e,t){this.app.observer.broadcast("Track:UE:FileViewModal:Open",{file:e,ecommerce:t.ecommerce,view:this.name})},hideFileViewModal:function(e){var t=this.app.store.get("FileViewModal");t&&(t.hide(e),this.app.store.unlink("FileViewModal"))},tuneScroll:function(e){var t=this.$('[data-id="'+e+'"]');if(t.length){var i=s.$(window),a=i.height(),o=i.scrollTop(),l=o+a,n=t.offset().top,r=n+t.height();if(r>l||n<o)n-100+s.$("body > footer").outerHeight(!0)+a>s.$(document).height()&&(n=r-a+200),s.$("body").add(s.$("html")).stop(!1,!0).animate({scrollTop:n-100},600)}},getOverlayConfig:function(){var e={};return this.zoomModalEnabled&&(e.className="hidden"),e},leftEdgeCallback:t.noop,rightEdgeCallback:t.noop,onFileViewLicenseSuccessCallback:t.noop}}).call(this,i(3)(e))},612:function(e,t,i){"use strict";var s=i(471),a=i(474),o=i(732);e.exports=s.extend({name:"FolderPermissions",el:!1,template:o,disableRemove:!1,isMultipleSharing:!1,events:{"click ._access":"onAccessClick","click ._remove":"onRemoveClick"},initialize:function(){if(!this.model)throw new Error(this.name+" "+this.cid+": Permission model required!");if(!this.folder)throw new Error(this.name+" "+this.cid+": Folder model required!")},serialize:function(){return{permList:this.isMultipleSharing?this.getListForMultipleSharing():this.getList()}},getListForMultipleSharing:function(){var e=this.model.get("permission");return[{type:"access",name:"view",title:this.tr("Can View"),active:"view"===e},{type:"access",name:"edit",title:this.tr("Can Edit"),active:"edit"===e}]},getList:function(){var e=this.model.get("type"),t=this.model.get("permission"),i=this.folder.get("permission"),s=this.app.user.get("id")===this.folder.get("userId"),a="user"===this.model.get("type")&&this.model.get("user").get("userId")===this.app.user.get("id"),o=!this.disableRemove&&"link"!==e&&(s||"edit"===i||a),l=[];return("edit"===i||s)&&(l.push({type:"access",name:"view",title:this.tr("Can View"),active:"view"===t}),l.push({type:"access",name:"edit",title:this.tr("Can Edit"),active:"edit"===t})),o&&l.push({type:"remove",name:"remove",title:a?this.tr("Leave Collection"):this.tr("Remove")}),l},onAccessClick:function(e){e.stopPropagation();var t=e.currentTarget.dataset.name;this.isUserTryToDecreaseOwnAccess(t)?this.showConfirmationDialog(t):this.changeCallback(t)},onRemoveClick:function(e){e.stopPropagation(),this.removeCallback()},isUserTryToDecreaseOwnAccess:function(e){return!this.isMultipleSharing&&("user"===this.model.get("type")&&parseInt(this.model.get("user").get("userId"),10)===parseInt(this.app.user.get("id"),10)&&"edit"===this.model.get("permission")&&"view"===e)},showConfirmationDialog:function(e){var t=this;new a({title:this.tr("Are you sure?"),message:this.tr("By changing sharing settings, you will no longer be able to edit this folder."),footer:[{label:this.tr("Yes"),hide:!0,color:"blue",defaultAction:!0,callback:function(){return t.changeCallback(e)}},{label:this.tr("No"),hide:!0}],destroyOnHide:!0,app:this.app}).show()},changeCallback:function(){},removeCallback:function(){}})},662:function(e,t,i){"use strict";var s=i(0),a=i(48),o=i(730);e.exports=a.extend({url:"FolderPermissions",model:o,initialize:function(){var e=this;this.cid=s.uniqueId("col"),this.on("change",function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:e.cid,folderId:t.get("folderId")})}),this.on("update",function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:e.cid,folderId:t.length?t.first().get("folderId"):0})})},parse:function(e){return e?e.result:[]},findPermissionByEmail:function(e){return this.find(function(t){return t.isMatchByEmail(e)})}})},663:function(e,t,i){"use strict";var s=i(471),a=i(473),o=i(472),l=i(733);e.exports=s.extend({name:"FolderUsers",el:!1,template:l,maxAvatars:5,events:{"mouseenter ._avatar-box":"onAvatarBoxMouseEnter","mouseleave ._avatar-box":"onAvatarBoxMouseLeave"},initialize:function(){this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function(){return this.users=this.collection.serialize().filter(function(e){return"link"!==e.type}).reverse(),!!this.users.length},serialize:function(){var e=this.users.slice(0,this.maxAvatars);return{users:this.prepareUsers(e),moreCount:this.users.length-e.length,ownerId:this.model.get("userId")}},prepareUsers:function(e){var t=this;return e.map(function(e){return t.model.get("userId")===e.userId?e.title=t.tr("%s is the owner",e.fullName):"edit"===e.permission?e.title=t.tr("%s can edit",e.fullName):e.title=t.tr("%s can view",e.fullName),e})},onAvatarBoxMouseEnter:function(e){e.preventDefault(),this.setNotExistView("avatarTooltip",a,{params:o.darkTitle,classes:{tooltip_dark:!0},content:new s({el:!1,template:function(){return e.currentTarget.getAttribute("data-title")}})}),this.getView("avatarTooltip").show(e)},onAvatarBoxMouseLeave:function(e){e.preventDefault(),this.getView("avatarTooltip").remove()}})},664:function(e,t,i){"use strict";e.exports.default={suppressScrollX:!0,wheelSpeed:.6,minScrollbarLength:30}},686:function(e,t,i){"use strict";(function(e,t){var s=i(0),a=i(16),o=i(22),l=i(130),n=i(126),r=i(6)(e);e.exports={arrangeFiles:function(e){var t=this,i=e||this.app.store.get("SearchSettings").get("layout");r.time&&r.time("Arrange "+i),this.setHolderWidth();var o=this.getItemsData(),l="wide"===i?"_file-box-link":"_file-box-image";s.each(this.el.getElementsByClassName("file-box"),function(e){var i=e.getAttribute("data-id");o[i]&&("next"===i?e.getElementsByClassName("_next-link")[0].setAttribute("style",o[i].holderStyle):i&&(e.setAttribute("style",o[i].boxStyle),e.getElementsByClassName("_file-box-link")[0].setAttribute("style",o[i].linkStyle),e.getElementsByClassName(l)[0].setAttribute("style",o[i].holderStyle),e.getElementsByClassName("_file-box-image-src")[0].setAttribute("style",o[i].imageStyle),t.detectLastRow&&(o[i].isLastRow&&o[i].row>t.detectLastRow?e.classList.add("file-box_last-row"):e.classList.remove("file-box_last-row"))))}),a.$(".search-box").css("visibility","visible"),r.timeEnd&&r.timeEnd("Arrange "+i)},getAdjustItemsData:function(e){var t="video"===this.app.store.get("SearchQuery").defineSearchType(),i="big"===this.app.store.get("SearchSettings").get("layout")?172:112,a=o.getArrangeFilesSizes(i,this.holderWidth,3,!0),l={},n={},r=0,c={};return s.each(e,function(e,o){c[e.id]={width:e.w,height:e.h,boxStyle:{marginRight:"0"},linkStyle:{},holderStyle:{width:"auto",height:"auto"}},void 0===l[r]&&(l[r]=[]),l[r].push(e.id),t&&(void 0===n[r]&&(n[r]=0),n[r]=Math.max(n[r],"next"===e.id?0:Math.floor(i/e.w*e.h))),o&&(o+1)%a.perSet==0?r++:(c[e.id].boxStyle.marginRight=a.margin,s.extend(c[e.id].boxStyle,{marginRight:a.margin}))}),t&&s.each(l,function(e,t){!isNaN(n[t])&&n[t]>0&&s.each(e,function(e){s.extend(c[e].linkStyle,{height:n[t]})})}),c},getStaticItemsData:function(e,t,i){var a=this;void 0===i&&(i=!1);var o,l={},n=this.staticMargin||20,r=[],c=t,d=0,h=0,u=0,p=0,f=!1,m=n,v=m;return s.each(e,function(e){o=Math.ceil(e.w*t/e.h),r[e.id]={width:o},!f&&h+o<=a.holderWidth?(d++,h+=o+n,u+=o,p=a.holderWidth-u):(f=!0,a.hasNavigation=!0)}),i&&f&&(m=Math.floor(p/(d-1)),v=p-m*(d-1)+m),s.each(e,function(i,s){var o=s===e.length-1?0:m;l[i.id]={width:r[i.id].width,height:t,isNarrow:r[i.id].width<=92,boxStyle:{marginRight:0===s?v:o,width:r[i.id].width,height:t}},!a.incompleteLastRow&&r[i.id].width<c&&(l[i.id].boxStyle.width=c,l[i.id].imageStyle={width:r[i.id].width})}),this.totalItemsWidth=0,this.incompleteLastRow&&(c=0),s.each(l,function(e){a.totalItemsWidth+=Math.max(e.boxStyle.width,c)+e.boxStyle.marginRight}),this.totalItemsWidth>this.holderWidth&&(this.hasNavigation=!0),l},getWideItemsData:function(e,t){var i={},s=[],a=[],o=t||200;return this.prepareWideRows({rowsData:s,rowsHeight:a,itemBorder:2,itemMargin:10,rowHeight:o,itemsDimensions:e}),this.resizeWideItems({rowsData:s,itemsData:i,rowsHeight:a,itemBorder:2,itemMargin:10,itemsDimensions:e}),this.prepareLastWideRow({rowsData:s,itemsData:i,itemBorder:2,itemMargin:10,rowHeight:o}),this.setZoomInOutContainerClearance(),i},prepareWideRows:function(e){var i,a,o,l=this,r=[],c=e.itemMargin;s.each(e.itemsDimensions,function(s){i=Math.ceil(s.w*e.rowHeight/s.h),a=i+e.itemBorder+e.itemMargin,c+a<=l.holderWidth||0===r.length?c+=o=a:t.browser&&!n.isMobileModeWideSearch()&&i>=l.holderWidth/2&&c<=.75*l.holderWidth&&l.maxRows&&r.length<l.maxRows?(c+=o=a,i=l.holderWidth-(c-i),c=l.holderWidth):(e.rowsData.push(r),e.rowsHeight.push(Math.ceil(e.rowHeight*l.holderWidth/(c-o))),c=e.itemMargin+e.itemBorder+a,r=[]),r.push({id:s.id,width:i,height:e.rowHeight,thumb:s.thumb,ratio:s.w/s.h})}),this.lastRowStretched=!1,0!==r.length&&(e.rowsData.push(r),this.stretchLastRow&&c/this.holderWidth>=.65&&(this.lastRowStretched=!0,e.rowsHeight.push(Math.ceil(e.rowHeight*this.holderWidth/(c-o)))))},resizeWideItems:function(e){var t=this,i=0,a=0;s.each(e.rowsData,function(o,l){s.each(o,function(t){i=Math.floor(t.width*e.rowsHeight[l]/t.height),e.itemsData[t.id]={width:i,height:e.rowsHeight[l],thumb:t.thumb,row:l,holderStyle:{width:i,height:e.rowsHeight[l]}},a+=i+e.itemBorder+e.itemMargin}),e.itemsData[o[o.length-1].id].boxStyle={marginRight:0},t.setExtraWideItemsSizes(s.extend({rowData:o,newRowWidth:a-e.itemMargin},e)),a=0})},setExtraWideItemsSizes:function(e){var t=this.holderWidth-e.newRowWidth,i={},a=0,o=0,l=0;s.each(e.rowData,function(s,a){i=e.itemsData[s.id],o=a===e.rowData.length-1?Math.floor(t-l):Math.floor(t/(e.newRowWidth/i.width)),l+=o,i.width+=o,i.holderStyle.width=i.width,i.boxStyle=i.boxStyle||{},i.boxStyle.width=i.width+e.itemBorder,i.lowQuality=i.width>i.thumb.w}),s.each(e.rowData,function(t){t.height=e.itemsData[t.id].width/t.ratio-1,a=a?Math.min(a,t.height):t.height}),s.each(e.rowData,function(t){(i=e.itemsData[t.id]).height=Math.round(Math.min(a,350)),i.boxStyle.height=Math.round(i.height),i.holderStyle.height=Math.round(i.height),i.imageStyle={top:-Math.floor((t.height-i.height)/2)}})},prepareLastWideRow:function(e){if(this.lastRowStretched)return!1;var t=e.rowsData[e.rowsData.length-1],i=0;if(s.each(t,function(t){e.itemsData[t.id]={width:t.width,height:e.rowHeight,row:e.rowsData.length-1,isLastRow:!0,holderStyle:{width:t.width,height:e.rowHeight}},i+=t.width+e.itemBorder+e.itemMargin}),e.itemsData.next&&i>this.holderWidth){var a=e.itemsData.next.width-(i-this.holderWidth);a>=130?(e.itemsData.next.width=a,e.itemsData.next.holderStyle.width=a):this.setExtraWideItemsSizes(s.extend({rowData:t,newRowWidth:i},e))}return e.rowsData.length<=this.maxRows&&(this.incompleteLastRow=!0),!0},setZoomInOutContainerClearance:function(){t.browser&&this.$el.width(this.holderWidth+10)},setHolderWidth:function(e){void 0===e&&(e=0),t.browser&&this.$el.css({width:"auto"}),this.holderWidth=this.el.offsetWidth||e},getWideVideoItemsData:function(e){var i=380,a=214,o=10,l=1;t.browser&&!n.canArrangeFilesList()||(l=Math.floor((this.holderWidth+10)/392))<e.length&&(412*l<this.holderWidth+30&&(l+=1,i=Math.floor((this.holderWidth-10*(l-1))/l)-2,a=Math.round(i/380*214)),o=Math.floor((this.holderWidth-l*(i+2))/(l-1))),this.maxRows&&e.length<this.maxRows*l&&(this.incompleteLastRow=!0);var r={};return s.each(e,function(e,t){r[e.id]={width:e.w,height:e.h,row:Math.floor(t/l),boxStyle:{marginRight:(t+1)%l?o:0,height:a,width:i},linkStyle:{height:a,width:i},holderStyle:{height:a,width:i,paddingLeft:0,paddingRight:0}}}),r},getItemsDimensions:function(e){var t,i,a=[],o=e||this.app.store.get("SearchSettings").get("layout");return this.collection.each(function(e){t=l.getThumbSizes(e.serialize(),o),i=l.calculateSize({width:e.get("width"),height:e.get("height")},l.config[e.get("type")][o]),a.push(s.extend({id:e.get("id")},{thumb:i},t))}),this.pagerModel&&this.pagerModel.isNextPageAvailable(this.app.store.get("SearchQuery"))&&a.push({id:"next",w:t.h,h:t.h,thumb:{}}),a},convertStyleToString:function(e){var t="";return s.each(e,function(e,i){t=""+t+i.replace(/[A-Z]/g,"-$&").toLowerCase()+": "+e+("auto"!==e?"px":"")+";"}),t}}}).call(this,i(3)(e),i(5))},694:function(e,t,i){"use strict";var s=i(1),a=s(i(4)),o=s(i(23)),l=i(0),n=i(99),r=i(796),c=i(11).defaultFolders,d=i(61);e.exports=n.extend({defaults:{id:null,title:"",description:"",count:0,isPublic:!0,isShared:!1,permission:"view",userId:null,userName:"",ownerAvatar:"",ownerApprovedFilesCount:0,previewSources:[],coverCropData:{},preferences:[]},relations:{preferences:r},validation:{count:{pattern:"digits"},isPublic:{boolean:!0}},url:"Folder",lastSyncedAttrs:{},initialize:function(){var e=this;this.on("sync",this.makeKostylCleanUpCoverCropData),this.on("change",function(t,i){void 0===i&&(i={}),i.observable&&e.app.observer.fire("Favorites:FolderChanged",{id:t.get("id"),cid:t.cid,changed:t.changed,options:i})})},makeKostylCleanUpCoverCropData:function(e){e.get("preferences").get("coverItemId")&&(e.attributes.coverCropData={})},parse:function(e){void 0===e&&(e={});var t=e.lightbox?e.lightbox:e,i=l.pick(t,(0,o.default)(this.defaults));return i.id=parseInt(t.lightboxId,10),i.userId=parseInt(t.userId,10),i.count=parseInt(t.count,10),i.previewSources=t.items||[],i.isPublic=t.public,i},serialize:function(){var e=this.getFolderTitle(this.attributes.title),t=this.get("title")?this.app.makeUrl({route:"Folder",folderId:this.get("id"),folderName:this.get("title")}):"",i=d(this.get("description"));return(0,a.default)({},this.attributes,{title:e,link:t,description:i})},toJSON:function(){return this.serialize()},getFolderTitle:function(e){return c.some(function(t){return t.label===e})?this.app.tr(e):e},getQueryParams:function(){return(0,a.default)({},this.attributes)}})},695:function(e,t,i){"use strict";var s=i(476),a=i(471),o=i(663),l=i(612),n=i(473),r=i(472),c=i(664).default,d=i(731);e.exports=a.extend({name:"SharedUsers",el:!1,template:d,listOnly:!1,includeLink:!1,opened:!1,scrollPosition:0,events:{"click ._open-list":"onOpenListClick","click ._close-list":"onCloseListClick","click ._select-perm":"onSelectPermClick"},initialize:function(){if(!this.model)throw new Error(this.name+": Folder model required!");if(!this.collection)throw new Error(this.name+": FolderPermissions collection required!");this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function(){this.setView("._users",new o({app:this.app,model:this.model,collection:this.collection}))},serialize:function(){return{opened:this.opened,listOnly:this.listOnly,includeLink:this.includeLink,linkPermission:this.getLinkPermission(),usersList:this.getUsersList(),ownerId:this.model.get("userId")}},clientAfterRender:function(){var e=this;this.opened&&setTimeout(function(){return e.initPerfectScrollbar()},0)},initPerfectScrollbar:function(){var e=this.$("._scroll");s.initialize(e.get(0),c),e.scrollTop(this.scrollPosition)},getLinkPermission:function(){var e=this.collection.find(function(e){return"link"===e.get("type")});return e?e.serialize():{}},getUsersList:function(){return this.opened?this.collection.serialize().filter(function(e){return"link"!==e.type}).reverse():[]},onOpenListClick:function(e){e.preventDefault(),this.opened=!0,this.render()},onCloseListClick:function(e){e.preventDefault(),this.opened=!1,this.render()},onSelectPermClick:function(e){e.stopPropagation();var t=e.currentTarget.dataset.email,i=this.collection.findPermissionByEmail(t),s=this.getView("FolderPermissions");if(this.selectedModel&&this.selectedModel.cid===i.cid)s&&s.toggle(e);else{var a=this.app.user.get("id")===this.model.get("userId"),o="user"===i.get("type")&&i.get("user").get("userId")===this.app.user.get("id");"view"!==this.model.get("permission")||a||o?(this.selectedModel=i,this.setView("FolderPermissions",new n({params:r.FolderPermissions,content:new l({app:this.app,model:i,folder:this.model,changeCallback:this.selectPermissionCallback.bind(this),removeCallback:this.removePermissionCallback.bind(this)})})),this.getView("FolderPermissions").show(e)):s&&s.isOpen()&&s.hide()}},saveScrollPosition:function(){this.scrollPosition=this.$("._scroll").scrollTop()},selectPermissionCallback:function(e){this.getView("FolderPermissions").hide(),this.saveScrollPosition(),this.selectedModel.updatePermission({permission:e})},removePermissionCallback:function(){this.getView("FolderPermissions").hide(),this.saveScrollPosition(),this.selectedModel.deletePermission()}})},721:function(e,t){e.exports=function(e){var t='<ul class="share-tabs share-tabs_count-'+e.scheme.length+'">',i=e.scheme;if(i)for(var s,a=-1,o=i.length-1;a<o;)(s=i[a+=1]).disabled||(t+='<li class="share-tabs__item',(s.active||s.pseudoActive)&&(t+=" share-tabs__item_active _tab-active"),t+=' _tab" data-key="'+s.key+'"><span class="share-tabs__link">'+s.label+"</span></li>");return t+='<li class="share-tabs__menu-underline hidden _menu-underline"></li></ul>'}},722:function(e,t){e.exports=function(e){var t='<div class="share-modal">';if(!e.isCompact){t+='<div class="share-modal__left"><div class="share-modal__info-box"><span class="share-modal__info-text share-modal__info-text_title">'+e.info.title+'</span><span class="share-modal__info-text share-modal__info-text_count">'+this.tr("%s Files",[e.info.count])+'</span></div><div class="share-modal__poster-wrap share-modal__poster-wrap_rows'+e.posterMap.length+' _poster">';var i=e.posterMap;if(i)for(var s,a=-1,o=i.length-1;a<o;){t+='<div class="share-modal__poster-row share-modal__poster-row_count'+(s=i[a+=1]).images.length+'">';var l=s.images;if(l)for(var n,r=-1,c=l.length-1;r<c;)t+='<div class="share-modal__poster-cell"style="width: '+(n=l[r+=1]).width+"%;",n.url&&(t+=" background-image: url("+n.url+");"),t+='"></div>';t+="</div>"}t+="</div></div>"}return t+='<div class="share-modal__right"><h2 class="share-modal__title">'+this.tr("Share Collection")+'</h2><div class="share-modal__tabs _tabs"></div><div class="share-modal__wrap">',e.emailSharingAllowed&&(t+='<div class="share-modal__form',"email"===e.activeTab&&(t+=" active"),t+=' _form _wrap" data-tab="email"></div>'),e.linkSharingAllowed&&(t+='<div class="share-modal__link',e.emailSharingAllowed&&"link"!==e.activeTab||(t+=" active"),t+=' _link _wrap" data-tab="link"></div>'),e.isCompact||(t+='<div class="share-modal__social',e.emailSharingAllowed&&"social"!==e.activeTab||(t+=" active"),t+=' _wrap" data-tab="social"><a class="share-modal__social-btn button-share-circle button-share-facebook _share-button"rel="nofollow" data-width="650" data-height="370" data-title="Facebook" data-social="facebook"><span class="button-share-circle-text">Facebook</span></a><a class="share-modal__social-btn button-share-circle button-share-twitter _share-button" rel="nofollow" data-width="730" data-height="420" data-title="Tweet" data-social="twitter"><span class="button-share-circle-text">Twitter</span></a><a class="share-modal__social-btn button-share-circle button-share-google _share-button"rel="nofollow" data-width="700" data-height="450" data-title="Google" data-social="google"><span class="button-share-circle-text">Google Plus</span></a></div>'),t+="</div></div></div>"}},723:function(e,t){e.exports=function(e){return'<form class="share-link"><span class="share-link__title">'+this.tr("Collaborate by sharing link")+this.tr(":")+'</span><div class="share-link__field field-box input-box input-box-xxxl input-box-params"><div class="input-params-wrap"><input class="input input-xxxl _link-field" type="text" name="link" value="'+e.sharedLink+'" autocomplete="off" readonly /><div class="input-params-select"><span class="input-action-wrap _link-copy"><span class="input-action">'+this.tr("Copy link")+'</span></span></div></div></div><div class="share-link__perm"><div class="share-link__perm-title">'+this.tr("Users with the link")+this.tr(":")+'</div><div class="cmp-option-select share-link__perm-select"><div class="cmp-option-select-wrap _add-perm"><span class="cmp-option-select-value">'+e.permissionLabel+'</span><i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div><button class="share-link__done button button-xxl button-watery button-blue _done">'+this.tr("Done")+"</button></form>"}},724:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(512),o=i(612),l=i(473),n=i(472),r=i(723);e.exports=a.extend({name:"ShareLinkForm",el:!1,template:r,events:(0,s.default)({},a.prototype.events,{"click ._done":"onDoneClick","click ._add-perm":"onAddPermClick","click ._link-field":"onLinkFieldClick","click ._link-copy":"onLinkCopyClick"}),initialize:function(){var e=this;this.listenTo(this.permissions,{"change:permission":function(t){"link"===t.get("type")&&e.render()},update:this.render,reset:this.render})},prepareRender:function(){return this.model=this.permissions.findWhere({type:"link"}),void 0!==this.model},serialize:function(){return{sharedLink:this.getSharedLink(),permissionLabel:this.getPermissionLabel()}},clientAfterRender:function(){this.model&&this.setView("AddFolderPermissions",new l({params:n.FolderPermissions,content:new o({app:this.app,model:this.model,folder:this.folder,changeCallback:this.selectPermissionCallback.bind(this)})}))},getPermissionLabel:function(){return"edit"===this.model.get("permission")?this.tr("Can Edit"):this.tr("Can View")},onDoneClick:function(){this.hideCallback()},onAddPermClick:function(e){e.preventDefault(),this.getView("AddFolderPermissions").toggle(e)},onLinkFieldClick:function(e){e.currentTarget.select()},onLinkCopyClick:function(){var e=this.$("._link-field").get(0);e.select();try{document.execCommand("copy")&&this.app.observer.fire("Notification",{type:"success",description:this.tr("Link copied to the clipboard.")})}catch(e){}e.selectionStart=e.selectionEnd=-1},getSharedLink:function(){return this.model.get("link")||this.app.makeUrl({route:"Folder",folderId:this.folder.get("id"),folderName:this.folder.get("title")},{absolute:!0})},selectPermissionCallback:function(e){this.model.updatePermission({permission:e}),this.getView("AddFolderPermissions").hide()},hideCallback:function(){}})},725:function(e,t){e.exports=function(e){var t='<form class="share-email"><span class="share-email__title">'+this.tr("Invite people to collaborate via Email")+this.tr(":")+'</span><div class="share-email__field field-box input-box input-box-xxxl input-box-params';return e.canSetPermission||(t+=" share-email__field_no-perms"),t+=' _errorHolder"><div class="input-params-wrap"><span class="input-params-title">'+this.tr("To:")+'</span><input class="input input-xxxl _share-email _field" type="email" name="email" value="'+e.formData.email+'"placeholder="'+this.tr("Email")+'" autocomplete="off" maxlength="100" /><div class="cmp-option-select input-params-select"><div class="cmp-option-select-wrap _add-perm"><span class="cmp-option-select-value">'+e.permissionLabel+'</span><i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div></div><div class="share-email__shared _shared"></div><button class="share-email__submit button button-xxl button-watery button-blue _submit" type="submit">'+this.tr("Share Collection")+"</button></form>"}},726:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(9),l=i(11).validationMessages;e.exports=o.extend({url:"ShareFolder",defaults:{folderID:null,email:"",subject:"",type:"email",permission:"view"},validation:{email:[{required:!0,msg:!0},{minLength:3,msg:a.findWhere(l,{key:"emailMin"}).label},{maxLength:100,msg:a.findWhere(l,{key:"emailMax"}).label},{pattern:"email",msg:a.findWhere(l,{key:"email"}).label}],permission:{oneOf:["view","edit"]},type:{oneOf:["user","email"]}},parse:function(e){return a.pick(e,a.keys(this.defaults))},getQueryParams:function(){return(0,s.default)({},this.attributes,{type:"user"})}})},727:function(e,t,i){"use strict";var s=i(1),a=s(i(23)),o=s(i(4)),l=i(512),n=i(695),r=i(612),c=i(473),d=i(726),h=i(472),u=i(725);e.exports=l.extend({name:"ShareFolderForm",el:!1,template:u,isMultipleSharing:!1,events:(0,o.default)({},l.prototype.events,{"focusout ._field":"onFieldFocusOut","click ._add-perm":"onAddPermClick"}),initialize:function(){this.model=new d({foldersID:this.getSharingIds()},{app:this.app}),this.listenTo(this.model,{invalid:this.showErrors,sync:this.onSubmitForm,"change:permission":this.render})},prepareRender:function(){!this.isMultipleSharing&&this.canSetPermission()&&this.setView("._shared",new n({app:this.app,model:this.folder,collection:this.permissions}))},serialize:function(){return{formData:this.model.serialize(),canSetPermission:this.canSetPermission(),permissionLabel:this.getPermissionLabel()}},clientAfterRender:function(){this.canSetPermission()&&this.setView("AddFolderPermissions",new c({params:h.FolderPermissions,content:new r({app:this.app,model:this.model,folder:this.folder,disableRemove:!0,isMultipleSharing:this.isMultipleSharing,changeCallback:this.selectPermissionCallback.bind(this)})}))},getSharingIds:function(){return this.isMultipleSharing?this.folder.map(function(e){return e.get("id")}):this.folder.get("id")},canSetPermission:function(){return this.isMultipleSharing?this.folder.every(function(e){return"edit"===e.get("permission")}):"edit"===this.folder.get("permission")},getPermissionLabel:function(){return"edit"===this.model.get("permission")?this.tr("Can Edit"):this.tr("Can View")},onFieldFocusOut:function(e){if(e.currentTarget.value.length){var t="email"===e.currentTarget.name?this.$(e.currentTarget).closest("._errorHolder"):this.$(e.currentTarget).parent();this.fieldCorrect(t)}},onSubmitForm:function(e,t){t&&t.errors instanceof Array&&this.showSubmitError(t.errors[0].error_message)},onAddPermClick:function(e){e.preventDefault(),this.getView("AddFolderPermissions").toggle(e)},showErrors:function(e,t){var i=this;void 0===t&&(t={}),this.$("label:not(.field-box_correct) input, label:not(.field-box_correct) textarea").each(function(e){return i.fieldReset(i.$(e).parent())}),(0,a.default)(t).forEach(function(e){var s=t[e]instanceof Array?t[e][0]:t[e],a="email"===e?i.$("._errorHolder"):i.$("input[name="+e+"], textarea[name="+e+"]").parent();i.fieldIncorrect(a,{errorMessage:s.length?i.tr(s):s})})},showSubmitError:function(e){if(e){var t=this.$("._submit-error");t.toggleClass("hidden",!1),t.text(e)}},serializeForm:function(){return{email:this.$el.find("._share-email").val(),subject:this.$el.find("._share-subject").val()}},submit:function(){var e=this;this.model.save(this.serializeForm(),{wait:!0,success:function(){e.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:"all",folderId:e.getSharingIds()}),e.shareCallback()}})},selectPermissionCallback:function(e){this.getView("AddFolderPermissions").hide(),this.model.set({permission:e})},shareCallback:function(){}})},728:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(471),o=i(487),l=i(727),n=i(724),r=i(513),c=i(662),d=i(14),h=i(40),u=i(722),p=i(721),f=a.extend({name:"ShareFolder",el:!1,template:u,activeTab:"email",asyncPermissionsLoad:!1,events:{"click ._share-button":"onShareButtonClick"},initialize:function(){if(!this.model)throw new Error(this.name+" "+this.cid+": Folder model required!");if(!this.asyncPermissionsLoad&&!this.permissions)throw new Error(this.name+" "+this.cid+": FolderPermissions collection required!");!this.isMultipleSharing()&&this.asyncPermissionsLoad&&(this.permissions=new c([],{app:this.app}),this.permissions.getQueryParams={folderId:this.model.get("id")},this.permissions.fetch({reset:!0}))},prepareRender:function(){var e=this,t=!this.isMultipleSharing(),i={"._form":new l({app:this.app,folder:this.model,permissions:this.permissions,isMultipleSharing:this.isMultipleSharing(),shareCallback:this.shareCallback.bind(this)})};t&&(this.setTabActive(),i["._tabs"]=new o({name:"ShareFolderTabs",template:p,app:this.app,schema:this.getSchema(),preventDefaultAction:!0,menuUnderline:!0,changeTabCallback:function(){return e.changeTabCallback()}})),t&&this.app.user.isLoggedIn()&&(i["._link"]=new n({app:this.app,folder:this.model,permissions:this.permissions,hideCallback:this.hideCallback.bind(this)})),this.setViews(i)},serialize:function(){return{info:this.isCompact()?{}:this.model.serialize(),isCompact:this.isCompact(),posterMap:this.getPosterMap(),emailSharingAllowed:this.emailSharingAllowed(),linkSharingAllowed:this.linkSharingAllowed(),activeTab:this.activeTab}},clientAfterRender:function(){this.isCompact()||this.initSocialButtons({shortenMap:{facebook:1,twitter:2,google:3},socialNameMap:{facebook:!0,twitter:!0,google:!1},shareData:{title:this.model.get("title"),description:this.model.get("description"),image:this.collection.length?this.collection.first().get("thumbs").huge:""}})},isMultipleSharing:function(){return this.model instanceof Array&&this.model.length>1},isCompact:function(){return void 0===this.collection},emailSharingAllowed:function(){return this.app.user.isLoggedIn()},linkSharingAllowed:function(){return!this.isMultipleSharing()&&"edit"===this.model.get("permission")&&this.app.user.isLoggedIn()},setTabActive:function(){var e=this.permissions.findWhere({type:"link"});this.permissions.where({type:"user"}).length<=1&&e&&"edit"===e.get("permission")&&(this.activeTab="link")},getSchema:function(){var e=[],t=!1;return this.emailSharingAllowed()&&(t=!0,e.push({key:"email",label:this.tr("Email"),active:"email"===this.activeTab})),this.linkSharingAllowed()&&(t=!0,e.push({key:"link",label:this.tr("Link"),active:!t||"link"===this.activeTab})),this.isCompact()||(t=!0,e.push({key:"social",label:this.tr("Social"),active:!t||"social"===this.activeTab})),e},getPosterMap:function(){var e=41,t=[],i=[],s=[];if(!this.isCompact()){this.collection.first(6).forEach(function(e){i.push(e.get("thumbs").bigWide),s.push(2*e.get("id").toString().substr(-1))});for(var a=0;a<Math.max(Math.floor(i.length/2),1);a++){var o=e+s[a],l=[{url:i[2*a],width:o}],n=2*a+1;i[n]&&l.push({url:i[n],width:100-o}),t.push({images:l})}}return t},changeTabCallback:function(){this.app.observer.fire("Tooltip:GlobalHide",{cid:"all"});var e=this.findView("ShareFolderTabs").getActiveTab();this.$("._wrap").removeClass("active").filter("[data-tab="+e.get("key")+"]").addClass("active"),this.activeTab=e.get("key")},getSocialRedirectUrl:function(e){return d.urlFormat({protocol:"http:",host:e.isShortenUrl?h.hostnameShorthand:this.app.host,pathname:"/f/"+this.model.get("id")+e.refId})},shareCallback:function(){}});(0,s.default)(f.prototype,r),e.exports=f},729:function(e,t,i){"use strict";var s=i(475),a=i(728);e.exports=s.extend({name:"ShareFolderModal",overlayOpacity:70,draggable:!0,noBorder:!0,showHeader:!0,showTitle:!1,fullScreen:!0,destroyOnHide:!0,options:{},modalClasses:"modal_share modal_with-poster",bodyClasses:"modal__body_share",footer:[],initialize:function(){this.options.callback&&(this.onAfterHideCallback=this.options.callback),this.body=[new a({app:this.app,model:this.model,collection:this.collection,permissions:this.permissions,asyncPermissionsLoad:this.asyncPermissionsLoad,shareCallback:this.shareCallback.bind(this),hideCallback:this.hideCallback.bind(this)})];for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];s.prototype.initialize.apply(this,t)},show:function(){this.def=Backbone.$.Deferred();for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return s.prototype.show.apply(this,t),this.def.promise()},hideCallback:function(){this.hide()},shareCallback:function(){this.hide(),this.app.observer.fire("Notification",{type:"success"})}})},730:function(e,t,i){"use strict";var s=i(1),a=s(i(4)),o=s(i(23)),l=i(0),n=i(9),r=i(99);e.exports=r.extend({url:"FolderPermission",defaults:{type:"",permission:"",folderId:null,link:null,value:null,user:{}},relations:{user:n.extend({defaults:{userId:null,username:"",email:"",firstName:"",lastName:"",avatar:"/_img/avatar-border-default-30.png"},initialize:function(){var e=this;this.on("change:userId",function(){e.attributes.userId=parseInt(e.attributes.userId,10)})},parse:function(e){void 0===e&&(e={});var t=l.pick(e,(0,o.default)(this.defaults));return t.userId=parseInt(t.userId,10),t}})},parse:function(e){if(void 0===e&&(e={}),e.errors)return{};var t=l.pick(e,(0,o.default)(this.defaults));return t.folderId=parseInt(t.folderId,10)||this.defaults.folderId,t.link=e.link||null,"email"===t.type&&(t.user={email:e.value}),"user"===t.type&&(t.user=e.value),t},getQueryParams:function(){var e=(0,a.default)({emitter:this.app.uid},this.attributes,this.get("user").attributes);return"link"===this.get("type")&&(e.id=this.get("value")),"user"===this.get("type")&&(e.id=this.get("user").get("userId")),e.type="link"===e.type?e.type:"user",e},serialize:function(){return(0,a.default)(this.get("user").serialize(),{userId:parseInt(this.get("user").get("userId"),10),permission:this.get("permission"),type:this.get("type"),link:this.get("link"),fullName:this.getFullName()})},getFullName:function(){return this.get("user").get("firstName").length?(this.get("user").get("firstName")+" "+(this.get("user").get("lastName")||"")).trim():this.get("user").get("email")},isMatchByEmail:function(e){return"link"!==this.get("type")&&this.get("user").get("email")===e},updatePermission:function(e){return this.save(e,{wait:!0,observable:!0})},deletePermission:function(){var e=this;return this.sync("delete",this,{success:function(){return e.destroy({observable:!0})}})}})},731:function(e,t){e.exports=function(e){var t='<div class="shared-users';if(e.opened&&(t+=" shared-users_opened"),e.listOnly&&(t+=" shared-users_list-only"),t+='">',e.listOnly||(t+='<span class="shared-users__title">'+this.tr("Shared with:")+"</span>"),e.opened){e.listOnly||(t+='<i class="shared-users__close arrow arrow-top arrow-block-1 _close-list"></i>'),t+='<div class="shared-users__list-box _scroll"><ul class="shared-users__list">',e.includeLink&&(t+='<li class="shared-users__list-row shared-users__list-row_type"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-link"></i></span></div><span class="shared-users__user-email">'+this.tr("Link Sharing")+'</span><span class="shared-users__user-name">',"edit"===e.linkPermission.permission?t+=""+this.tr("Anyone with the link can edit"):t+=""+this.tr("Anyone with the link can view"),t+='</span></div><div class="shared-users__perm">',"edit"===e.linkPermission.permission?t+='<i class="icon icon-folder-action-edit"></i>':t+='<i class="icon icon-folder-action-view"></i>',t+="</div></li>");var i=e.usersList;if(i)for(var s,a=-1,o=i.length-1;a<o;)(s=i[a+=1]).userId===e.ownerId?(t+='<li class="shared-users__list-row"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+s.avatar+'" /></span>',s.userId===e.ownerId&&(t+='<i class="shared-users__star icon icon-star-owner"></i>'),t+='</div><span class="shared-users__user-name">',s.firstName.length||s.lastName.length?t+=s.firstName+" "+s.lastName:t+=""+s.username,t+='</span><span class="shared-users__user-email" title="'+s.email+'">'+s.email+'</span></div><div class="shared-users__perm"><span class="shared-users__creator">'+this.tr("Creator")+"</span></div></li>"):(t+='<li class="shared-users__list-row shared-users__list-row_hoverable _select-perm"data-id="'+s.email+'"data-email="'+s.email+'"><div class="shared-users__user">',"email"===s.type?t+='<div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span></div>':(t+='<div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+s.avatar+'" /></span>',s.userId===e.ownerId&&(t+='<i class="shared-users__star icon icon-star-owner"></i>'),t+="</div>"),t+='<span class="shared-users__user-name">',s.firstName.length||s.lastName.length?t+=s.firstName+" "+s.lastName:t+=""+s.username,t+='</span><span class="shared-users__user-email" title="'+s.email+'">'+s.email+'</span></div><div class="shared-users__perm">',"edit"===s.permission?t+='<i class="icon icon-folder-action-edit"></i>':t+='<i class="icon icon-folder-action-view"></i>',t+="</div></li>");t+="</ul></div>"}else t+='<div class="shared-users__avatars _users _open-list"></div><i class="shared-users__icon arrow arrow-bottom arrow-block-1 _open-list"></i>';return t+="</div>"}},732:function(e,t){e.exports=function(e){var t='<ul class="folder-perm-tooltip">',i=e.permList;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<li class="folder-perm-tooltip__item folder-perm-tooltip__item_'+(s=i[a+=1]).type+" _"+s.type+'" data-name="'+s.name+'">',s.active&&(t+='<i class="folder-perm-tooltip__icon icon icon-ok"></i>'),t+='<span class="folder-perm-tooltip__title">'+s.title+"</span></li>";return t+="</ul>"}},733:function(e,t){e.exports=function(e){var t='<div class="folder-users"><div class="folder-users__avatars">',i=e.users;if(i)for(var s,a=-1,o=i.length-1;a<o;)t+='<div class="folder-users__avatar _avatar-box" data-title="'+(s=i[a+=1]).title+'">',"email"===s.type?t+='<span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span>':t+='<span class="folder-users__avatar-box avatar-box avatar-box-m"><img class="folder-users__avatar-img avatar avatar-m" src="'+s.avatar+'" /></span>',s.userId===e.ownerId&&(t+='<i class="folder-users__star icon icon-star-owner"></i>'),t+="</div>";return t+="</div>",e.moreCount>0&&(t+='<div class="folder-users__more">+'+e.moreCount+"</div>"),t+="</div>"}},796:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(0),o=i(9),l=i(48),n=o.extend({defaults:{name:"",label:"",value:null,editable:!0,selector:""},idAttribute:"name",lastSyncedAttrs:{},initialize:function(){var e=this;this.fakeNestedSaveLastSyncedAttrs(),this.on("change",function(t,i){i.storeAsLastSynced&&e.fakeNestedSaveLastSyncedAttrs()})},saveLastSyncedAttrs:function(e,t){t.errors||(this.lastSyncedAttrs=(0,s.default)({},this.lastSyncedAttrs,this.attributes))},resetToLastSynced:function(e,t){return this.set(e?a.pick(this.lastSyncedAttrs,e):this.attributes,t)},isChangedButNotSaved:function(e){return this.get(e)!==this.lastSyncedAttrs[e]},isChangedButNotSavedValue:function(){return this.isChangedButNotSaved("value")},resetToLastSyncedValue:function(){return this.resetToLastSynced("value")},fakeNestedSaveLastSyncedAttrs:function(){this.saveLastSyncedAttrs({},{})}});e.exports=l.extend({model:n,getPrefsAsHash:function(){var e={};return this.serialize().forEach(function(t){e[t.name]=t.value}),e}})},904:function(e,t,i){"use strict";(function(e,s){var a=i(1)(i(698)),o=i(40),l=i(6)(e);t.init=function(){return s.browser?new a.default(function(e,t){return Backbone.ajax({url:o.websocket.clientUrl,dataType:"script",success:function(){var i=new(window.ActionheroClient?window.ActionheroClient:window.ActionheroWebsocketClient)({strategy:"online, timeout, disconnect"});i.on("error",function(e){l.error("WebSocket Error",e.stack)}),i.connect(function(s){return s?t(s):e(i)})},async:!0})}):null}}).call(this,i(3)(e),i(5))},905:function(e,t,i){"use strict";var s=i(0),a=i(101),o=function(){function e(e,t){var i=this;this.field=a(e),this.holder=null,this.options=s.extend({mode:"count",holder:"parent",min:0,max:0,prefix:"",format:"%count%"},t),this.createIndicator(),this.options.max>0&&this.field.attr("maxlength",this.options.max),this.field.on("input",function(){return i.count()}),this.count()}var t=e.prototype;return t.createIndicator=function(){"object"==typeof this.options.holder?this.holder=this.options.holder:"parent"===this.options.holder?this.holder=this.field.parent():this.holder=a(this.options.holder),this.indicator=a("<i />",{class:"field-counter"}),this.holder.append(this.indicator)},t.count=function(){var e=this.field.val().length;"countdown"===this.options.mode&&(e=this.options.max-e);var t=this.options.format.replace("%count%",e).replace("%max%",this.options.max).replace("%prefix%",this.options.prefix);this.indicator.text(t),e>this.options.max||e<this.options.min||"countdown"===this.options.mode&&e<0?(this.field.trigger("incorrect"),this.indicator.addClass("red")):(this.field.trigger("reset"),this.indicator.removeClass("red"))},e}();e.exports=function(e,t){e.each(function(e,i){new o(i,t)})}},906:function(e,t,i){"use strict";var s=i(0),a=i(471),o=i(905),l=i(1011);e.exports=a.extend({initialize:function(){this.name="EditFolderForm",this.el=!1,this.template=l},clientAfterRender:function(){o(this.$("._counter"),{mode:"countdown",max:50})},serializeForm:function(){return{title:s.escape(this.$el.find("[name=title]").val().trim())}},serialize:function(){return this.model.serialize()}})},911:function(e,t,i){"use strict";var s=i(1)(i(4)),a=i(471),o=i(473),l=i(1023),n=i(472),r=i(1021);e.exports=a.extend({name:"FavoritesPanelFolderList",el:!1,template:r,excludeActive:!1,onlyEditable:!1,selected:null,events:{click:"onClick"},initialize:function(){this.state&&this.listenTo(this.state,"change:folderID",this.render),this.listenTo(this.collection,"change reset update",this.render)},serialize:function(){var e=this.getSelectedFolder(),t=e?(0,s.default)(e.serialize(),{isOwn:e.get("userId")===parseInt(this.app.user.get("id"),10)}):null;return{className:this.className,folder:t}},clientAfterRender:function(){var e=this.getSelectedFolder();this.setView("FavoriteFoldersList",new o({name:"FavoriteFoldersList",params:n.FoldersList,classes:{"tooltip_extra-shadow":!0},content:new l({app:this.app,active:e&&e.get("id"),folders:this.getFoldersGroups(),onSelect:this.onSelectedChange.bind(this),onPartClickCallback:this.onPartClickCallback.bind(this)})}))},getSelectedFolder:function(){var e=this,t=this.selected?this.collection.get(this.selected.id):null;if(t)return t;var i=this.getActiveFoldersIds(),s=parseInt(this.app.user.get("id"),10);return this.collection.find(function(t){var a=!i.includes(t.get("id")),o=t.get("userId")===s||"edit"===t.get("permission");return e.excludeActive&&a&&e.onlyEditable&&o})},getFoldersGroups:function(){var e=this.onlyEditable?this.collection.serializeGroupsByPermission(["owner","edit"]):this.collection.serializeGroupsByPermission(),t=this.getActiveFoldersIds();return this.excludeActive&&e.forEach(function(e){e.data=e.data.filter(function(e){return!t.includes(e.id)})}),e},onClick:function(e){this.getView("FavoriteFoldersList").toggle(e)},getActiveFoldersIds:function(){var e=this.getActiveFolder();return e?e instanceof Array?e.map(function(e){return e.get("id")}):[e.get("id")]:[]},onSelectedChange:function(e){var t=parseInt(e,10);this.getView("FavoriteFoldersList").hide(),this.onFoldersChange(t),this.selected=this.collection.get(t),this.render()},onPartClickCallback:function(){this.getView("FavoriteFoldersList").onTargetPosition()},serializeForm:function(){return{folder:this.getSelectedFolder().get("id")}},getActiveFolder:function(){},onFoldersChange:function(){}})}}]);